<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>dotNeté«˜çº§ç¼–ç¨‹</title>
    <url>/2024/09/05/dotNet%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B/</url>
    <content><![CDATA[<meta name="referrer" content="no-referrer">

<h2 id="C-çš„æ•°æ®ç»“æ„"><a href="#C-çš„æ•°æ®ç»“æ„" class="headerlink" title="C#çš„æ•°æ®ç»“æ„"></a>C#çš„æ•°æ®ç»“æ„</h2><p>Arraylist è‡ªå®šä¹‰ç±»å‹ ç±»ä¼¼pyçš„list å­˜åœ¨è£…æ‹†ç®±</p>
<p>List æ›´å®‰å…¨çš„ç‰ˆæœ¬ åˆ›å»ºå‰éœ€è¦å£°æ˜ç±»å‹ ä¸ç”¨è£…ç®±æ‹†ç®±ï¼ˆä¸Šé¢è¿™ä¸¤è€…çš„åŒºåˆ«å¯èƒ½ä¼šè€ƒï¼‰</p>
<p>Hashtable ç±»ä¼¼äºdict æ˜¯å“ˆå¸Œä»£ç ç»„ç»‡èµ·æ¥çš„é”®å€¼å’Œå¯¹çš„é›†åˆ </p>
<blockquote>
<p><strong>Hashtableä¸­key-valueé”®å€¼å¯¹å‡ä¸ºobjectç±»å‹</strong>ï¼Œæ‰€ä»¥åœ¨å­˜å‚¨æˆ–æ£€ç´¢å€¼ç±»å‹æ—¶é€šå¸¸å‘ç”Ÿè£…ç®±å’Œæ‹†ç®±çš„æ“ä½œ é»˜è®¤çš„ Hashtable å…è®¸å•çº¿ç¨‹å†™å…¥, å¤šçº¿ç¨‹è¯»å–, å¯¹ Hashtable è¿›ä¸€æ­¥è°ƒç”¨ Synchronized() æ–¹æ³•å¯ä»¥è·å¾—å®Œå…¨çº¿ç¨‹å®‰å…¨çš„ç±»å‹ã€‚</p>
</blockquote>
<p>å­—å…¸Dictionary éœ€è¦å£°æ˜ç±»å‹ HashTableä¸æ”¯æŒ<strong>æ³›å‹</strong>ï¼Œè€ŒDictionaryæ”¯æŒæ³›å‹ã€‚</p>
<blockquote>
<p>Dicæ˜¯ç±»å‹å®‰å…¨çš„ï¼Œè¿™æœ‰åŠ©äºæˆ‘ä»¬å†™å‡ºæ›´å¥å£®æ›´å…·å¯è¯»æ€§çš„ä»£ç ï¼Œè€Œä¸”çœå´æˆ‘ä»¬å¼ºåˆ¶è½¬åŒ–çš„éº»çƒ¦ã€‚å½“Kæˆ–Væ˜¯å€¼ç±»å‹æ—¶ï¼Œå…¶é€Ÿåº¦è¿œè¿œè¶…è¿‡Hashtableã€‚æˆ‘è®¤ä¸ºåº”è¯¥å§‹ç»ˆä½¿ç”¨Dictionary&lt;K, V&gt;ï¼Œå³ä½¿è¦ç”¨Hashtableäº†ï¼Œä¹Ÿå¯ä»¥ç”¨Dictionary&lt;object, object&gt;æ¥æ›¿ä»£ã€‚</p>
</blockquote>
<p>HashSet åŒ…å«ä¸é‡å¤é¡¹çš„æ— åºåˆ—è¡¨</p>
<p>LinkedList é“¾è¡¨</p>
<p>Stack å †æ ˆ å…ˆè¿›åå‡º push pop</p>
<p>Queue é˜Ÿåˆ— å…ˆè¿›å…ˆå‡º enqueue dequeue</p>
<blockquote>
<p>è®°å½•äº2023.7.19 ä¸€äº›æœ‰çš„æ²¡çš„åºŸè¯ï¼Œä»Šå¤©è„–å­åˆå¼€å§‹ç–¼äº†å¸Œæœ›äººæ²¡äº‹ã€‚æ˜¨å¤©å’Œè€å¸ˆèŠä¸€èŠè¢«é¼“åŠ±åˆ°äº†æ„Ÿè§‰è‡ªå·±æ‰¾åˆ°å¿ƒä»ªå·¥ä½œå¸Œæœ›è¿˜æ˜¯æŒºå¤§çš„ã€‚</p>
</blockquote>
<p><strong>å¼•ç”¨ç±»å‹</strong> string int[] class interface å­˜åœ¨å †ä¸Š</p>
<p><strong>å€¼ç±»å‹</strong> int float bool struct å­˜åœ¨æ ˆä¸Š</p>
<p>ï¼ˆPSï¼šå€¼ç±»å‹å¦‚æœä½œä¸ºå¼•ç”¨ç±»å‹çš„æˆå‘˜ï¼Œé‚£ä¹ˆä¼šåœ¨å †é‡Œï¼‰</p>
<p><img src="https://pic4.zhimg.com/80/v2-566d3b8e48c8573d0986420b0beb86df_1440w.jpg" alt="img"></p>
<p><strong>å°½é‡é¿å…æ‹†è£…</strong></p>
<p>å€¼-&gt;å¼•ç”¨ <strong>è£…ç®±</strong> object b &#x3D; (object)a ï¼ˆå¯ä»¥ç†è§£ä¸ºå¤šå¥—äº†ä¸€å±‚å£³æŠŠå¼•ç”¨æ”¾æ ˆä¸Šï¼Œå®é™…æ•°æ®æ”¾å †ä¸Šäº†ï¼‰</p>
<p>å¼•ç”¨-&gt;å€¼ <strong>æ‹†ç®±</strong> int c &#x3D; a</p>
<h2 id="å†…å­˜ç®¡ç†"><a href="#å†…å­˜ç®¡ç†" class="headerlink" title="å†…å­˜ç®¡ç†"></a>å†…å­˜ç®¡ç†</h2><h3 id="C-çš„åƒåœ¾å›æ”¶ï¼ˆGCï¼‰"><a href="#C-çš„åƒåœ¾å›æ”¶ï¼ˆGCï¼‰" class="headerlink" title="C#çš„åƒåœ¾å›æ”¶ï¼ˆGCï¼‰"></a>C#çš„åƒåœ¾å›æ”¶ï¼ˆGCï¼‰</h3><p>æ˜¯.net ä¸­å¯¹å†…å­˜ç®¡ç†çš„ä¸€ç§åŠŸèƒ½ã€‚åƒåœ¾å›æ”¶å™¨è·Ÿè¸ªå¹¶å›æ”¶æ‰˜ç®¡å†…å­˜ï¼ˆå †ï¼‰ä¸­åˆ†é…çš„å¯¹è±¡ï¼Œå®šæœŸæ‰§è¡Œåƒåœ¾å›æ”¶ä»¥å›æ”¶åˆ†é…ç»™æ²¡æœ‰æœ‰æ•ˆå¼•ç”¨çš„å¯¹è±¡çš„å†…å­˜ã€‚å½“ä½¿ç”¨å¯ç”¨å†…å­˜ä¸èƒ½æ»¡è¶³å†…å­˜è¯·æ±‚æ—¶ï¼ŒGC ä¼šè‡ªåŠ¨è¿›è¡Œã€‚å‡è½»å†…å­˜ç®¡ç†çš„å‹åŠ›ï¼Œå°†ç®¡ç†ä»ç¨‹åºç¼–å†™è½¬åŒ–åˆ°äº†è¿è¡Œæ—¶ã€‚</p>
<p>æ­¥éª¤ï¼šé¦–å…ˆæœç´¢å†…å­˜ä¸­çš„æ‰˜ç®¡å¯¹è±¡ï¼Œç„¶åä»æ‰˜ç®¡ä»£ç ä¸­æœç´¢è¢«å¼•ç”¨çš„å¯¹è±¡å¹¶æ ‡è®°ä¸ºæœ‰æ•ˆï¼Œæ¥ç€é‡Šæ”¾æ²¡æœ‰è¢«æ ‡è®°ä¸ºæœ‰æ•ˆçš„å¯¹è±¡å¹¶æ”¶å›å†…å­˜ï¼Œæœ€åæ•´ç†å†…å­˜ä½¿ä»–ä»¬é‡æ–°ä»heapåŸºåœ°å€å¼€å§‹è¿ç»­æ’åˆ—ï¼Œç±»ä¼¼äºç£ç›˜ç©ºé—´çš„ç¢ç‰‡æ•´ç†ã€‚</p>
<p><strong>ä¸€äº›æ¦‚å¿µ</strong></p>
<p>å¯¹è±¡ä»£é¾„ï¼šæ¯æ´»è¿‡ä¸€æ¬¡åƒåœ¾å›æ”¶å°±+1å˜æˆç¬¬nä»£å¯¹è±¡ã€‚å¯ä»¥å¯¹æ–°ã€è€åŒºåŸŸé‡‡ç”¨ä¸åŒçš„å›æ”¶ç­–ç•¥å’Œç®—æ³•ï¼ŒåŠ å¼ºå¯¹æ–°åŒºåŸŸçš„å›æ”¶å¤„ç†åŠ›åº¦ã€‚</p>
<p>å¼ºåˆ¶åƒåœ¾å›æ”¶ç”¨å‡½æ•°GC.Collect() </p>
<p>å•ä¸ªå¯¹è±¡å›æ”¶æ—¶è°ƒç”¨ææ„å‡½æ•° Object.Finalize() æˆ–è€… å¦‚æœéœ€è¦å¼ºåˆ¶å›æ”¶å¯ä»¥æ‰‹åŠ¨è°ƒç”¨Dispose()æ–¹æ³•</p>
<h2 id="C-å§”æ‰˜delegate"><a href="#C-å§”æ‰˜delegate" class="headerlink" title="C# å§”æ‰˜delegate"></a><strong>C# å§”æ‰˜delegate</strong></h2><p><a href="https://www.cnblogs.com/SkySoot/archive/2012/04/05/2433639.html">C# ä¸­çš„å§”æ‰˜å’Œäº‹ä»¶(è¯¦è§£) - SkySoot - åšå®¢å›­</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/620002450">å½»åº•å¼„æ‡‚C#ä¸­delegateã€eventã€EventHandlerã€Actionã€Funcçš„ä½¿ç”¨å’ŒåŒºåˆ« - çŸ¥ä¹ (zhihu.com)</a></p>
<p>å§”æ‰˜æ˜¯ä¸€ä¸ªç±»ï¼Œå®ƒå®šä¹‰äº†æ–¹æ³•çš„ç±»å‹ï¼Œä½¿å¾—å¯ä»¥å°†æ–¹æ³•å½“ä½œå¦ä¸€ä¸ªæ–¹æ³•çš„å‚æ•°æ¥è¿›è¡Œä¼ é€’ï¼Œè¿™ç§å°†æ–¹æ³•åŠ¨æ€åœ°èµ‹ç»™å‚æ•°çš„åšæ³•ï¼Œå¯ä»¥é¿å…åœ¨ç¨‹åºä¸­å¤§é‡ä½¿ç”¨If â€¦ Else(Switch)è¯­å¥ï¼ŒåŒæ—¶ä½¿å¾—ç¨‹åºå…·æœ‰æ›´å¥½çš„å¯æ‰©å±•æ€§ã€‚åœ¨æˆ‘çœ‹æ¥å§”æ‰˜æ˜¯ä¸€ç±»ç›¸åŒå‡½æ•°ï¼ˆè¿”å›å€¼ç±»å‹ä¸å‚æ•°åˆ—è¡¨ä¸€è‡´ï¼‰çš„é“¾è¡¨ã€‚å¾€å§”æ‰˜é‡Œé¢æ·»åŠ æ–¹æ³•ï¼Œå°±æ˜¯æ·»åŠ è¿™ä¸ªç‰¹å®šè¿”å›å€¼ç±»å‹çš„æ–¹æ³•è¿›ä¸€ä¸ªé“¾è¡¨ï¼Œåœ¨æ‰§è¡Œå§”æ‰˜çš„æ—¶å€™ä¾æ¬¡æ‰§è¡Œä»–ä»¬ã€‚</p>
<p>C#çš„å§”æ‰˜é€šè¿‡delegateå…³é”®å­—æ¥å£°æ˜ã€‚</p>
<p>æ˜¾å¼åœ°å£°æ˜å§”æ‰˜: ç›¸å½“äºå®šä¹‰äº†ä¸€ç§ç±»ï¼Œ è¿™ä¸ªç±»å³ä¸ºä¸€ä¸ªæ¥å—ä¸€ä¸ªå‚æ•°xçš„æ–¹æ³•ã€‚</p>
<pre class=" language-Csharp"><code class="language-Csharp">//ç¬¬ä¸€ç§æ–¹å¼:
delegate void MyDelegate1 (int x)
//ç¬¬äºŒç§æ–¹å¼:
delegate void MyDelegate2<T>(T x )
</code></pre>
<p>ä½¿ç”¨å§”æ‰˜: åˆ›å»ºå®ä¾‹ï¼Œå³å°†ä¸€ä¸ªå‡½æ•°ä½œä¸ºå§”æ‰˜å®ä¾‹å­˜åœ¨ã€‚</p>
<pre class=" language-Csharp"><code class="language-Csharp">//ç¬¬ä¸€ç§æ–¹å¼:
MyDelegate1 mydelegate = new MyDelegate1( func )
//ç¬¬äºŒç§æ–¹å¼:
MyDelegate1 mydelegate = func
</code></pre>
<h3 id="ä½¿ç”¨å®ä¾‹"><a href="#ä½¿ç”¨å®ä¾‹" class="headerlink" title="ä½¿ç”¨å®ä¾‹"></a>ä½¿ç”¨å®ä¾‹</h3><pre class=" language-Csharp"><code class="language-Csharp">public delegate void GreetingDelegate(string name);
 
class Program
{
    private static void EnglishGreeting(string name)
    {
        Console.WriteLine("Good Morning, " + name);
    }
 
    private static void ChineseGreeting(string name)
    {
        Console.WriteLine("æ—©ä¸Šå¥½, " + name);
    }
 
    private static void GreetPeople(string name, GreetingDelegate MakeGreeting)
    {
        MakeGreeting(name);
    }
 
    static void Main(string[] args)
    {
        GreetPeople("Liker", EnglishGreeting);
        GreetPeople("æå¿—ä¸­", ChineseGreeting);
        Console.ReadLine();
    }
}
</code></pre>
<h3 id="åŒ¿åæ–¹æ³•"><a href="#åŒ¿åæ–¹æ³•" class="headerlink" title="åŒ¿åæ–¹æ³•"></a>åŒ¿åæ–¹æ³•</h3><p>Actionï¼ˆä¸å¸¦è¿”å›å€¼çš„å§”æ‰˜ï¼‰</p>
<p>Funcï¼ˆè¿”å›å€¼ä¸ºintï¼Œæœ€åçš„å‚æ•°éœ€è¦å’Œå§”æ‰˜çš„å‡½æ•°çš„è¿”å›å€¼ç±»å‹ä¿æŒä¸€è‡´ï¼‰</p>
<pre class=" language-Csharp"><code class="language-Csharp">Action m_action = delegate(){
    Debug.log("rua");
};
public Action<int> m_action;
action();
</code></pre>
<p><strong>å¤šæ’­å§”æ‰˜</strong></p>
<p>ç›´æ¥+&#x3D;åŠ -&#x3D;å‡å„ç§å§”æ‰˜åˆ°å§”æ‰˜ç±»å‹ä¸Šé¢å¯ä»¥åŒæ—¶æ‰§è¡Œè¿™äº›å‡½æ•°</p>
<pre class=" language-Csharp"><code class="language-Csharp">Action action = Show1;
action += Show2;
action -=Show2;
action -=Show1;
action();
</code></pre>
<h3 id="Event-ï¼ˆå§”æ‰˜ä¿®é¥°ç¬¦ï¼‰"><a href="#Event-ï¼ˆå§”æ‰˜ä¿®é¥°ç¬¦ï¼‰" class="headerlink" title="Event ï¼ˆå§”æ‰˜ä¿®é¥°ç¬¦ï¼‰"></a><strong>Event ï¼ˆå§”æ‰˜ä¿®é¥°ç¬¦ï¼‰</strong></h3><p><strong>å…³é”®å­—eventåœ¨å®ä¾‹åŒ–å§”æ‰˜æ—¶ä½¿ç”¨è€Œéå®šä¹‰å§”æ‰˜æ—¶ä½¿ç”¨ã€‚</strong>å®ƒå°è£…äº†å§”æ‰˜ç±»å‹çš„å˜é‡ï¼Œä½¿å¾—ï¼šåœ¨ç±»çš„å†…éƒ¨ï¼Œä¸ç®¡ä½ å£°æ˜å®ƒæ˜¯publicè¿˜æ˜¯protectedï¼Œå®ƒæ€»æ˜¯private çš„ã€‚åœ¨ç±»çš„å¤–éƒ¨ï¼Œæ³¨å†Œâ€œ+&#x3D;â€å’Œæ³¨é”€â€œ-&#x3D;â€çš„è®¿é—®é™å®šç¬¦ä¸ä½ åœ¨å£°æ˜äº‹ä»¶æ—¶ä½¿ç”¨çš„è®¿é—®ç¬¦ç›¸åŒã€‚</p>
<p>ç®€å•çš„ç†è§£ä¸ºï¼ševentæ˜¯ä¸€ç§ç‰¹æ®Šçš„å§”æ‰˜ï¼Œå®ƒåªèƒ½+&#x3D;ï¼Œ-&#x3D;ï¼Œä¸èƒ½ç›´æ¥ç”¨&#x3D;</p>
<p>ç»è¿‡é•¿ä¹…çš„ç»éªŒç§¯ç´¯åï¼Œäººä»¬å‘ç°ï¼Œç»å¤§å¤šæ•°äº‹ä»¶çš„å®šä¹‰ï¼Œæ˜¯ç”¨public delegate void XXX(object sender, EventArgs e);è¿™æ ·ä¸€ä¸ªå§”æ‰˜åŸå‹è¿›è¡Œå®šä¹‰çš„ã€‚æ‰€ä»¥åæ¥æ™®éä½¿ç”¨EventHandleræ¥å®šä¹‰ä¸Šé¢çš„æƒ…å†µã€‚è¡¨ç¤ºç”¨äºå¤„ç†ä¸å…·æœ‰äº‹ä»¶æ•°æ®çš„äº‹ä»¶çš„æ–¹æ³•ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š</p>
<pre class=" language-Csharp"><code class="language-Csharp">this.Activated += new EventHandler(Form1_Activated);

this.Activated=ä½ åƒå®Œé¥­;
Form1_Activated=å–Šæˆ‘ä¸€å£°
</code></pre>
<p>æˆ‘å§”æ‰˜ä½ åƒå®Œé¥­äº†ï¼Œå–Šæˆ‘ä¸€å£°ã€‚è¿™æ ·æˆ‘å°±ä¸ç”¨è¿‡ä¸€ä¼šå°±æ¥çœ‹ä¸€ä¸‹ä½ åƒå®Œäº†æ²¡æœ‰äº†ï¼Œå·²ç»å§”æ‰˜ä½ äº†ã€‚</p>
<h3 id="å§”æ‰˜åœ¨è§‚å¯Ÿè€…æ¨¡å¼çš„åº”ç”¨"><a href="#å§”æ‰˜åœ¨è§‚å¯Ÿè€…æ¨¡å¼çš„åº”ç”¨" class="headerlink" title="å§”æ‰˜åœ¨è§‚å¯Ÿè€…æ¨¡å¼çš„åº”ç”¨"></a>å§”æ‰˜åœ¨è§‚å¯Ÿè€…æ¨¡å¼çš„åº”ç”¨</h3><p>å½“æˆ‘éœ€è¦åšä¸€ä¸ªé¼ æ ‡ç‚¹å‡»å“åº”çš„ä»»åŠ¡æ—¶ï¼Œå¦‚æœç»™æ¯ä¸€ä¸ªé¼ æ ‡ç±»éƒ½ç»§æ‰¿ä¸Šä¸€å †ClickHandlerå°±æ˜¾å¾—éå¸¸ç¬¨æ¯”ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªEventListeneræ¥ç»Ÿä¸€ç®¡ç†è¿™ç§äº‹ä»¶ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<pre class=" language-csharp"><code class="language-csharp"><span class="token keyword">using</span> System<span class="token punctuation">.</span>Collections<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic<span class="token punctuation">;</span>
<span class="token keyword">using</span> UnityEngine<span class="token punctuation">;</span>
<span class="token keyword">using</span> UnityEngine<span class="token punctuation">.</span>UI<span class="token punctuation">;</span>
<span class="token keyword">using</span> UnityEngine<span class="token punctuation">.</span>EventSystems<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UIEventListener</span> <span class="token punctuation">:</span> MonoBehaviour<span class="token punctuation">,</span> IPointerClickHandler<span class="token punctuation">,</span> IPointerEnterHandler<span class="token punctuation">,</span> IPointerExitHandler <span class="token punctuation">{</span>

    <span class="token comment" spellcheck="true">// å®šä¹‰äº‹ä»¶ä»£ç†</span>
    <span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token keyword">void</span> <span class="token function">UIEventProxy</span><span class="token punctuation">(</span>GameObject gb<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// é¼ æ ‡ç‚¹å‡»äº‹ä»¶</span>
    <span class="token keyword">public</span> <span class="token keyword">event</span> UIEventProxy OnClick<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// é¼ æ ‡è¿›å…¥äº‹ä»¶</span>
    <span class="token keyword">public</span> <span class="token keyword">event</span> UIEventProxy OnMouseEnter<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// é¼ æ ‡æ»‘å‡ºäº‹ä»¶</span>
    <span class="token keyword">public</span> <span class="token keyword">event</span> UIEventProxy OnMouseExit<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">OnPointerClick</span><span class="token punctuation">(</span>PointerEventData eventData<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>OnClick <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token function">OnClick</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>gameObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">OnPointerEnter</span><span class="token punctuation">(</span>PointerEventData eventData<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>OnMouseEnter <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token function">OnMouseEnter</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>gameObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">OnPointerExit</span><span class="token punctuation">(</span>PointerEventData eventData<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>OnMouseExit <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token function">OnMouseExit</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>gameObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//å®é™…éœ€è¦ä½¿ç”¨çš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥åˆ›å»ºä¸€ä¸ªæ™®é€šçš„TestEvent</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestEvent</span> <span class="token punctuation">:</span> MonoBehaviour <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">Start</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Button btn <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token generic-method function">GetComponent<span class="token punctuation">&lt;</span>Button<span class="token punctuation">></span> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        UIEventListener btnListener <span class="token operator">=</span> btn<span class="token punctuation">.</span>gameObject<span class="token punctuation">.</span><span class="token generic-method function">AddComponent<span class="token punctuation">&lt;</span>UIEventListener<span class="token punctuation">></span> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//æ·»åŠ UIEventListenerç±»</span>

        btnListener<span class="token punctuation">.</span>OnClick <span class="token operator">+</span><span class="token operator">=</span> <span class="token keyword">delegate</span><span class="token punctuation">(</span>GameObject gb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            Debug<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span>gb<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">" OnClick"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        btnListener<span class="token punctuation">.</span>OnMouseEnter <span class="token operator">+</span><span class="token operator">=</span> <span class="token keyword">delegate</span><span class="token punctuation">(</span>GameObject gb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            Debug<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span>gb<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">" OnMouseEnter"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        btnListener<span class="token punctuation">.</span>OnMouseExit <span class="token operator">+</span><span class="token operator">=</span> <span class="token keyword">delegate</span><span class="token punctuation">(</span>GameObject gb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            Debug<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span>gb<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">" OnMOuseExit"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<h2 id="lnvoke"><a href="#lnvoke" class="headerlink" title="lnvoke"></a>lnvoke</h2><p>è°ƒç”¨ã€æ‰§è¡Œçš„æ„æ€ã€‚åœ¨åº”ç”¨ç¨‹åºçš„ä¸»çº¿ç¨‹ä¸Šæ‰§è¡ŒæŒ‡å®šçš„<strong>å§”æ‰˜</strong>ã€‚ä¸€èˆ¬åº”ç”¨ï¼šåœ¨è¾…åŠ©çº¿ç¨‹ä¸­ä¿®æ”¹UIçº¿ç¨‹ï¼ˆ ä¸»çº¿ç¨‹ ï¼‰ä¸­å¯¹è±¡çš„å±æ€§æ—¶ã€‚</p>
<p>Invoke(string methodNameï¼Œfloat time):è¾“å…¥ä¸€ä¸ªæ–¹æ³•åç§°ï¼Œè¿‡ä¸ªå‡ ç§’æ¥æ‰§è¡Œä¸€æ¬¡</p>
<p>methodName:æ–¹æ³•åç§°time:å‡ ç§’åæ‰§è¡Œ</p>
<p>InvokeRepeating(string methodNameï¼Œfloat timeï¼Œfloat repeatRate):é‡å¤è°ƒç”¨</p>
<p>methodName :æ–¹æ³•åç§°time :å‡ ç§’åæ‰§è¡Œ</p>
<p>repeatRate:é‡å¤é—´éš”æ—¶é—´</p>
<p>Cancellnvoke(string methodName):å–æ¶ˆè°ƒç”¨ï¼Œä½¿ç”¨æ— å‚é‡è½½å°±æ˜¯å–æ¶ˆå…¨éƒ¨</p>
<h2 id="åç¨‹"><a href="#åç¨‹" class="headerlink" title="åç¨‹"></a>åç¨‹</h2><p>å°±æ˜¯â€œååŒç¨‹åºâ€ï¼Œå¹¶ä¸æ˜¯å¤šçº¿ç¨‹ã€‚</p>
<p>æ—¢ç„¶å«ååŒï¼Œæ‰€ä»¥è¿˜æœ‰ä¸€ä¸ªä¸»ç¨‹åºï¼Œé‚£ä¹ˆè¿™ä¸ªä¸»ç¨‹åºå…¶å®å°±æ˜¯æˆ‘ä»¬çš„ç›®å‰å­¦ä¹ åˆ°çš„å„ç§ç”Ÿå‘½å‘¨æœŸå‡½æ•°</p>
<h3 id="ä¸ºä»€ä¹ˆéœ€è¦åç¨‹"><a href="#ä¸ºä»€ä¹ˆéœ€è¦åç¨‹" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦åç¨‹?"></a>ä¸ºä»€ä¹ˆéœ€è¦åç¨‹?</h3><p>ä¸»ç¨‹åºå·²ç»åœ¨æ‰§è¡ŒæŸä¸ªä»»åŠ¡ï¼Œå¸Œæœ›â€œåŒæ—¶è¿è¡Œâ€å…¶ä»–é€»è¾‘ï¼Œè¿™é‡Œçš„åŒæ—¶ï¼Œå¹¶ä¸æ˜¯å¤šçº¿ç¨‹æ„ä¹‰ä¸Šçš„åŒæ—¶ï¼Œåªæ˜¯æ„Ÿå®˜ä¸Šæ˜¯åŒæ—¶ã€‚</p>
<p><strong>åç¨‹çš„ä½¿ç”¨åœºæ™¯</strong></p>
<p>å¯¹äºä¿è¯ä¸ä¼šé˜»å¡çš„å¹¶è¡Œæ“ä½œä¸”å¹¶è¡Œæ€§è¦æ±‚ä¸é«˜çš„å¹¶è¡Œæ“ä½œï¼Œå¯ä»¥ä½¿ç”¨åç¨‹ã€‚æ›´å®é™…æ¥è¯´ï¼Œåç¨‹æœ€å¸¸ç”¨äºå»¶æ—¶æ‰§è¡Œç­‰æ§åˆ¶æ—¶é—´è½´çš„æ“ä½œï¼Œä¾‹å¦‚1ã€Nç§’åè°ƒç”¨æŒ‡å®šå‡½æ•°ã€‚2ã€ä¸€ä¸ªæ¸¸æˆç‰©ä½“çš„é¢œè‰²æ¸æ¸å˜æ·¡ï¼Œç›´è‡³æ¶ˆå¤±ã€‚3ã€å¼‚æ­¥åŠ è½½èµ„æº</p>
<p>åˆ©ç”¨æ¯å¸§æ‰§è¡Œä¸€æ®µåç¨‹çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å¼•å…¥ä¸ªå¸¦ç´¯åŠ è®¡æ—¶åˆ¤æ–­å¾ªç¯ï¼Œç„¶åå†è¶…è¿‡3ç§’åè·³å‡ºå¾ªç¯ï¼Œæ‰§è¡ŒDebug.Log()</p>
<h3 id="ä¸ºä»€ä¹ˆä¸è€ƒè™‘å¤šçº¿ç¨‹"><a href="#ä¸ºä»€ä¹ˆä¸è€ƒè™‘å¤šçº¿ç¨‹" class="headerlink" title="ä¸ºä»€ä¹ˆä¸è€ƒè™‘å¤šçº¿ç¨‹"></a>ä¸ºä»€ä¹ˆä¸è€ƒè™‘å¤šçº¿ç¨‹</h3><p>å› ä¸ºåœ¨Unityä¸­ï¼Œåªèƒ½åœ¨ä¸»çº¿ç¨‹ä¸­è·å–ç‰©ä½“çš„ç»„ä»¶ã€æ–¹æ³•ã€å¯¹è±¡ï¼Œå¦‚æœè„±ç¦»è¿™äº›ï¼ŒUnityçš„å¾ˆå¤šåŠŸèƒ½æ— æ³•å®ç°ï¼Œé‚£ä¹ˆå¤šçº¿ç¨‹çš„å­˜åœ¨ä¸å¦æ„ä¹‰å°±ä¸å¤§äº†</p>
<h3 id="çº¿ç¨‹ä¸åç¨‹çš„åŒºåˆ«ï¼š"><a href="#çº¿ç¨‹ä¸åç¨‹çš„åŒºåˆ«ï¼š" class="headerlink" title="çº¿ç¨‹ä¸åç¨‹çš„åŒºåˆ«ï¼š"></a>çº¿ç¨‹ä¸åç¨‹çš„åŒºåˆ«ï¼š</h3><ul>
<li>å¯¹äºåç¨‹è€Œè¨€ï¼ŒåŒä¸€æ—¶é—´åªèƒ½æ‰§è¡Œä¸€ä¸ªåç¨‹ï¼Œè€Œçº¿ç¨‹åˆ™æ˜¯å¹¶å‘çš„ï¼Œå¯ä»¥åŒæ—¶æœ‰å¤šä¸ªçº¿ç¨‹åœ¨è¿è¡Œ</li>
<li>ä¸¤è€…åœ¨å†…å­˜çš„ä½¿ç”¨ä¸Šæ˜¯ç›¸åŒçš„ï¼Œå…±äº«å †ï¼Œä¸å…±äº«æ ˆ</li>
<li>åç¨‹è·Ÿå¤šçº¿ç¨‹ç±»ä¼¼ï¼Œä¹Ÿæœ‰ç±»ä¼¼å¼‚æ­¥çš„æ•ˆæœï¼ˆæ³¨æ„ä¸æ˜¯çœŸæ­£çš„å¼‚æ­¥ï¼‰ã€‚åªä¸è¿‡å®ƒçš„åˆ‡åˆ†ç²’åº¦ä¸æ˜¯åŸºäºç³»ç»Ÿåˆ’åˆ†çš„æ—¶é—´ç‰‡ï¼Œè€Œæ˜¯åŸºäºæˆ‘ä»¬ç¼–å†™çš„yieldï¼Œè€Œä¸”å¾€å¾€ç²’åº¦æ›´å¤§ã€‚å› ä¸ºå®ƒçš„ç²’åº¦ç›¸å¯¹å¤šçº¿ç¨‹çš„å¤§å¾ˆå¤šï¼Œæ‰€ä»¥å¾€å¾€å¾ˆå°‘å‡ºç°å†²çªç°è±¡</li>
</ul>
<p>åç¨‹çš„è¿è¡Œé€»è¾‘ä½¿ç”¨</p>
<p>å‡½æ•°å£°æ˜å‰ç¼€IEnumerator</p>
<p>yield return new WaitForSeconds(1.0f) æ¥ç­‰å¾…ã€‚</p>
<p>è°ƒç”¨åç¨‹ Coroutine Cor1 &#x3D; StartCoroutine(Demo()); è¿”å›å€¼ç”¨æ¥æ ‡è¯†ç‰¹å®šçš„åç¨‹ï¼Œå¤šä¸ªåŒååç¨‹å¯åŠ¨æ—¶ä½¿ç”¨</p>
<p>ç»“æŸåç¨‹ StopCoroutine()è¾“å…¥ä¸å»ºè®®ç”¨å­—ç¬¦ä¸²å–æ¶ˆï¼Œè€Œæ˜¯ç”¨ä¸Šé¢çš„Coroutineç±»å‹ä½œä¸ºå‚æ•°å–æ¶ˆç›®æ ‡ã€‚</p>
<p>ä¾‹å¦‚ å¦‚æœæŸä¸€æ—¶åˆ»éœ€è¦ä½¿ç”¨Updateè¯»å–ä¸€ä¸ªåˆ—è¡¨ï¼Œè¿™æ ·ä¸€èˆ¬éœ€è¦ä¸€ä¸ªå¾ªç¯å»éå†åˆ—è¡¨ï¼Œè¿™æ ·æ¯å¸§çš„ä»£ç æ‰§è¡Œé‡å°±æ¯”è¾ƒå¤§ï¼Œå°±å¯ä»¥å°†è¿™æ ·çš„æ‰§è¡Œæ”¾ç½®åˆ°åç¨‹ä¸­æ¥å¤„ç†</p>
<pre class=" language-Csharp"><code class="language-Csharp">public class Test : MonoBehaviour
{
    public List<int> nums = new List<int> { 1, 2, 3, 4, 5, 6 };


    private void Update()
    {
        if(Input.GetKeyDown(KeyCode.Space))
        {
            StartCoroutine(PrintNum(nums));
        }
    }
    //é€šè¿‡åç¨‹åˆ†å¸§å¤„ç†
    IEnumerator PrintNum(List<int> nums)
    {
        foreach(int i in nums)
        {
            Debug.Log(i);
            yield return null;

        }

    }
}
</code></pre>
<h3 id="åº•å±‚å®ç°"><a href="#åº•å±‚å®ç°" class="headerlink" title="åº•å±‚å®ç°"></a>åº•å±‚å®ç°</h3><p><a href="https://zhuanlan.zhihu.com/p/279383752">å®‡äº“ï¼šUnityåç¨‹çš„åŸç†ä¸åº”ç”¨</a></p>
<p>StartCoroutine æ¥å—åˆ°çš„æ˜¯ä¸€ä¸ª IEnumerator ï¼Œè¿™æ˜¯ä¸ªæ¥å£ï¼Œå¹¶ä¸”æ˜¯æšä¸¾å™¨æˆ–è¿­ä»£å™¨çš„æ„æ€ã€‚ å› æ­¤æˆ‘ä»¬å¯ä»¥è¯´åç¨‹æœ¬ä½“æ˜¯ä¸€ä¸ª<strong>C#çš„è¿­ä»£å™¨éå†å‡½æ•°ã€‚</strong></p>
<p>å½“ä¸€ä¸ªæ–¹æ³•çš„è¿”å›å€¼å†™æˆäº†IEnumeratorç±»å‹ï¼Œä»–å°±ä¼šè‡ªåŠ¨è¢«è§£ææˆè¿­ä»£å™¨æ–¹æ³•<em>ï¼ˆåæ–‡ç›´æ¥ç§°ä¹‹ä¸ºåç¨‹ï¼‰</em>ï¼Œä½ è°ƒç”¨æ­¤æ–¹æ³•çš„æ—¶å€™ä¸ä¼šçœŸçš„è¿è¡Œï¼Œè€Œæ˜¯ä¼šè¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼Œéœ€è¦ç”¨MoveNext()æ¥çœŸæ­£çš„è¿è¡Œã€‚</p>
<pre class=" language-Csharp"><code class="language-Csharp">static void Main(string[] args)
{
    IEnumerator it = Test();//ä»…ä»…è¿”å›ä¸€ä¸ªæŒ‡å‘Testçš„è¿­ä»£å™¨ï¼Œä¸ä¼šçœŸçš„æ‰§è¡Œã€‚
    Console.ReadKey();
    it.MoveNext();//æ‰§è¡ŒTestç›´åˆ°é‡åˆ°ç¬¬ä¸€ä¸ªyield
    System.Console.WriteLine(it.Current);//è¾“å‡º1
    Console.ReadKey();
    it.MoveNext();//æ‰§è¡ŒTestç›´åˆ°é‡åˆ°ç¬¬äºŒä¸ªyield
    System.Console.WriteLine(it.Current);//è¾“å‡º2
    Console.ReadKey();
    it.MoveNext();//æ‰§è¡ŒTestç›´åˆ°é‡åˆ°ç¬¬ä¸‰ä¸ªyield
    System.Console.WriteLine(it.Current);//è¾“å‡ºtest3
    Console.ReadKey();
}

static IEnumerator Test()
{
    System.Console.WriteLine("ç¬¬ä¸€æ¬¡æ‰§è¡Œ");
    yield return 1;
    System.Console.WriteLine("ç¬¬äºŒæ¬¡æ‰§è¡Œ");
    yield return 2;
    System.Console.WriteLine("ç¬¬ä¸‰æ¬¡æ‰§è¡Œ");
    yield return "test3";
}
</code></pre>
<p>è°ƒç”¨IEnumerator.MoveNext()æ—¶ä¼šæŠŠåç¨‹æ–¹æ³•ä½“å‹å…¥å½“å‰çš„å‡½æ•°è°ƒç”¨æ ˆä¸­æ‰§è¡Œï¼Œè¿è¡Œåˆ°yield returnåå†å¼¹æ ˆã€‚è¿™ç‚¹å’Œæœ‰äº›è¯­è¨€ä¸­çš„åç¨‹ä¸å¤§ä¸€æ ·ï¼Œæœ‰äº›è¯­è¨€çš„åç¨‹ä¼šç»´æŠ¤ä¸€ä¸ªè‡ªå·±çš„å‡½æ•°è°ƒç”¨æ ˆï¼Œåœ¨å”¤é†’çš„æ—¶å€™ä¼šæŠŠæ•´ä¸ªå‡½æ•°è°ƒç”¨æ ˆç»™æ›¿æ¢ï¼Œè¿™ç±»åç¨‹è¢«ç§°ä¸º<strong>æœ‰æ ˆåç¨‹</strong>ï¼Œè€ŒåƒC#ä¸­è¿™æ ·ç›´æ¥åœ¨å½“å‰å‡½æ•°è°ƒç”¨æ ˆä¸­å‹å…¥æ ˆå¸§çš„åç¨‹æˆ‘ä»¬ç§°ä¹‹ä¸º<strong>æ— æ ˆåç¨‹</strong>ã€‚</p>
<p>yield æ˜¯ C#çš„ä¸€ä¸ªå…³é”®å­—ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªè¯­æ³•ç³–<em>ï¼ˆè¿™ç§è¯­æ³•å¯¹è¯­è¨€çš„åŠŸèƒ½æ²¡æœ‰å½±å“ï¼Œä½†æ˜¯æ›´æ–¹ä¾¿<a href="https://link.zhihu.com/?target=https://zh.wikipedia.org/wiki/%E7%A8%8B%E5%BA%8F%E5%91%98">ç¨‹åºå‘˜</a>ä½¿ç”¨ï¼‰</em>ï¼ŒèƒŒåçš„åŸç†ä¼šç”Ÿæˆä¸€ä¸ªç±»ï¼Œå¹¶ä¸”ä¹Ÿæ˜¯ä¸€ä¸ª<strong>æšä¸¾å™¨</strong>ï¼Œè€Œä¸”ä¸åŒäº returnï¼Œyield å¯ä»¥å‡ºç°å¤šæ¬¡ã€‚ </p>
<p>yield å®é™…ä¸Šå°±æ˜¯è¿”å›ä¸€æ¬¡ç»“æœï¼Œå› ä¸ºæˆ‘ä»¬è¦ä¸€æ¬¡ä¸€æ¬¡æšä¸¾ä¸€ä¸ªå€¼å‡ºæ¥ï¼Œæ‰€ä»¥<strong>å¤šä¸ª yield å…¶å®æ˜¯ä¸ªçŠ¶æ€æ¨¡å¼</strong>ï¼Œç¬¬ä¸€ä¸ª yield æ˜¯çŠ¶æ€ 1ï¼Œç¬¬äºŒä¸ª yield æ˜¯çŠ¶æ€ 2ï¼Œæ¯æ¬¡è®¿é—®æ—¶ä¼šåŸºäºçŠ¶æ€çŸ¥é“å½“å‰åº”è¯¥æ‰§è¡Œå“ªä¸€ä¸ª yieldï¼Œå–å¾—å“ªä¸€ä¸ªå€¼ã€‚ </p>
<p>ä½¿ç”¨è¾ƒå¤šçš„â€œæš‚åœ XX ç§’â€ yield return new WaitForSeconds(0.5f)ï¼Œå…¶å®æœ¬è´¨ä¸Šå°±æ˜¯æ¯ä¸€å¸§éƒ½æ¥æ£€æŸ¥ä¸€æ¬¡æ˜¯å¦æ»¡è¶³äº†è®¡æ—¶æ¡ä»¶ï¼Œå¦‚æœæ»¡è¶³å°±è¯´æ˜ yield çš„çŠ¶æ€æ»¡è¶³äº†ï¼Œ è¿›å…¥ä¸‹ä¸€ä¸ªçŠ¶æ€ï¼Œè‡³äº yield return nullï¼Œä¸ºä»€ä¹ˆä¼šæœ‰æš‚åœä¸€å¸§çš„æ•ˆæœï¼Œå› ä¸ºç›¸å½“äº ä»€ä¹ˆä¹Ÿæ²¡åšï¼Œä½†æ˜¯æ£€æŸ¥éœ€è¦åœ¨ä¸‹ä¸€å¸§è¿›è¡Œã€‚</p>
<h2 id="C-å¼•ç”¨ä¼ é€’-in-ref-out"><a href="#C-å¼•ç”¨ä¼ é€’-in-ref-out" class="headerlink" title="C# å¼•ç”¨ä¼ é€’ in ref out"></a>C# å¼•ç”¨ä¼ é€’ in ref out</h2><pre class=" language-csharp"><code class="language-csharp"><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Swap</span><span class="token punctuation">(</span><span class="token keyword">ref</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span><span class="token keyword">ref</span> <span class="token keyword">int</span> j<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">var</span> temp <span class="token operator">=</span> i<span class="token punctuation">;</span>
        i <span class="token operator">=</span> j<span class="token punctuation">;</span>
        j <span class="token operator">=</span> temp<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
<p>ref ç”¨äºä¼ é€’å¼•ç”¨å€¼ï¼Œæ¯”èµ·C++ç›´æ¥é‡‡ç”¨æŒ‡é’ˆå®ç°ä¼ å€¼æ›´åŠ å®‰å…¨ã€‚å½“é€šè¿‡å¼•ç”¨ä¼ é€’æ—¶ï¼Œä¸ä¼šå¯¹å€¼ç±»å‹è£…ç®±ã€‚å®ƒè®©å½¢å‚æˆä¸ºå®å‚çš„åˆ«åï¼Œè¿™å¿…é¡»æ˜¯å˜é‡ã€‚</p>
<p>in å…³é”®å­—ä¼šå¯¼è‡´æŒ‰å¼•ç”¨ä¼ é€’å‚æ•°ï¼Œä½†ç¡®ä¿æœªä¿®æ”¹å‚æ•°ã€‚ è¿™é€šå¸¸ç”¨äºä¼ é€’ä¸€äº›å·¨å¤§çš„ç»“æ„ä½“ï¼Œå¹¶ä¸”åªè¿›è¡Œè¯»æ“ä½œã€‚</p>
<p>outå…³é”®å­—é€šè¿‡å¼•ç”¨ä¼ é€’å‚æ•°ã€‚ä½œä¸ºoutå‚æ•°ä¼ é€’çš„å˜é‡åœ¨æ–¹æ³•è°ƒç”¨ä¸­ä¼ é€’ä¹‹å‰ä¸å¿…è¿›è¡Œåˆå§‹åŒ–ã€‚ ä½†æ˜¯ï¼Œè¢«è°ƒç”¨çš„æ–¹æ³•éœ€è¦åœ¨è¿”å›ä¹‹å‰èµ‹ä¸€ä¸ªå€¼ã€‚</p>
<h2 id="C-ä¸å®‰å…¨ä»£ç unsafe"><a href="#C-ä¸å®‰å…¨ä»£ç unsafe" class="headerlink" title="C# ä¸å®‰å…¨ä»£ç unsafe"></a>C# ä¸å®‰å…¨ä»£ç unsafe</h2><p>å½“ä¸€ä¸ªä»£ç å—ä½¿ç”¨<strong>unsafe</strong>ä¿®é¥°ç¬¦æ ‡è®°æ—¶ï¼ŒC# å…è®¸åœ¨å‡½æ•°ä¸­ä½¿ç”¨æŒ‡é’ˆå˜é‡ï¼ˆ<strong>æŒ‡é’ˆå˜é‡</strong>å€¼ä¸ºå¦ä¸€ä¸ªå˜é‡çš„åœ°å€ï¼‰ã€‚<strong>ä¸å®‰å…¨ä»£ç </strong>æˆ–éæ‰˜ç®¡ä»£ç æ˜¯æŒ‡ä½¿ç”¨äº†<strong>æŒ‡é’ˆ</strong>å˜é‡çš„ä»£ç å—ã€‚</p>
<h2 id="x3D-gt-çš„ç”¨æ³•"><a href="#x3D-gt-çš„ç”¨æ³•" class="headerlink" title="&#x3D;&gt;çš„ç”¨æ³•"></a>&#x3D;&gt;çš„ç”¨æ³•</h2><p>æœ‰ä¸¤ç§ç”¨æ³•ï¼Œæœ€å¸¸è§çš„æ˜¯1ã€Lambaè¡¨è¾¾å¼çš„ç”¨æ³•è·ŸC++çš„<code>-&gt;</code>ç±»ä¼¼ã€‚</p>
<pre class=" language-Csharp"><code class="language-Csharp">// å£°æ˜ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆçš„å¯¹è±¡, ä¹Ÿå°±æ˜¯å§”æ‰˜, å…¶å‡½æ•°ç­¾åä¸ºstring f(Person)
Func<Person, string> nameProjection = p => p.Name;
 
</code></pre>
<p>ä¹Ÿå¯ä»¥å½“åšä¸€ä¸ªè¯­æ³•ç³–ä½¿ç”¨ï¼Œç”¨æ¥è¡¨ç¤ºæŸä¸ªå–å€¼getï¼Œä¹Ÿå°±æ˜¯expression-bodied membersã€‚ç”¨æ³•ä¸ºï¼š</p>
<pre class=" language-Csharp"><code class="language-Csharp">public int MaxHealth1 => x ? y:z;
//è¿™ä¸ªç­‰åŒäº
public int MaxHealth1
{
    get
    {
        return x ? y:z;
    }
}
</code></pre>
<p>æ˜¯ä¸€ä¸ªPropertyï¼Œè®¾ç½®äº†getterï¼Œæ¯æ¬¡è®¿é—®è¯¥å€¼çš„æ—¶å€™ï¼Œéƒ½ä¼šè°ƒç”¨x?y:zè¡¨è¾¾å¼</p>
]]></content>
      <categories>
        <category>C#</category>
      </categories>
      <tags>
        <tag>C#</tag>
      </tags>
  </entry>
  <entry>
    <title>gitåŸºæœ¬æ“ä½œ</title>
    <url>/2023/01/17/git%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/</url>
    <content><![CDATA[<p>Git å¸¸ç”¨çš„æ˜¯ä»¥ä¸‹ 6 ä¸ªå‘½ä»¤ï¼šgit cloneã€git pushã€git add ã€git commitã€git checkoutã€git pull.<br><img src="https://pic.imgdb.cn/item/63df62d34757feff33131295.jpg"></p>
<h2 id="å¿«é€Ÿå¼€å§‹"><a href="#å¿«é€Ÿå¼€å§‹" class="headerlink" title="å¿«é€Ÿå¼€å§‹"></a>å¿«é€Ÿå¼€å§‹</h2><h3 id="åŸºæœ¬æ“ä½œ"><a href="#åŸºæœ¬æ“ä½œ" class="headerlink" title="åŸºæœ¬æ“ä½œ"></a>åŸºæœ¬æ“ä½œ</h3><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">#åˆå§‹åŒ–ä»“åº“,åœ¨å½“å‰ç›®å½•æ–°å»ºä¸€ä¸ªGitä»£ç åº“</span>
<span class="token function">git</span> init

<span class="token comment" spellcheck="true">#æ·»åŠ å½“å‰æ‰€æœ‰æ–‡ä»¶åˆ°ç¼“å­˜åŒº</span>
<span class="token function">git</span> add <span class="token keyword">.</span>

<span class="token comment" spellcheck="true">#æäº¤æš‚å­˜åŒºä¸­çš„å†…å®¹åˆ°æœ¬åœ°ä»“åº“ -m:æäº¤çš„ä¿¡æ¯</span>
<span class="token function">git</span> commit -m <span class="token string">"ä¿¡æ¯"</span>

<span class="token comment" spellcheck="true">#æœ¬åœ°ä¸è¿œç¨‹ä»“åº“è¿æ¥</span>
<span class="token function">git</span> remote add origin <span class="token operator">&lt;</span>è¿œç¨‹ä»“åº“é“¾æ¥<span class="token operator">></span>

<span class="token comment" spellcheck="true">#å¦‚æœè¿œç¨‹ä»“åº“åˆ›å»ºäº†readmeæ–‡ä»¶ï¼Œå¯ä»¥å…ˆæŠŠè¿œç¨‹ä»“åº“çš„é¡¹ç›®pullä¸‹æ¥</span>
<span class="token function">git</span> pull origin master

<span class="token comment" spellcheck="true">#å°†æœ¬åœ°çš„åˆ†æ”¯ç‰ˆæœ¬ä¸Šä¼ åˆ°è¿œç¨‹å¹¶åˆå¹¶, git push &lt;è¿œç¨‹ä¸»æœºå> &lt;æœ¬åœ°åˆ†æ”¯å>  &lt;è¿œç¨‹åˆ†æ”¯å>, -u å‚æ•°æŒ‡å®šä¸€ä¸ªé»˜è®¤ä¸»æœº</span>
<span class="token function">git</span> push -u origin master
</code></pre>
<h3 id="gitåˆ†æ”¯å¸¸ç”¨å‘½ä»¤"><a href="#gitåˆ†æ”¯å¸¸ç”¨å‘½ä»¤" class="headerlink" title="gitåˆ†æ”¯å¸¸ç”¨å‘½ä»¤"></a>gitåˆ†æ”¯å¸¸ç”¨å‘½ä»¤</h3><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">#åˆ—å‡ºæœ¬åœ°æ‰€æœ‰åˆ†æ”¯</span>
<span class="token function">git</span> branch

<span class="token comment" spellcheck="true">#åˆ—å‡ºæ‰€æœ‰è¿œç¨‹åˆ†æ”¯</span>
<span class="token function">git</span> branch -r

<span class="token comment" spellcheck="true">#æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼Œä½†ä¾ç„¶åœç•™åœ¨å½“å‰åˆ†æ”¯</span>
<span class="token function">git</span> branch åˆ†æ”¯å

<span class="token comment" spellcheck="true">#æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼Œå¹¶åˆ‡æ¢åˆ°è¯¥åˆ†æ”¯</span>
<span class="token function">git</span> checkout -b åˆ†æ”¯å

<span class="token comment" spellcheck="true">#åˆ‡æ¢åˆ†æ”¯</span>
<span class="token function">git</span> checkout åˆ†æ”¯å

<span class="token comment" spellcheck="true">#åˆå¹¶æŒ‡å®šåˆ†æ”¯åˆ°å½“å‰åˆ†æ”¯</span>
<span class="token function">git</span> merge åˆ†æ”¯å

<span class="token comment" spellcheck="true">#åˆ é™¤åˆ†æ”¯</span>
<span class="token function">git</span> branch -d åˆ†æ”¯å

<span class="token comment" spellcheck="true">#åˆ é™¤è¿œç¨‹åˆ†æ”¯</span>
<span class="token function">git</span> push origin --delete åˆ†æ”¯å
<span class="token function">git</span> branch -dr åˆ†æ”¯å
</code></pre>
<h3 id="è¿œç¨‹ä»“åº“æ“ä½œ"><a href="#è¿œç¨‹ä»“åº“æ“ä½œ" class="headerlink" title="è¿œç¨‹ä»“åº“æ“ä½œ"></a>è¿œç¨‹ä»“åº“æ“ä½œ</h3><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">#å…‹éš†ä»“åº“</span>
<span class="token function">git</span> clone <span class="token operator">&lt;</span>repo<span class="token operator">></span>

<span class="token comment" spellcheck="true">#å…‹éš†åˆ°æŒ‡å®šçš„ç›®å½•</span>
<span class="token function">git</span> clone <span class="token operator">&lt;</span>repo<span class="token operator">></span> <span class="token operator">&lt;</span>directory<span class="token operator">></span>

<span class="token comment" spellcheck="true">#æŸ¥çœ‹å½“å‰é…ç½®æœ‰å“ªäº›è¿œç¨‹ä»“åº“</span>
<span class="token function">git</span> remote

<span class="token comment" spellcheck="true">#åŠ ä¸Š -v å‚æ•°ï¼Œå¯ä»¥çœ‹åˆ°æ¯ä¸ªåˆ«åçš„å®é™…é“¾æ¥åœ°å€</span>
<span class="token function">git</span> remote -v

<span class="token comment" spellcheck="true"># æ·»åŠ è¿œç¨‹ä»“åº“ï¼Œshortname(åœ¨æœ¬åœ°ä»“åº“ä¸­å¯¹è¿œç¨‹ä»“åº“èµ·çš„åˆ«å) url(è¿œç¨‹ä»“åº“åœ°å€)</span>
<span class="token function">git</span> remote add <span class="token operator">&lt;</span>shortname<span class="token operator">></span> <span class="token operator">&lt;</span>repo<span class="token operator">></span>

<span class="token comment" spellcheck="true">#ç§»é™¤è¿œç¨‹ä»“åº“å…³è”</span>
<span class="token function">git</span> remote <span class="token function">rm</span> <span class="token operator">&lt;</span>shortname<span class="token operator">></span>

<span class="token comment" spellcheck="true">#ä»è¿œç¨‹ä»“åº“ä¸‹è½½æ–°åˆ†æ”¯ä¸æ•°æ®</span>
<span class="token function">git</span> fetch <span class="token operator">&lt;</span>remote<span class="token operator">></span> <span class="token operator">&lt;</span>branch<span class="token operator">></span>

<span class="token comment" spellcheck="true">#ä»è¿œç«¯ä»“åº“æå–æ•°æ®å¹¶å°è¯•åˆå¹¶åˆ°å½“å‰åˆ†æ”¯</span>
<span class="token function">git</span> merge <span class="token operator">&lt;</span>branch<span class="token operator">></span>
</code></pre>
<h3 id="gité…ç½®"><a href="#gité…ç½®" class="headerlink" title="gité…ç½®"></a>gité…ç½®</h3><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">#æ˜¾ç¤ºå½“å‰çš„ git é…ç½®ä¿¡æ¯</span>
<span class="token function">git</span> config --list

<span class="token comment" spellcheck="true">#ç¼–è¾‘ git é…ç½®æ–‡ä»¶:</span>
<span class="token function">git</span> config -e    <span class="token comment" spellcheck="true"># é’ˆå¯¹å½“å‰ä»“åº“ </span>
<span class="token function">git</span> config -e --global   <span class="token comment" spellcheck="true"># é’ˆå¯¹ç³»ç»Ÿä¸Šæ‰€æœ‰ä»“åº“</span>

<span class="token comment" spellcheck="true">#è®¾ç½®æäº¤ä»£ç æ—¶çš„ç”¨æˆ·ä¿¡æ¯</span>
<span class="token function">git</span> config --global user.name <span class="token string">"xxx"</span>
<span class="token function">git</span> config --global user.email xxxxxxxx@yyyy.com
</code></pre>
]]></content>
      <categories>
        <category>git</category>
      </categories>
      <tags>
        <tag>git</tag>
        <tag>æ•™ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>goè¯­è¨€ä»å…¥é—¨åˆ°æ”¾å¼ƒ</title>
    <url>/2023/01/18/go%E8%AF%AD%E8%A8%80%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/</url>
    <content><![CDATA[<h3 id="ç¬¬ä¸€ä¸ªgoç¨‹åº"><a href="#ç¬¬ä¸€ä¸ªgoç¨‹åº" class="headerlink" title="ç¬¬ä¸€ä¸ªgoç¨‹åº"></a>ç¬¬ä¸€ä¸ªgoç¨‹åº</h3><pre class=" language-go"><code class="language-go"><span class="token keyword">package</span> main
<span class="token keyword">import</span> <span class="token string">"fmt"</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Hello World!"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
]]></content>
      <categories>
        <category>go</category>
      </categories>
      <tags>
        <tag>go</tag>
        <tag>ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>pingä¸é€šå¤–ç½‘çš„è§£å†³æ–¹æ¡ˆ(centos)</title>
    <url>/2023/02/05/ping%E4%B8%8D%E9%80%9A%E5%A4%96%E7%BD%91%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88(centos)/</url>
    <content><![CDATA[<p>ping ä¸é€šå¤–ç½‘ï¼Œç»å¤§éƒ¨åˆ†åŸå› æ˜¯ç”±äºdnsæœåŠ¡å™¨æ²¡æœ‰é…ç½®å¯¼è‡´çš„é—®é¢˜<br><img src="https://pic.imgdb.cn/item/63df62694757feff3312485e.png"></p>
<h3 id="1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶æ·»åŠ DNS"><a href="#1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶æ·»åŠ DNS" class="headerlink" title="1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶æ·»åŠ DNS"></a>1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶æ·»åŠ DNS</h3><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">#xxxä¸ºå¯¹åº”ç½‘å¡</span>
<span class="token function">vi</span> /etc/sysconfig/network-scripts/ifcfg-xxx

<span class="token comment" spellcheck="true">#æ·»åŠ DNS</span>
DNS1<span class="token operator">=</span>114.114.114.114
DNS2<span class="token operator">=</span>8.8.8.8
</code></pre>
<h3 id="2ã€æ·»åŠ DNSæœåŠ¡å™¨"><a href="#2ã€æ·»åŠ DNSæœåŠ¡å™¨" class="headerlink" title="2ã€æ·»åŠ DNSæœåŠ¡å™¨"></a>2ã€æ·»åŠ DNSæœåŠ¡å™¨</h3><pre class=" language-bash"><code class="language-bash"><span class="token function">vi</span> /etc/resolv.conf

<span class="token comment" spellcheck="true">#æ·»åŠ å¦‚ä¸‹ä¸¤è¡Œï¼š</span>
nameserver 8.8.8.8
nameserver 8.8.4.4
</code></pre>
<h3 id="3ã€é‡å¯ç½‘ç»œ"><a href="#3ã€é‡å¯ç½‘ç»œ" class="headerlink" title="3ã€é‡å¯ç½‘ç»œ"></a>3ã€é‡å¯ç½‘ç»œ</h3><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> nmcli c reload

<span class="token comment" spellcheck="true">#æˆ–</span>
systemctl restart network

<span class="token comment" spellcheck="true">#æˆ–</span>
<span class="token function">service</span> network restart
</code></pre>
<h3 id="4ã€å¦‚æœä¸Šè¿°æ“ä½œè¿˜æ˜¯æ²¡æœ‰æˆåŠŸ"><a href="#4ã€å¦‚æœä¸Šè¿°æ“ä½œè¿˜æ˜¯æ²¡æœ‰æˆåŠŸ" class="headerlink" title="4ã€å¦‚æœä¸Šè¿°æ“ä½œè¿˜æ˜¯æ²¡æœ‰æˆåŠŸ"></a>4ã€å¦‚æœä¸Šè¿°æ“ä½œè¿˜æ˜¯æ²¡æœ‰æˆåŠŸ</h3><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">#æ·»åŠ é»˜è®¤ç½‘å…³</span>
<span class="token function">sudo</span> route add default gw 192.168.1.1

<span class="token comment" spellcheck="true">#ç„¶å</span>
<span class="token function">sudo</span> nmcli c reload
</code></pre>
<p>åˆ°æ­¤ä¸€èˆ¬éƒ½æ²¡é—®é¢˜äº†ğŸ˜€</p>
]]></content>
      <categories>
        <category>ç½‘ç»œ</category>
      </categories>
      <tags>
        <tag>centos</tag>
        <tag>linux</tag>
        <tag>ç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>hexoéƒ¨ç½²</title>
    <url>/2024/09/05/hexo%E9%83%A8%E7%BD%B2/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. </p>
<h2 id="å¿«é€Ÿå¼€å§‹"><a href="#å¿«é€Ÿå¼€å§‹" class="headerlink" title="å¿«é€Ÿå¼€å§‹"></a>å¿«é€Ÿå¼€å§‹</h2><h3 id="åˆ›å»ºæ–°æ–‡ç« "><a href="#åˆ›å»ºæ–°æ–‡ç« " class="headerlink" title="åˆ›å»ºæ–°æ–‡ç« "></a>åˆ›å»ºæ–°æ–‡ç« </h3><pre class=" language-bash"><code class="language-bash">hexo new <span class="token string">"My New Post"</span>
</code></pre>
<p><a href="https://hexo.io/docs/writing.html">More</a></p>
<h3 id="å¯åŠ¨æœ¬åœ°æœåŠ¡"><a href="#å¯åŠ¨æœ¬åœ°æœåŠ¡" class="headerlink" title="å¯åŠ¨æœ¬åœ°æœåŠ¡"></a>å¯åŠ¨æœ¬åœ°æœåŠ¡</h3><pre class=" language-bash"><code class="language-bash">hexo server
</code></pre>
<p><a href="https://hexo.io/docs/server.html">More</a></p>
<h3 id="ç”Ÿæˆé™æ€æ–‡ä»¶"><a href="#ç”Ÿæˆé™æ€æ–‡ä»¶" class="headerlink" title="ç”Ÿæˆé™æ€æ–‡ä»¶"></a>ç”Ÿæˆé™æ€æ–‡ä»¶</h3><pre class=" language-bash"><code class="language-bash">hexo generate
</code></pre>
<p><a href="https://hexo.io/docs/generating.html">More</a></p>
<h3 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h3><pre class=" language-bash"><code class="language-bash">hexo deploy
</code></pre>
<p><a href="https://hexo.io/docs/one-command-deployment.html">More</a></p>
<h3 id="è„šæœ¬éƒ¨ç½²-è¿è¡Œ-sh-deploy-sh"><a href="#è„šæœ¬éƒ¨ç½²-è¿è¡Œ-sh-deploy-sh" class="headerlink" title="è„šæœ¬éƒ¨ç½²(è¿è¡Œ sh deploy.sh)"></a>è„šæœ¬éƒ¨ç½²(è¿è¡Œ sh deploy.sh)</h3><pre class=" language-bash"><code class="language-bash">hexo clean

hexo generate

hexo deploy
</code></pre>
]]></content>
      <categories>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>æ•™ç¨‹</tag>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>pveé…ç½®åŠå¸¸è§é—®é¢˜å¤„ç†</title>
    <url>/2023/07/29/pve%E9%85%8D%E7%BD%AE%E5%8F%8A%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86/</url>
    <content><![CDATA[<h1 id="PVEæœåŠ¡å™¨é…ç½®åŠå¸¸è§é—®é¢˜å¤„ç†"><a href="#PVEæœåŠ¡å™¨é…ç½®åŠå¸¸è§é—®é¢˜å¤„ç†" class="headerlink" title="PVEæœåŠ¡å™¨é…ç½®åŠå¸¸è§é—®é¢˜å¤„ç†"></a>PVEæœåŠ¡å™¨é…ç½®åŠå¸¸è§é—®é¢˜å¤„ç†</h1><h2 id="0ã€å¸¸ç”¨å‘½ä»¤"><a href="#0ã€å¸¸ç”¨å‘½ä»¤" class="headerlink" title="0ã€å¸¸ç”¨å‘½ä»¤"></a>0ã€å¸¸ç”¨å‘½ä»¤</h2><pre class=" language-shell"><code class="language-shell">#æŸ¥çœ‹è™šæ‹Ÿæœºåˆ—è¡¨
qm list

#pveé‡å¯
reboot

#æŸ¥çœ‹é›†ç¾¤èµ„æºçŠ¶å†µ
pvesh get /cluster/resources

#å–å¾—è™šæ‹Ÿæœºå½“å‰çŠ¶æ€ `pvesh get /nodes/<èŠ‚ç‚¹id>/qemu/<è™šæ‹Ÿæœºid>/status/current`
pvesh get /nodes/pve/qemu/103/status/current

#å…³é—­è™šæ‹Ÿæœº `pvesh create /nodes/<èŠ‚ç‚¹id>/qemu/<è™šæ‹Ÿæœºid>/status/stop`
pvesh create /nodes/pve/qemu/103/status/stop

#å¯åŠ¨è™šæ‹Ÿæœº `pvesh create /nodes/<èŠ‚ç‚¹id>/qemu/<è™šæ‹Ÿæœºid>/status/start`
pvesh create /nodes/pve/qemu/103/status/start
</code></pre>
<h2 id="1ã€æ–°è£…é…ç½®"><a href="#1ã€æ–°è£…é…ç½®" class="headerlink" title="1ã€æ–°è£…é…ç½®"></a>1ã€æ–°è£…é…ç½®</h2><p>å–æ¶ˆè®¢é˜…</p>
<pre class=" language-shell"><code class="language-shell">sed -i "s/data.status !== 'Active'/false/g" /usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js
</code></pre>
<p>æ›´æ¢æº</p>
<pre class=" language-shell"><code class="language-shell">rm -rf /etc/apt/sources.list.d/pve-enterprise.list

wget http://download.proxmox.com/debian/proxmox-ve-release-6.x.gpg -O /etc/apt/trusted.gpg.d/proxmox-ve-release-6.x.gpg

echo "deb http://download.proxmox.com/debian/pve buster pve-no-subscription" >/etc/apt/sources.list.d/pve-install-repo.list

echo "deb http://mirrors.aliyun.com/debian/ buster main non-free contrib  
deb-src http://mirrors.aliyun.com/debian/ buster main non-free contrib  
deb http://mirrors.aliyun.com/debian-security buster/updates main  
deb-src http://mirrors.aliyun.com/debian-security buster/updates main  
deb http://mirrors.aliyun.com/debian/ buster-updates main non-free contrib  
deb-src http://mirrors.aliyun.com/debian/ buster-updates main non-free contrib  
deb http://mirrors.aliyun.com/debian/ buster-backports main non-free contrib  
deb-src http://mirrors.aliyun.com/debian/ buster-backports main non-free contrib" >/etc/apt/sources.list

apt update
</code></pre>
<p>æ›´æ¢LXCå›½å†…æº</p>
<pre class=" language-shell"><code class="language-shell">grep -rn "download.proxmox.com" /usr/share/perl5/PVE/\* #æŸ¥æ‰¾è®¾å®šä¸‹è½½æºçš„æ–‡ä»¶  
sed -i.bak "s#http://download.proxmox.com/images#https://mirrors.ustc.edu.cn/proxmox/images#g" /usr/share/perl5/PVE/APLInfo.pm  
wget -O /var/lib/pve-manager/apl-info/mirrors.ustc.edu.cn https://mirrors.ustc.edu.cn/proxmox/images/aplinfo-pve-6.dat
</code></pre>
<p>å®‰è£…æ—¶é—´åŒæ­¥æœåŠ¡  </p>
<pre class=" language-shell"><code class="language-shell">apt-get install ntp -y
</code></pre>
<h2 id="2ã€è™šæ‹Ÿæœºè¿ç§»æ—¶éœ€è¦ç¡®è®¤å‡ ä¸ªé—®é¢˜"><a href="#2ã€è™šæ‹Ÿæœºè¿ç§»æ—¶éœ€è¦ç¡®è®¤å‡ ä¸ªé—®é¢˜" class="headerlink" title="2ã€è™šæ‹Ÿæœºè¿ç§»æ—¶éœ€è¦ç¡®è®¤å‡ ä¸ªé—®é¢˜"></a>2ã€è™šæ‹Ÿæœºè¿ç§»æ—¶éœ€è¦ç¡®è®¤å‡ ä¸ªé—®é¢˜</h2><ul>
<li>å…ˆå°†è™šæ‹Ÿæœºçš„ç£ç›˜ é€šè¿‡ç¡¬ä»¶ ä¸­çš„ è¿ç§»ç£ç›˜ ç§»åˆ°å…±äº«ç£ç›˜ä¸­ã€‚  </li>
<li>å†ç”¨è¿ç§»ï¼Œå°†æœåŠ¡è¿ç§»è¿‡å»ã€‚  </li>
<li>è¿ç§»æ—¶éœ€ç¡®è®¤ç¡¬ä»¶ï¼Œç›®æ ‡æœåŠ¡å™¨æ˜¯å¦æ»¡è¶³ç¡¬ç›˜éœ€æ±‚ã€‚ä¸èƒ½æ»¡è¶³çš„éœ€è¦å…ˆè°ƒæ•´ã€‚</li>
</ul>
<h2 id="3ã€ç¡¬ç›˜ç©ºé—´è°ƒå°"><a href="#3ã€ç¡¬ç›˜ç©ºé—´è°ƒå°" class="headerlink" title="3ã€ç¡¬ç›˜ç©ºé—´è°ƒå°"></a>3ã€ç¡¬ç›˜ç©ºé—´è°ƒå°</h2><h4 id="3-1è°ƒæ•´è™šæ‹Ÿæœºç¡¬ç›˜çš„å¤§å°"><a href="#3-1è°ƒæ•´è™šæ‹Ÿæœºç¡¬ç›˜çš„å¤§å°" class="headerlink" title="3.1è°ƒæ•´è™šæ‹Ÿæœºç¡¬ç›˜çš„å¤§å°"></a>3.1è°ƒæ•´è™šæ‹Ÿæœºç¡¬ç›˜çš„å¤§å°</h4><pre class=" language-shell"><code class="language-shell">#æŸ¥çœ‹è™šæ‹Ÿæœºç¡¬ç›˜ä¿¡æ¯
fdisk -l
#æŸ¥çœ‹è™šæ‹Ÿæœºç¡¬ç›˜è·¯å¾„
lvdisplay
#æŸ¥çœ‹è™šæ‹Ÿæœºç¡¬ç›˜å¤§å°  
lvs  
#è°ƒå°è™šæ‹Ÿæœºç¡¬ç›˜2Gï¼Œå¤‡æ³¨ï¼šè°ƒæ•´å‰å…ˆå°†ç³»ç»Ÿå†…çš„ç¡¬ç›˜è°ƒä¸ºæœªåˆ†é…çŠ¶æ€ã€‚  
lvreduce -L -2G /dev/pve/vm-100-disk-0
</code></pre>
<h4 id="3-2å¢åŠ -æˆ–å‡å°-local-ç›®å½•çš„å¤§å°å³æ‰©å®¹"><a href="#3-2å¢åŠ -æˆ–å‡å°-local-ç›®å½•çš„å¤§å°å³æ‰©å®¹" class="headerlink" title="3.2å¢åŠ  æˆ–å‡å° local ç›®å½•çš„å¤§å°å³æ‰©å®¹"></a>3.2å¢åŠ  æˆ–å‡å° local ç›®å½•çš„å¤§å°å³æ‰©å®¹</h4><p>é¦–å…ˆæ‰§è¡Œå‘½ä»¤ <code>fdisk -l</code> ï¼ŒæŸ¥çœ‹&#x2F;dev&#x2F;mapper&#x2F;pve-rootå¤§å°ï¼Œæ˜¾ç¤ºå†…å®¹å¤§æ¦‚å¦‚ä¸‹é¢çš„ï¼š</p>
<pre class=" language-shell"><code class="language-shell">Disk /dev/mapper/pve-root: 4.5 GiB, 4831838208 bytes, 9437184 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
</code></pre>
<p>ç„¶åå¯¹ &#x2F;dev&#x2F;mapper&#x2F;pve-root æ‰©å®¹ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼Œå³å¢åŠ 1Gçš„ç©ºé—´.</p>
<pre class=" language-shell"><code class="language-shell">lvextend -L +1G /dev/mapper/pve-root
</code></pre>
<p>æ‰§è¡Œåå®é™…å¤§å°å…¶å®æ˜¯è¿˜ä¸ä¼šå˜åŒ–çš„,è¿˜éœ€è¦ä¸‹è¾¹çš„å‘½ä»¤, ä½œç”¨æ˜¯æ‰§è¡Œä¸Šè¾¹çš„æ‰©å®¹æ“ä½œ  </p>
<pre class=" language-shell"><code class="language-shell">resize2fs /dev/mapper/pve-root
</code></pre>
<h4 id="3-3å¦‚ä½•è¦åˆ é™¤-local-vm-ç„¶åæŠŠæ‰€æœ‰çš„ç©ºé—´éƒ½ç§»åˆ°-localä¸‹ï¼Œé‚£ä¹ˆå¦‚ä½•æ“ä½œã€‚"><a href="#3-3å¦‚ä½•è¦åˆ é™¤-local-vm-ç„¶åæŠŠæ‰€æœ‰çš„ç©ºé—´éƒ½ç§»åˆ°-localä¸‹ï¼Œé‚£ä¹ˆå¦‚ä½•æ“ä½œã€‚" class="headerlink" title="3.3å¦‚ä½•è¦åˆ é™¤ local-vm ç„¶åæŠŠæ‰€æœ‰çš„ç©ºé—´éƒ½ç§»åˆ° localä¸‹ï¼Œé‚£ä¹ˆå¦‚ä½•æ“ä½œã€‚"></a>3.3å¦‚ä½•è¦åˆ é™¤ local-vm ç„¶åæŠŠæ‰€æœ‰çš„ç©ºé—´éƒ½ç§»åˆ° localä¸‹ï¼Œé‚£ä¹ˆå¦‚ä½•æ“ä½œã€‚</h4><ul>
<li>å…ˆç§»é™¤local-lvmå¯¹åº”çš„é€»è¾‘å·pve&#x2F;data</li>
</ul>
<pre class=" language-shell"><code class="language-shell">lvremove pve/data
</code></pre>
<ul>
<li>å¯¹localå¯¹åº”çš„é€»è¾‘å·&#x2F;dev&#x2F;mapper&#x2F;pve-rootè¿›è¡Œåœ¨çº¿æ‰©å®¹</li>
</ul>
<pre class=" language-shell"><code class="language-shell">lvextend -l +100%FREE -r /dev/mapper/pve-root
</code></pre>
<ul>
<li>æ‰§è¡Œåå®é™…å¤§å°å…¶å®æ˜¯è¿˜ä¸ä¼šå˜åŒ–çš„,è¿˜éœ€è¦ä¸‹è¾¹çš„å‘½ä»¤, ä½œç”¨æ˜¯æ‰§è¡Œä¸Šè¾¹çš„æ‰©å®¹æ“ä½œ</li>
</ul>
<pre class=" language-shell"><code class="language-shell">resize2fs /dev/mapper/pve-root
</code></pre>
<ul>
<li><p>Webä¸­ä¾æ¬¡å±•å¼€æ•°æ®ä¸­å¿ƒ-å­˜å‚¨ï¼Œç¼–è¾‘local-lvmï¼ŒæŠŠlocal-lvmä¸­å¯¹åº”èŠ‚ç‚¹ç§»é™¤å³å¯ã€‚</p>
</li>
<li><p>è¿˜æœ‰åœ¨æ•°æ®ä¸­å¿ƒ-å­˜å‚¨ï¼Œç¼–è¾‘localï¼Œå†…å®¹ä¸‹æ‹‰èœå•ä¸­æŠŠæ‰€æœ‰çš„å†…å®¹éƒ½é€‰ä¸Šï¼Œä»¥ä¾¿è¿™ä¸ªç©ºé—´å¯ä»¥å‚¨å­˜ç£ç›˜æ˜ åƒã€‚</p>
</li>
</ul>
<h2 id="4ã€å¼€å¯PVEåµŒå¥—è™šæ‹ŸåŒ–åŠŸèƒ½"><a href="#4ã€å¼€å¯PVEåµŒå¥—è™šæ‹ŸåŒ–åŠŸèƒ½" class="headerlink" title="4ã€å¼€å¯PVEåµŒå¥—è™šæ‹ŸåŒ–åŠŸèƒ½"></a>4ã€å¼€å¯PVEåµŒå¥—è™šæ‹ŸåŒ–åŠŸèƒ½</h2><p>é€šè¿‡å‘½ä»¤æ£€éªŒåµŒå¥—è™šæ‹ŸåŒ–åŠŸèƒ½æ˜¯å¦å·²è¢«å¼€å¯ï¼š</p>
<pre class=" language-shell"><code class="language-shell">vim /sys/module/kvm\_intel/parameters/nested
</code></pre>
<p>å¼€å¯å†…æ ¸æ”¯æŒï¼š</p>
<pre class=" language-shell"><code class="language-shell">modprobe -r kvm\_intel  
modprobe kvm\_intel nested=1
</code></pre>
<p>ç°åœ¨å†çœ‹çœ‹nestedæ˜¯å¦å·²å¼€å¯ï¼š</p>
<pre class=" language-shell"><code class="language-shell">cat /sys/module/kvm\_intel/parameters/nested
Y
</code></pre>
<p>ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š</p>
<pre class=" language-shell"><code class="language-shell">echo "options kvm\_intel nested=1" >>/etc/modprobe.d/modprobe.conf
</code></pre>
<h2 id="5ã€æŸ¥çœ‹å’Œå…³é—­è™šæ‹Ÿæœº"><a href="#5ã€æŸ¥çœ‹å’Œå…³é—­è™šæ‹Ÿæœº" class="headerlink" title="5ã€æŸ¥çœ‹å’Œå…³é—­è™šæ‹Ÿæœº"></a>5ã€æŸ¥çœ‹å’Œå…³é—­è™šæ‹Ÿæœº</h2><pre class=" language-shell"><code class="language-shell">#åˆ—å‡ºæ‰€æœ‰è™šæ‹Ÿæœºï¼š
qm list
#å…³é—­è™šæ‹Ÿæœºï¼š
qm stop
</code></pre>
<h2 id="6ã€é•œåƒè½¬æ¢"><a href="#6ã€é•œåƒè½¬æ¢" class="headerlink" title="6ã€é•œåƒè½¬æ¢"></a>6ã€é•œåƒè½¬æ¢</h2><pre class=" language-shell"><code class="language-shell">qemu-img convert disk.qcow2 disk.vmdk
</code></pre>
<h2 id="7ã€è¿ç§»ç›¸å…³è®¾ç½®"><a href="#7ã€è¿ç§»ç›¸å…³è®¾ç½®" class="headerlink" title="7ã€è¿ç§»ç›¸å…³è®¾ç½®"></a>7ã€è¿ç§»ç›¸å…³è®¾ç½®</h2><p>PVEè¿ç§»çš„ç±»å‹åˆ†åŠ å¯†ï¼ˆsecureï¼‰æˆ–ä¸åŠ å¯†ï¼ˆinsecureï¼‰<br>secureè¿ç§»  </p>
<blockquote>
<p>ä¼˜ç‚¹ï¼šä¿¡æ¯å®‰å…¨ï¼ŒåŠ å¯†è¿ç§»<br>ç¼ºç‚¹ï¼šéå¸¸è€—è´¹hostä¸»æœºçš„CPUèµ„æºï¼Œä¸”è¿ç§»é€Ÿåº¦æ…¢  </p>
</blockquote>
<p>insecureè¿ç§»  </p>
<blockquote>
<p>ä¼˜ç‚¹ï¼šè¿ç§»é€Ÿåº¦å¿«ï¼Œå¯¹hostä¸»æœºçš„èµ„æºæ¶ˆè€—å°<br>ç¼ºç‚¹ï¼šä¸æ˜¯åŠ å¯†è¿ç§»ï¼Œä¿¡æ¯å®‰å…¨éœ€è¦è€ƒè™‘  </p>
</blockquote>
<p>å¦‚æœåœ¨ç½‘ç»œå®Œå…¨è‡ªä¸»å¯æ§çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥è€ƒè™‘insecureè¿ç§»</p>
<p>è¿ç§»ç±»å‹åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®ï¼Œwebæ§åˆ¶å°æ— æ³•è®¾ç½®<br>è¿›å…¥ä»»æ„hostèŠ‚ç‚¹â€”-shell  </p>
<pre class=" language-shell"><code class="language-shell">root@m71:~# cat /etc/pve/datacenter.cfg
keyboard: en-us
migration: network=172.18.171.71/24,type=insecure
typeå¯ä»¥è®¾ç½®ä¸º åŠ å¯†secureï¼ˆé»˜è®¤ï¼‰ä¸åŠ å¯†insecure
</code></pre>
<h2 id="8ã€é—®é¢˜å¤„ç†"><a href="#8ã€é—®é¢˜å¤„ç†" class="headerlink" title="8ã€é—®é¢˜å¤„ç†"></a>8ã€é—®é¢˜å¤„ç†</h2><h4 id="8-1ã€è¿ç§»æ—¶æç¤ºè®¤è¯å¤±è´¥æ—¶"><a href="#8-1ã€è¿ç§»æ—¶æç¤ºè®¤è¯å¤±è´¥æ—¶" class="headerlink" title="8.1ã€è¿ç§»æ—¶æç¤ºè®¤è¯å¤±è´¥æ—¶"></a>8.1ã€è¿ç§»æ—¶æç¤ºè®¤è¯å¤±è´¥æ—¶</h4><blockquote>
<p>Host key verification failed.</p>
</blockquote>
<p>åœ¨æ§åˆ¶å°è¿è¡Œå¦‚ä¸‹  </p>
<pre class=" language-shell"><code class="language-shell">/usr/bin/ssh -e none -o 'HostKeyAlias=pve1' root@192.168.3.241 /bin/true

ssh 192.168.3.241
</code></pre>
<h4 id="8-2ã€PVEä¸‹qm-stopæç¤ºè¶…æ—¶çš„è§£å†³åŠæ³•"><a href="#8-2ã€PVEä¸‹qm-stopæç¤ºè¶…æ—¶çš„è§£å†³åŠæ³•" class="headerlink" title="8.2ã€PVEä¸‹qm stopæç¤ºè¶…æ—¶çš„è§£å†³åŠæ³•"></a>8.2ã€PVEä¸‹qm stopæç¤ºè¶…æ—¶çš„è§£å†³åŠæ³•</h4><blockquote>
<p>TASK ERROR: canâ€™t lock file â€˜&#x2F;var&#x2F;lock&#x2F;qemu-server&#x2F;lock-108.confâ€™ - got timeout</p>
</blockquote>
<p>rm è¯¥æ–‡ä»¶å°±å¯ä»¥äº†ã€‚</p>
<ul>
<li><p>å…ˆåœ¨shellé‡Œè¾“å…¥ <code>rm /var/lock/qemu-server/lock-108.conf</code> #108æ˜¯ä½ çš„è™šæ‹Ÿæœºç¼–å·</p>
</li>
<li><p>å†è¾“å…¥<code>qm stop 108</code> å°±å¯ä»¥ç«‹å³å…³é—­ä½ çš„108å·è™šæ‹Ÿæœºäº†</p>
</li>
</ul>
<h4 id="8-3ã€è™šæ‹Ÿæœºå­˜æ”¾è·¯å¾„"><a href="#8-3ã€è™šæ‹Ÿæœºå­˜æ”¾è·¯å¾„" class="headerlink" title="8.3ã€è™šæ‹Ÿæœºå­˜æ”¾è·¯å¾„"></a>8.3ã€è™šæ‹Ÿæœºå­˜æ”¾è·¯å¾„</h4><blockquote>
<p>isoå­˜æ”¾è·¯å¾„ï¼š <code>/var/lib/vz/template/iso/</code></p>
</blockquote>
<blockquote>
<p>å¤‡ä»½è·¯å¾„ï¼š <code>/var/lib/vz/dump/æ–‡ç« åœ°å€https://www.yii666.com/blog/469212.html</code></p>
</blockquote>
<blockquote>
<p>local è·¯å¾„ï¼š<code>/var/lib/vz/images/</code></p>
</blockquote>
<blockquote>
<p>local-vm è·¯å¾„ï¼š <code>/dev/pve/</code></p>
</blockquote>
<blockquote>
<p>è™šæ‹Ÿæœºé…ç½®æ–‡ä»¶è·¯å¾„ï¼š <code>/etc/pve/</code></p>
</blockquote>
<blockquote>
<p>é›†ç¾¤ä¸­è™šæ‹Ÿæœºé…ç½®æ–‡ä»¶è·¯å¾„ï¼š <code>/etc/pve/nodes/pveï¼ˆpveä¸ºèŠ‚ç‚¹åç§°ï¼‰/qemu-server/</code></p>
</blockquote>
<h4 id="8-4ã€æœ¬æœºç¡¬ç›˜æ ¼å¼æ˜¯lvmï¼Œæ–°åŠ ç¡¬ç›˜æƒ³ä½¿ç”¨zfsæ ¼å¼ï¼Œé‚£ä¹ˆè¯·ä¸€å®šè¦å…³é—­swapã€‚-å‘½ä»¤ä¸º-swapoff-a-å¦åˆ™zfsä¼šå‘ç”Ÿå¾ˆæ€ªå¼‚çš„äº‹æƒ…"><a href="#8-4ã€æœ¬æœºç¡¬ç›˜æ ¼å¼æ˜¯lvmï¼Œæ–°åŠ ç¡¬ç›˜æƒ³ä½¿ç”¨zfsæ ¼å¼ï¼Œé‚£ä¹ˆè¯·ä¸€å®šè¦å…³é—­swapã€‚-å‘½ä»¤ä¸º-swapoff-a-å¦åˆ™zfsä¼šå‘ç”Ÿå¾ˆæ€ªå¼‚çš„äº‹æƒ…" class="headerlink" title="8.4ã€æœ¬æœºç¡¬ç›˜æ ¼å¼æ˜¯lvmï¼Œæ–°åŠ ç¡¬ç›˜æƒ³ä½¿ç”¨zfsæ ¼å¼ï¼Œé‚£ä¹ˆè¯·ä¸€å®šè¦å…³é—­swapã€‚ å‘½ä»¤ä¸º swapoff -a ,å¦åˆ™zfsä¼šå‘ç”Ÿå¾ˆæ€ªå¼‚çš„äº‹æƒ…."></a>8.4ã€æœ¬æœºç¡¬ç›˜æ ¼å¼æ˜¯lvmï¼Œæ–°åŠ ç¡¬ç›˜æƒ³ä½¿ç”¨zfsæ ¼å¼ï¼Œé‚£ä¹ˆè¯·ä¸€å®šè¦å…³é—­swapã€‚ å‘½ä»¤ä¸º <code>swapoff -a</code> ,å¦åˆ™zfsä¼šå‘ç”Ÿå¾ˆæ€ªå¼‚çš„äº‹æƒ….</h4><h4 id="8-5ã€è™šæ‹Ÿæœºå‡ºç°é—®é¢˜çŠ¶æ€ä¸ºunkonwçš„è§£å†³æ–¹æ³•"><a href="#8-5ã€è™šæ‹Ÿæœºå‡ºç°é—®é¢˜çŠ¶æ€ä¸ºunkonwçš„è§£å†³æ–¹æ³•" class="headerlink" title="8.5ã€è™šæ‹Ÿæœºå‡ºç°é—®é¢˜çŠ¶æ€ä¸ºunkonwçš„è§£å†³æ–¹æ³•"></a>8.5ã€è™šæ‹Ÿæœºå‡ºç°é—®é¢˜çŠ¶æ€ä¸ºunkonwçš„è§£å†³æ–¹æ³•</h4><pre class=" language-shell"><code class="language-shell">service rrdcached stop 

rm -rf /var/lib/rrdcached/* 

service rrdcached start
</code></pre>
]]></content>
      <categories>
        <category>pve</category>
      </categories>
      <tags>
        <tag>æ•™ç¨‹</tag>
        <tag>pve</tag>
      </tags>
  </entry>
  <entry>
    <title>å¤šçº¿ç¨‹</title>
    <url>/2024/09/05/%E5%A4%9A%E7%BA%BF%E7%A8%8B/</url>
    <content><![CDATA[<meta name="referrer" content="no-referrer">

<h2 id="CPUå¯„å­˜å™¨"><a href="#CPUå¯„å­˜å™¨" class="headerlink" title="CPUå¯„å­˜å™¨"></a>CPUå¯„å­˜å™¨</h2><p>CPUå¯„å­˜å™¨æ˜¯CPUå†…éƒ¨ç”¨æ¥å­˜æ”¾æ•°æ®çš„ä¸€äº›å°å‹å­˜å‚¨åŒºåŸŸï¼Œæš‚æ—¶å­˜æ”¾å‚ä¸è¿ç®—çš„æ•°æ®å’Œè¿ç®—çš„ç»“æœä»¥åŠä¸€äº›CPUè¿è¡Œæ‰€éœ€è¦çš„ä¿¡æ¯ã€‚</p>
<h2 id="åŸç”Ÿçº¿ç¨‹-x2F-æ‰˜ç®¡çº¿ç¨‹"><a href="#åŸç”Ÿçº¿ç¨‹-x2F-æ‰˜ç®¡çº¿ç¨‹" class="headerlink" title="åŸç”Ÿçº¿ç¨‹&#x2F;æ‰˜ç®¡çº¿ç¨‹"></a>åŸç”Ÿçº¿ç¨‹&#x2F;æ‰˜ç®¡çº¿ç¨‹</h2><blockquote>
<p>åŸç”Ÿçº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿç®¡ç†çš„çº¿ç¨‹ã€‚CPUéƒ½æœ‰é€»è¾‘æ ¸å¿ƒï¼Œæ¯ä¸ªæ ¸å¿ƒéƒ½æœ‰å¤šä¸ªå¯„å­˜å™¨ï¼Œæ¯ä¸€ä¸ªé€»è¾‘æ ¸å¿ƒéƒ½ ä¼šæ ¹æ®ç¨‹åºçš„å¯„å­˜å™¨ä»å†…å­˜ä¸­å»è¯»å–æŒ‡ä»¤ï¼Œå•ä¸ªé€»è¾‘æ ¸å¿ƒåœ¨åŒä¸€æ—¶é—´åªèƒ½æ‰§è¡Œä¸€æ®µæœºå™¨ç ï¼Œæœºå™¨ç å°± æ˜¯æŸä¸ªä»»åŠ¡çš„å¤„ç†å†…å®¹ï¼Œå•ä¸ªé€»è¾‘æ ¸å¿ƒåœ¨åŒä¸€æ—¶é—´åªèƒ½æ‰§è¡Œä¸€ä¸ªçº¿ç¨‹ï¼Œé‚£ä¹ˆéœ€è¦å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿è¡Œçš„ æ•ˆæœï¼Œå°±éœ€è¦åœ¨è¿™ä¸ªé€»è¾‘æ ¸å¿ƒä¸Šå»è½®æµè¿è¡Œï¼Œå¹¶ä¸”æ¯ä¸€ä¸ªçº¿ç¨‹åªèƒ½å¤Ÿè¿è¡Œä¸€æ®µå¾ˆçŸ­çš„æ—¶é—´ï¼Œç„¶åå°±å½¢ æˆäº†å¤šçº¿ç¨‹çš„æ•ˆæœï¼Œå…¶ä¸­è½®æµè¿è¡Œå°±æ˜¯çº¿ç¨‹åˆ‡æ¢ã€‚</p>
</blockquote>
<blockquote>
<p>æ‰˜ç®¡çº¿ç¨‹æ˜¯åŸºäºåŸç”Ÿçº¿ç¨‹åˆ›å»ºçš„çº¿ç¨‹æ¨¡å‹ï¼Œæ˜¯ç”±.NETç®¡ç†çš„çº¿ç¨‹ã€‚ä¸€ä¸ªæ‰˜ç®¡çº¿ç¨‹åªèƒ½è¿è¡Œä¸€ä¸ªåŸç”Ÿçº¿ ç¨‹ã€‚</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/d31c086c1a3b4b04a62d14e30677e30c.png" alt="d31c086c1a3b4b04a62d14e30677e30c.png"></p>
<h2 id="ä¸»åŠ¨åˆ‡æ¢-x2F-è¢«åŠ¨åˆ‡æ¢-x2F-ä¸Šä¸‹æ–‡-x2F-ä¸Šä¸‹æ–‡åˆ‡æ¢-x2F-çº¿ç¨‹è°ƒåº¦-x2F-æ ˆç©ºé—´"><a href="#ä¸»åŠ¨åˆ‡æ¢-x2F-è¢«åŠ¨åˆ‡æ¢-x2F-ä¸Šä¸‹æ–‡-x2F-ä¸Šä¸‹æ–‡åˆ‡æ¢-x2F-çº¿ç¨‹è°ƒåº¦-x2F-æ ˆç©ºé—´" class="headerlink" title="ä¸»åŠ¨åˆ‡æ¢&#x2F;è¢«åŠ¨åˆ‡æ¢&#x2F;ä¸Šä¸‹æ–‡&#x2F;ä¸Šä¸‹æ–‡åˆ‡æ¢&#x2F;çº¿ç¨‹è°ƒåº¦&#x2F;æ ˆç©ºé—´"></a>ä¸»åŠ¨åˆ‡æ¢&#x2F;è¢«åŠ¨åˆ‡æ¢&#x2F;ä¸Šä¸‹æ–‡&#x2F;ä¸Šä¸‹æ–‡åˆ‡æ¢&#x2F;çº¿ç¨‹è°ƒåº¦&#x2F;æ ˆç©ºé—´</h2><blockquote>
<p>ä¸»åŠ¨åˆ‡æ¢æ˜¯çº¿ç¨‹å¯¹åº”çš„ä»»åŠ¡ä¸»åŠ¨è¦æ±‚æš‚åœçº¿ç¨‹ï¼Œæ¯”å¦‚è¯´çº¿ç¨‹é”è¢«å…¶å®ƒçº¿ç¨‹è·å–äº†ï¼Œè¿™æ—¶å€™ä»»åŠ¡ä¼šä¸»åŠ¨ è¦æ±‚æš‚åœçº¿ç¨‹ï¼Œä¸€ç›´åˆ°é”é‡Šæ”¾æ‰ç»§ç»­ã€‚å¦‚æœè¯»å–æ–‡ä»¶æ—¶è¦ç­‰å¾…ç£ç›˜çš„å“åº”ï¼Œé‚£ä¹ˆè¿™ä¸ªä»»åŠ¡ä¹Ÿä¼šè¦æ±‚å» æš‚åœçº¿ç¨‹çš„è¿è¡Œã€‚</p>
</blockquote>
<blockquote>
<p>è¢«åŠ¨åˆ‡æ¢æ˜¯çº¿ç¨‹è¿è¡Œè¶…è¿‡äº†ä¸€å®šæ—¶é—´åï¼Œæ“ä½œç³»ç»Ÿä¼šå¼ºåˆ¶åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™ç§å¼ºåˆ¶åˆ‡æ¢çš„æ¨¡å¼å« åšæŠ¢å æ¨¡å¼ï¼Œçº¿ç¨‹åœ¨æŠ¢å ä¹‹å‰è¢«è¿è¡Œçš„æœ€å¤§æ—¶é—´å«åšæ—¶é—´ç‰‡ï¼Œè¿™ç§æŠ¢å æœºåˆ¶æ˜¯åŸºäºç¡¬ä»¶è®¡æ—¶å™¨æ¥å®ç°çš„ã€‚</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/65ad400628354af3889863f2efab1091.png" alt="65ad400628354af3889863f2efab1091.png"></p>
<blockquote>
<p>ä¸Šä¸‹æ–‡æ˜¯CPUä¸­å„ä¸ªå¯„å­˜å™¨çš„å€¼ã€‚<br>ä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯çº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢ã€‚æœ¬è´¨ä¸Šå…¶å®å°±æ˜¯ä¿å­˜äº†å½“å‰å¯„å­˜å™¨çš„å€¼åˆ°åˆ‡æ¢å‰çš„çº¿ç¨‹å…³è”çš„ä¸Šä¸‹æ–‡ æ•°æ®ä¸­ï¼Œç„¶åä»åˆ‡æ¢åçš„çº¿ç¨‹å…³è”çš„ä¸Šä¸‹æ–‡æ•°æ®ä¸­è¯»å–å€¼åˆ°å¯„å­˜å™¨ä¸­ã€‚</p>
</blockquote>
<blockquote>
<p>çº¿ç¨‹è°ƒåº¦æ˜¯è´Ÿè´£å®‰æ’å¾…è¿è¡Œé˜Ÿåˆ—ä¸­çš„çº¿ç¨‹åœ¨é€»è¾‘æ ¸å¿ƒä¸Šè½®æµæ‰§è¡Œï¼ŒæŠŠç­‰å¾…ä¸å¯ç”¨èµ„æºçš„çº¿ç¨‹æ”¾å…¥åˆ°èµ„ æºå¯¹åº”çš„ç­‰å¾…çº¿ç¨‹é˜Ÿåˆ—ä¸­ï¼Œå½“èµ„æºå¯ç”¨åï¼Œå†æŠŠç­‰å¾…çš„çº¿ç¨‹æ”¾å…¥åˆ°çº¿ç¨‹é˜Ÿåˆ—ã€‚</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/3d1ecca0a9c44110aced8f136a90e15b.png" alt="3d1ecca0a9c44110aced8f136a90e15b.png"></p>
<blockquote>
<p>æ ˆç©ºé—´æ˜¯æ¯ä¸€ä¸ªåŸç”Ÿçº¿ç¨‹éƒ½éœ€è¦åœ¨å†…å­˜ä¸­å»ä½¿ç”¨çš„ä¸€å—ç©ºé—´ã€‚æ ˆç©ºé—´ä¸»è¦ç”¨é€”å°±æ˜¯ç”¨æ¥ä¿å­˜å‡½æ•°ä½¿ç”¨ çš„æ•°æ®ï¼Œæ¯”å¦‚å‚æ•°ï¼Œæœ¬åœ°å˜é‡ï¼Œåœ°å€ç­‰ç­‰ã€‚æ ˆç©ºé—´æœ€å¤§åœ°å€ç§°ä¸ºæ ˆåº•ï¼Œæœ€å°åœ°å€ç§°ä¸ºæ ˆè¾¹ç•Œï¼Œæœ€åä¸€ ä¸ªè¢«æ·»åŠ åˆ°æ ˆçš„å…ƒç´ çš„æ‰€åœ¨åœ°å€ï¼Œå«åšæ ˆé¡¶ã€‚æ ˆé¡¶çš„åœ°å€æ˜¯ä¿å­˜åœ¨æ ˆå¯„å­˜å™¨ä¸­çš„ä¹Ÿå°±æ˜¯RSPå¯„å­˜å™¨ï¼Œ å¦‚æœæ˜¯X86å°±æ˜¯ESPã€‚æ ˆåº•å’Œæ ˆè¾¹ç•Œçš„åœ°å€ä¿å­˜åœ¨æ“ä½œç³»ç»Ÿç®¡ç†çš„åŸç”Ÿçº¿ç¨‹å¯¹è±¡ä¸­ã€‚ç”±äºæ ˆå¯„å­˜å™¨å± äºä¸Šä¸‹æ–‡çš„ä¸€éƒ¨åˆ†ï¼Œåœ¨ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ—¶å€™è¿™ä¸ªä¸Šä¸‹æ–‡ä¹Ÿä¼šè¢«åŒæ—¶åˆ‡æ¢ã€‚<br>æ ˆç©ºé—´å­˜å‚¨è‡ªå·±çš„æ•°æ®ã€‚</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/18bd202362904604a54fed10dc31cf3b.png" alt="18bd202362904604a54fed10dc31cf3b.png"></p>
<blockquote>
<p>æŠ¢å æ¨¡å¼&#x2F;åˆä½œæ¨¡å¼<br>å¤„äºæŠ¢å æ¨¡å¼çš„çº¿ç¨‹ä¸èƒ½è®¿é—®æ‰˜ç®¡å †ä¸Šé¢çš„å¯¹è±¡ï¼Œå¿…é¡»ç­‰å¾…GCç»“æŸï¼Œåˆ‡æ¢åˆ°åˆä½œæ¨¡å¼ã€‚<br>å¤„äºåˆä½œæ¨¡å¼çš„çº¿ç¨‹å¯ä»¥è‡ªç”±è®¿é—®æ‰˜ç®¡å †ä¸Šé¢çš„å¯¹è±¡ã€‚<br>æ‰˜ç®¡ä»£ç éƒ½æ˜¯åœ¨åˆä½œæ¨¡å¼ä¸‹çš„ï¼Œéæ‰˜ç®¡ä»£ç æ˜¯æ²¡æœ‰è¿™ä¸ªé™åˆ¶çš„ã€‚<br>ä¸€æ—¦è¿›å…¥æŠ¢å æ¨¡å¼ï¼Œæ‰˜ç®¡ä»£ç å°±ä¼šåœæ­¢è¿è¡Œï¼Œéæ‰˜ç®¡ä»£ç ä¼šç»§ç»­è¿è¡Œä½†æ˜¯åªèƒ½åšå’Œ.NETå¯¹è±¡æ— å…³çš„å¤„ç†ã€‚</p>
</blockquote>
<blockquote>
<p>ä¸ºä»€ä¹ˆè¦æœ‰æŠ¢å æ¨¡å¼å’Œåˆä½œæ¨¡å¼<br>GCè¦æ‰¾å‡ºæ‰€æœ‰å­˜æ´»çš„å¯¹è±¡ï¼Œæ¸…ç†æ²¡æœ‰å¼•ç”¨çš„å¯¹è±¡ã€‚è´Ÿè´£æ‰§è¡Œæ‰«æä¸æ¸…ç†å¯¹è±¡çš„GCçº¿ç¨‹å’Œè´Ÿè´£åˆ†é…å¯¹ è±¡æˆ–è€…æ”¹å˜å¯¹è±¡å¼•ç”¨å…³ç³»çš„å…¶å®ƒçº¿ç¨‹åŒæ—¶è¿è¡Œï¼Œå¦‚æœGCçº¿ç¨‹åœ¨æ¸…ç†ä¸€ä¸ªæ²¡æœ‰å¼•ç”¨çš„å¯¹è±¡ï¼Œé‚£ä¹ˆæ­£å¥½è¿™ ä¸ªæ—¶å€™æœ‰ä¸€ä¸ªçº¿ç¨‹å»æ”¹å˜è¿™ä¸ªå¼•ç”¨å¯¹è±¡ï¼Œå°±ä¼šå‘ç”Ÿå†²çªã€‚<br>æ‰€ä»¥åœ¨GCè¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦åœæ­¢å…¶å®ƒçº¿ç¨‹çš„è¿è¡Œï¼Œä»¥ä¿è¯å¯¹è±¡é—´å¼•ç”¨å…³ç³»åœ¨GCçš„è¿è¡Œä¸­ä¸ä¼šæ”¹å˜ã€‚ ä½†æ˜¯ä»¥è¿™ç§ç²—æš´çš„æ–¹å¼æ¥åœæ­¢çº¿ç¨‹ä¼šå¸¦æ¥å¾ˆå¤šé—®é¢˜ã€‚æ¯”å¦‚æŸä¸ªçº¿ç¨‹è·å–äº†æŸä¸€ä¸ª.NETè¿è¡Œæ—¶å†…éƒ¨çº¿ç¨‹ é”åå˜æˆäº†åœæ­¢çŠ¶æ€ï¼Œç„¶åGCçº¿ç¨‹å†å¤„ç†è¿‡ç¨‹ä¸­éœ€è¦è·å–åŒä¸€ä¸ªé”ï¼Œé‚£ä¹ˆè¿™æ—¶å€™å°±ä¼šå¯¼è‡´æ­»é”å‘ ç”Ÿã€‚.NETä¸ºäº†è®©çº¿ç¨‹å¯ä»¥æ›´å®‰å…¨çš„é…åˆGCå·¥ä½œï¼Œå°±å¼•ç”¨äº†æŠ¢å æ¨¡å¼å’Œåˆä½œæ¨¡å¼ã€‚GCä¼šæ ¹æ®éœ€è¦å»åˆ‡ æ¢åˆ°ä¸åŒçš„æ¨¡å¼ã€‚<br>GCåœ¨åœæ­¢å…¶å®ƒçº¿ç¨‹è¿è¡Œçš„è¿‡ç¨‹å°±æ˜¯GCåœ¨åˆ‡æ¢æŸä¸ªçº¿ç¨‹åˆ°æŠ¢å æ¨¡å¼ã€‚<br>GCæ¢å¤æŸä¸ªçº¿ç¨‹è¿è¡Œçš„è¿‡ç¨‹å°±æ˜¯GCåœ¨åˆ‡æ¢æŸä¸ªçº¿ç¨‹åˆ°åˆä½œæ¨¡å¼ã€‚</p>
</blockquote>
<blockquote>
<p>GCå®‰å…¨ç‚¹<br>JITç¼–è¯‘å™¨åœ¨ç”Ÿæˆæ‰˜ç®¡å‡½æ•°æ±‡ç¼–ä»£ç çš„æ—¶å€™ä¼šåŒæ—¶ç”Ÿæˆå…ƒæ•°æ®ï¼Œè¿™ä¸ªå…ƒæ•°æ®ä¸­åŒ…å«äº†GCä¿¡æ¯ï¼Œè¿™ä¸ªGCä¿¡æ¯ä¸­åŒ…å«äº†æŸä¸ªçº¿ç¨‹è¿è¡Œåˆ°æŸæ¡æŒ‡ä»¤æ—¶å“ªäº›ä½ç½®æœ‰å¼•ç”¨ç±»å‹çš„å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡ä¼šä½œä¸ºæ ¹å¯¹è±¡æ‰«æã€‚å› ä¸ºåŒ…å«çš„å¼•ç”¨ç±»å‹å¯¹è±¡ä½ç½®åœ¨è¿è¡Œçš„è¿‡ç¨‹ä¸­å¯èƒ½ä¼šä¸æ–­çš„æ”¹å˜ï¼Œå¦‚æœè¦é’ˆå¯¹æ¯ä¸€æ¡æ±‡ç¼–æŒ‡ä»¤éƒ½ç”Ÿäº§ä¸€æ¡GCä¿¡æ¯ä¼šæ¶ˆè€—å¾ˆå¤šçš„èµ„æºï¼Œæ‰€ä»¥JITç¼–è¯‘å™¨åœ¨ç”Ÿäº§GCä¿¡æ¯çš„æ—¶å€™æ˜¯éƒ¨åˆ†é€‰æ‹©ç”Ÿæˆï¼Œè¿™äº›è¢«æŒ‘é€‰çš„éƒ¨åˆ†å°±æ˜¯GCå®‰å…¨ç‚¹ã€‚å¦‚æœæœ‰ä¸€ä¸ªæ‰˜ç®¡å‡½æ•°çš„æŒ‡ä»¤éƒ½ç”Ÿæˆäº†GCå®‰å…¨ç‚¹ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å°±ç§°ä¸ºå®Œå…¨å¯ä¸­æ–­å‡½æ•°ï¼Œå¦‚æœä¸æ˜¯æ¯ä¸€æ¡æŒ‡ä»¤éƒ½ç”ŸæˆGCå®‰å…¨ç‚¹é‚£ä¹ˆè¿™ä¸ªå‡½æ•°å°±ç§°ä¸ºéƒ¨åˆ†å¯ä¸­æ–­å‡½æ•°ã€‚</p>
</blockquote>
<blockquote>
<p>çº¿ç¨‹æœ¬åœ°å­˜å‚¨<br>çº¿ç¨‹æœ¬åœ°å­˜å‚¨æ˜¯ç”¨äºå®ç°æŒ‰çº¿ç¨‹éš”ç¦»çš„çº¿ç¨‹æœ¬åœ°å˜é‡ã€‚<br>å¯¹äºåŒä¸€ä¸ªçº¿ç¨‹çš„æœ¬åœ°å˜é‡ï¼Œå„ä¸ªçº¿ç¨‹éƒ½æœ‰ç‹¬ç«‹çš„å€¼ï¼Œä¿®æ”¹çš„å€¼åªå¯¹ä¿®æ”¹çš„çº¿ç¨‹å¯è§ã€‚<br>ç›¸å½“äºè®©æ¯ä¸ªçº¿ç¨‹éƒ½å¼€è¾Ÿäº†ä¸€å—å†…å­˜ç©ºé—´ï¼Œç”¨æ¥å­˜å‚¨å…±äº«å˜é‡çš„ä¸€ä¸ªå‰¯æœ¬ï¼Œç„¶åæ¯ä¸ªçº¿ç¨‹åªéœ€è¦å»è®¿ é—®å’Œæ“ä½œè‡ªå·±çš„å…±äº«å˜é‡å‰¯æœ¬å°±å¯ä»¥äº†ï¼Œä»è€Œé¿å…äº†å¤šçº¿ç¨‹å»ç«äº‰åŒä¸€ä¸ªå…±äº«èµ„æºã€‚<br>ThreadStatic<br>ThreadStaticç‰¹æ€§ä¼šè®©å˜é‡å˜æˆçº¿ç¨‹æœ¬åœ°å­˜å‚¨å˜é‡ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹è¾“å‡ºçš„ç»“æœä¸ä¼šè¢«å…¶å®ƒçº¿ç¨‹å½±å“ã€‚</p>
</blockquote>
<blockquote>
<p>IOCå®¹å™¨é‡Œé¢çš„çº¿ç¨‹å•ä¾‹ç”Ÿå‘½å‘¨æœŸå°±æ˜¯ç”¨ThreadStaticå®ç°çš„ã€‚</p>
</blockquote>
<blockquote>
<p>ThreadLocal<br>ThreadLocalæ˜¯ä¸€ä¸ªåŒ…è£…ç±»å’ŒThreadStaticæ˜¯å®Œå…¨ç­‰ä»·çš„ã€‚<br>ThreadLocalä¸­æ¯ä¸ªæ‰˜ç®¡çº¿ç¨‹å¯¹è±¡éƒ½å…³è”ä¸€ä¸ªTLB(Thread Local Block)è¡¨ï¼Œè¿™ä¸ªè¡¨ä»¥AppDomain IDä½œä¸º ç´¢å¼•ä¿å­˜TLM(Thread Local Module)è¡¨ã€‚<br>TLBè¡¨ä»¥æ¨¡å—IDä¸ºç´¢å¼•ä¿å­˜äº†æ‰˜ç®¡çº¿ç¨‹æœ¬åœ°å­˜å‚¨ç©ºé—´çš„å¼€å§‹åœ°å€ã€‚<br>å½“.NETè¿è¡Œæ—¶åœ¨åŠ è½½ä¸€ä¸ªç¨‹åºé›†çš„æ—¶å€™ï¼Œä¼šæšä¸¾ç¨‹åºé›†ä¸­çš„æ¨¡å—å’Œæ¨¡å—ä¸­çš„å…¨å±€å˜é‡ï¼Œç„¶åæ ¹æ®å…¶æ˜¯ å¦ä¸ºçº¿ç¨‹æœ¬åœ°å˜é‡åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œéçº¿ç¨‹æœ¬åœ°å˜é‡ä¿å­˜åœ¨AppDoaminé«˜é¢‘å †ä¸­ï¼Œçº¿ç¨‹æœ¬åœ°å˜é‡å°±åªè®¡ ç®—åç§»å€¼ï¼Œå­˜å‚¨ç©ºé—´ä¼šåœ¨é¦–æ¬¡è®¿é—®çš„æ—¶å€™åˆ†é…ã€‚</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/07710a829d8146a49c5bd22854ddcec0.png" alt="07710a829d8146a49c5bd22854ddcec0.png"></p>
<h2 id="åŸå­æ“ä½œ"><a href="#åŸå­æ“ä½œ" class="headerlink" title="åŸå­æ“ä½œ"></a>åŸå­æ“ä½œ</h2><blockquote>
<p>.NETä¸­åŸå­æ“ä½œå°±æ˜¯è¦ä¹ˆæˆåŠŸä¸”çŠ¶æ€æ”¹å˜ï¼Œè¦ä¹ˆå¤±è´¥ä¸”çŠ¶æ€ä¸å˜ã€‚<br>æ¯”å¦‚ç”¨å¤šçº¿ç¨‹å¤„ç†ä¸åŒæ–‡ä»¶ï¼Œå¹¶ä¸”éœ€è¦å®æ—¶è¾“å‡ºå½“å‰å¤„ç†å®Œæˆçš„æ•°é‡åˆè®¡ï¼Œå®šä¹‰ä¸€ä¸ªæ•´æ•°ç±»å‹çš„å…¨å±€ å˜é‡ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹æ¯å¤„ç†å®Œä¸€ä¸ªæ–‡ä»¶å°±é€’å¢ä¸€æ¬¡ï¼Œç„¶åå®šæ—¶è¾“å‡ºè¿™ä¸ªå…¨å±€å˜é‡çš„å€¼ï¼Œè¿™ä¸ªé€’å¢çš„æ“ä½œ å¿…é¡»æ˜¯åŸå­æ“ä½œã€‚<br>InterLocked<br>InterLockedç±»æä¾›äº†æ‰§è¡ŒåŸå­æ“ä½œçš„ä¸€äº›æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•æ¥æ”¶çš„æ˜¯å¼•ç”¨å‚æ•°ä¹Ÿå°±æ˜¯å˜é‡çš„å†…å­˜åœ°å€ï¼Œé’ˆå¯¹å†…å­˜åœ°å€ä¸­çš„å€¼è¿›è¡ŒåŸå­æ“ä½œã€‚</p>
</blockquote>
<h2 id="çº¿ç¨‹é”-x2F-æ— é”ç®—æ³•"><a href="#çº¿ç¨‹é”-x2F-æ— é”ç®—æ³•" class="headerlink" title="çº¿ç¨‹é”&#x2F;æ— é”ç®—æ³•"></a>çº¿ç¨‹é”&#x2F;æ— é”ç®—æ³•</h2><blockquote>
<p>çº¿ç¨‹é”æ˜¯æŠŠæŒ‡å®šåŒºåŸŸå†…çš„æ“ä½œéƒ½å˜æˆåŸå­æ“ä½œï¼Œå…·æœ‰å¾ˆé«˜çš„é€šç”¨æ€§ã€‚çº¿ç¨‹é”åªæœ‰è·å–é”å’Œé‡Š æ”¾é”ï¼Œåœ¨ è·å–é”ä¹‹åå’Œé‡Šæ”¾é”ä¹‹å‰çš„ä¸­é—´éƒ¨åˆ†åªä¿è¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹è¿è¡Œã€‚<br>æ— é”ç®—æ³•æ˜¯ä¸ä½¿ç”¨çº¿ç¨‹é”ï¼Œè€Œæ˜¯ä¿®æ”¹æ“ä½œçš„å†…å®¹ï¼Œä»¥æ»¡è¶³ä¿®æ”¹æ“ä½œçš„æ¡ä»¶ã€‚</p>
</blockquote>
<h4 id="è‡ªæ—‹é”"><a href="#è‡ªæ—‹é”" class="headerlink" title="è‡ªæ—‹é”"></a>è‡ªæ—‹é”</h4><blockquote>
<p>è‡ªæ—‹é”æ˜¯åŸºäºåŸå­æ“ä½œå®ç°çš„ï¼ŒåŸºäºä¸€ä¸ªæ•°å€¼æ¥è¡¨ç¤ºé”æ˜¯å¦è¢«è·å–ï¼Œæ¯”å¦‚0è¡¨ç¤ºæœªè¢«è·å–ï¼Œ1è¡¨ç¤ºå·² è¢«è·å–ã€‚è·å–é”çš„æ—¶å€™ä¼šå…ˆä½¿ç”¨åŸå­æ“ä½œå»è®¾ç½®å®ƒçš„æ•°å€¼ä¸º1ï¼Œç„¶åå»æ£€æŸ¥ä¿®æ”¹å‰çš„æ•°å€¼æ˜¯å¦ä¸º0ï¼Œå¦‚ æœä¸º1è¡¨ç¤ºè·å–æˆåŠŸï¼Œå¦åˆ™ä¸€ç›´é‡è¯•ç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚é‡Šæ”¾é”çš„æ—¶å€™ä¼šè®¾ç½®å®ƒä¸º0ï¼Œå…¶å®ƒæ­£åœ¨è·å–é”çš„ çº¿ç¨‹å†ä¸‹ä¸€æ¬¡é‡è¯•æ—¶æ‰ä¼šæˆåŠŸè·å–ã€‚<br>è‡ªæ—‹é”æŒ‡å½“ä¸€ä¸ªçº¿ç¨‹å†è·å–é”çš„æ—¶å€™ï¼Œå¦‚æœé”å·²ç»è¢«å…¶å®ƒçº¿ç¨‹è·å–ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°†å¾ªç¯ç­‰å¾…ï¼Œä¸æ–­ çš„åˆ¤æ–­é”æ˜¯ä¸æ˜¯èƒ½è¢«æˆåŠŸè·å–ï¼Œç›´åˆ°æˆåŠŸè·å–åˆ°äº†é”ï¼Œæ‰ä¼šé€€å‡ºå¾ªç¯ã€‚<br>å¦‚æœå·²ç»æ˜ç¡®çš„çŸ¥é“äº†è¢«é”ä½çš„ä»£ç æ‰§è¡Œçš„æ—¶é—´éå¸¸çŸ­ï¼Œå°±å¯ä»¥é€‰æ‹©å¼€é”€æ¯”è¾ƒå°çš„è‡ªæ—‹é”ã€‚<br>SpinWait&#x2F;SpinOnce<br>Threadé‡Œé¢çš„SpinWaitæ–¹æ³•å¯ä»¥å®ç°ä¸€ä¸ªè‡ªæ—‹é”ã€‚SpinWaité€šè¿‡è°ƒç”¨æ±‡ç¼–æŒ‡ä»¤pauseå‘Šè¯‰CPUå½“å‰æ­£ åœ¨è‡ªæ—‹é”çš„å¾ªç¯ä¸­ï¼Œå½“å‰çš„é€»è¾‘æ ¸å¿ƒå°±å¯ä»¥æŒ‰ç…§æ—¶é’Ÿå‘¨æœŸå¾—åˆ°ä¸€ä¸ªä¼‘æ¯ç„¶åå†å»æ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤ï¼Œç”± äºpauseæŒ‡ä»¤ä¼‘æ¯æ—¶é—´åœ¨ä¸åŒçš„CPUå‹å·ä¸­æ˜¯ä¸åŒçš„ï¼Œæ‰€ä»¥åœ¨.NETä¸­è‡ªå®šä¹‰äº†ä¸€ä¸ªæ ‡å‡†çš„ä¼‘æ¯æ—¶é—´ï¼Œ åœ¨ç¨‹åºå¯åŠ¨æ—¶ä¼šè®¡ç®—éœ€è¦å¤šå°‘æ¬¡è°ƒç”¨æŒ‡ä»¤æ‰èƒ½æ¥è¿‘è¿™ä¸ªæ ‡å‡†æ—¶é—´ï¼ŒSpinWaitå‡½æ•°å°±ä¼šæ ¹æ®è®¡ ç®—å‡ºæ¥çš„ æ¬¡æ•°å»è°ƒç”¨è¿™ä¸ªæŒ‡ä»¤ï¼Œè¿™æ ·å°±ä¼šè®©æ‰€æœ‰å¹³å°ä¸Šçš„CPUä¼‘æ¯æ—¶é—´æ˜¯ä¿æŒä¸€è‡´çš„ã€‚<br>SpinWaitç±»ä¹Ÿå¯ä»¥å®ç°ä¸€ä¸ªè‡ªæ—‹é”ã€‚è°ƒç”¨SpinWaitç±»çš„SpinOnceæ–¹æ³•å®ç°ç­‰å¾…ã€‚å¦‚æœåœ¨ä¸€å®šæ¬¡æ•°ä»¥å†…ï¼Œ å¹¶ä¸”å½“å‰ç¯å¢ƒçš„é€»è¾‘æ ¸å¿ƒæ•°&gt;1ï¼Œé‚£ä¹ˆåº•å±‚è¿˜æ˜¯è°ƒç”¨çš„Thread.SpintWaitæ–¹æ³•ã€‚å¦‚æœè¶…è¿‡äº†ä¸€å®šæ¬¡æ•°ï¼Œå¹¶ ä¸”å½“å‰ç¯å¢ƒçš„é€»è¾‘æ ¸å¿ƒ&#x3D;1ï¼Œé‚£ä¹ˆå°±ä¼šäº¤æ›¿ä½¿ç”¨Thread.Sleep(0)å’ŒThread.Yieldæ–¹æ³•ï¼Œå†è¶…è¿‡ä¸€å®šæ¬¡æ•°ä¼š ä½¿ç”¨Thread.Sleep(1),è®©çº¿ç¨‹ä¼‘çœ 1æ¯«ç§’ä»¥é¿å…é¢‘ç¹å ç”¨CPUèµ„æºï¼ŒSpinWaitç±»çš„è¿™ç§ç‰¹ç‚¹å¯ä»¥è§£å†³è‡ª é€‰é”ä¿æŠ¤ç€ä»£ç é•¿æ—¶é—´è¿è¡Œçš„é—®é¢˜ï¼ŒSpinWaitç±»ä¼šå‘Šè¯‰æ“ä½œç³»ç»Ÿåˆ‡æ¢åˆ°å…¶å®ƒçº¿ç¨‹ä¸Šï¼Œè®©å½“å‰çº¿ç¨‹è¿›å…¥ ä¼‘çœ çŠ¶æ€ï¼Œè¿™æ ·å°±ä¸ä¼šä¸€ç›´æ‰§è¡ŒSpintWaitæ–¹æ³•è€Œå¯¼è‡´CPUåœ¨çº¿ç¨‹è¢«æŠ¢å ä¹‹å‰æ— æ³•æ‰§è¡Œå…¶å®ƒå·¥ä½œã€‚ Sleep(0)å®é™…ä¸Šæ˜¯è°ƒç”¨SleepExç³»ç»Ÿå‡½æ•°ï¼ŒYieldæ˜¯è°ƒç”¨SwitchToThreadçš„ç³»ç»Ÿå‡½æ•°ï¼ŒSwitchToThreadå‡½ æ•°åªä¼šåˆ‡æ¢å½“å‰é€»è¾‘æ ¸å¿ƒå…³è”çš„å¾…è¿è¡Œé˜Ÿåˆ—ä¸­çš„çº¿ç¨‹ï¼Œæ˜¯ä¸ä¼šåˆ‡æ¢åˆ°å…¶å®ƒé€»è¾‘æ ¸å¿ƒä¸Šå…³è”çš„çº¿ç¨‹ï¼Œè€Œ SleepExæ˜¯å¯ä»¥åˆ‡æ¢åˆ°ä»»æ„é€»è¾‘æ ¸å¿ƒå…³è”çš„å¾…è¿è¡Œé˜Ÿåˆ—ä¸­çš„çº¿ç¨‹ï¼Œå¹¶ä¸”è®©å½“å‰çº¿ç¨‹åœ¨æŒ‡å®šæ—¶é—´å†…æ— æ³•é‡ æ–°è¿›å…¥å¾…è¿è¡Œé˜Ÿåˆ—ã€‚<br>SpinLockç±»ä¹Ÿå¯ä»¥å®ç°è‡ªæ—‹é”ï¼Œè¿™ä¸ªç±»å°è£…äº†é”çŠ¶æ€çš„ç®¡ç†ï¼Œä»¥åŠè°ƒç”¨SpinOnceçš„æ–¹æ³•ã€‚<br>è‡ªæ—‹é”ä¿æŠ¤çš„ä»£ç åº”è¯¥åœ¨è¾ƒçŸ­çš„æ—¶é—´å†…æ‰§è¡Œå®Œæ¯•ï¼Œå¦‚æœä»£ç é•¿æ—¶é—´è¿è¡Œï¼Œå°±ä¼šé€ æˆæŸä¸€ä¸ªçº¿ç¨‹æŒæœ‰é” çš„æ—¶é—´è¿‡é•¿ï¼Œå°±ä¼šå¯¼è‡´å…¶å®ƒç­‰å¾…è·å–é”çš„çº¿ç¨‹ä¸æ–­çš„é‡è¯•å¹¶ä¸”å ç”¨é€»è¾‘æ ¸å¿ƒï¼Œå¦‚æœä½¿ç”¨ä¸å½“ä¼šé€ æˆCPU çš„ä½¿ç”¨ç‡éå¸¸é«˜ã€‚<br>è‡ªæ—‹é”æ˜¯ä¸å…¬å¹³çš„é”ï¼Œä¸å…¬å¹³æ˜¯å› ä¸ºç­‰å¾…æ—¶é—´æœ€é•¿çš„çº¿ç¨‹ä¸ä¸€å®šä¼šæŒæœ‰é”ï¼Œ è¿™å°±ä¼šé€ æˆçº¿ç¨‹é¥¥é¥¿ã€‚<br>è‡ªæ—‹é”ä¸ä¼šä½¿çº¿ç¨‹çŠ¶æ€å‘ç”Ÿåˆ‡æ¢ï¼Œä¸ä¼šä½¿çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œå‡å°‘äº†ä¸éœ€è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚</p>
</blockquote>
<blockquote>
<p>çº¿ç¨‹é¥¥é¥¿<br>å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ä¸€ä¸ªåŒæ­¥èµ„æºï¼Œæœ‰äº›çº¿ç¨‹æ€»æ˜¯æ²¡æœºä¼šè·å¾—é”ã€‚</p>
</blockquote>
<h4 id="äº’æ–¥é”"><a href="#äº’æ–¥é”" class="headerlink" title="äº’æ–¥é”"></a>äº’æ–¥é”</h4><blockquote>
<p>è‡ªæ—‹é”ä¸é€‚ç”¨äºé•¿æ—¶é—´è¿è¡Œçš„æ“ä½œï¼Œåº”ç”¨åœºæ™¯æ¯”è¾ƒæœ‰é™ã€‚æ›´é€šç”¨çš„æ˜¯æ“ä½œç³»ç»Ÿæä¾›çš„åŸºäºåŸå­æ“ä½œå’Œçº¿ç¨‹è°ƒåº¦ç»“åˆå®ç°çš„äº’æ–¥é”ã€‚æ“ä½œç³»ç»Ÿæä¾›çš„äº’æ–¥é”ä¹Ÿæœ‰ä¸€ä¸ªæ•°å€¼æ¥è¡¨ç¤ºè¿™ä¸ªé”æ˜¯å¦å·²ç»è¢«è·å–ã€‚ä¸è‡ªæ—‹é”ä¸åŒçš„æ˜¯äº’æ–¥é”å½“è·å–é”å¤±è´¥çš„æ—¶å€™ä¸é‡è¯•ï¼Œè€Œæ˜¯å®‰æ’è·å–é”çº¿ç¨‹è¿›å…¥ç­‰å¾…ï¼ŒæŠŠçº¿ç¨‹å¯¹è±¡æ·»åŠ åˆ°è¿™ä¸ªé”å…³è”çš„é˜Ÿåˆ—ä¸­ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹é”é‡Šæ”¾çš„æ—¶å€™ä¼šæ£€æŸ¥è¿™ä¸ªé˜Ÿåˆ—æ˜¯ä¸æ˜¯æœ‰çº¿ç¨‹å¯¹è±¡ï¼Œå¦‚æœæœ‰å°±é€šçŸ¥æ“ä½œç³»ç»Ÿå»å”¤é†’è¿™ä¸ªçº¿ç¨‹ã€‚å¤„äºç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹æ˜¯æ²¡æœ‰åœ¨è¿è¡Œçš„ï¼Œå³ä½¿è¿™ä¸ªé”é•¿æ—¶é—´ä¸é‡Šæ”¾ä¹Ÿä¸ä¼šæ¶ˆè€—CPUçš„èµ„æºã€‚çº¿ç¨‹è¦ä»ç­‰å¾…çŠ¶æ€å”¤é†’ï¼Œå”¤é†’ä¹‹åè¿˜è¦è°ƒåº¦è¿è¡Œï¼Œè¿™ä¸ªæ—¶å€™ä»ç­‰å¾…çŠ¶æ€åˆ°è°ƒåº¦è¿è¡Œä¸­é—´è¦èŠ±è´¹ä¸€äº›æ—¶é—´ï¼Œè¿™ä¸ªæ—¶é—´ä¸è‡ªæ—‹é”é‡è¯•æ‰€éœ€çš„æ¯”ç‡æ˜¯ç›¸å½“çš„ï¼Œè‡ªæ—‹é”å¦‚æœæ˜¯çº³ç§’çº§ï¼Œäº’æ–¥é”å°±æ˜¯æ¯«ç§’çº§ã€‚</p>
</blockquote>
<blockquote>
<p>Mutex<br>MutexåŒ…è£…äº†æ“ä½œç³»ç»Ÿæä¾›çš„äº’æ–¥é”ã€‚<br>Mutexæ”¯æŒè·¨è¿›ç¨‹ä½¿ç”¨ï¼Œå¯ä»¥é˜²æ­¢ç¨‹åºå¤šå¼€ï¼Œä¹Ÿå¯ä»¥ç”¨äºä¿æŠ¤å¤šä¸ªè¿›ç¨‹å…±äº«çš„èµ„æºã€‚</p>
</blockquote>
<h4 id="æ··åˆé”"><a href="#æ··åˆé”" class="headerlink" title="æ··åˆé”"></a>æ··åˆé”</h4><blockquote>
<p>ç”±äºäº’æ–¥é”çš„æ€§èƒ½æ¯”è¾ƒä½ï¼Œ.NETæä¾›äº†æ›´é€šç”¨æ€§èƒ½ä¹Ÿæ›´å¥½çš„æ··åˆé”ï¼Œè€Œä¸”ä»»ä½•å¼•ç”¨ç±»å‹çš„å¯¹è±¡éƒ½å¯ä»¥ ä½œä¸ºè¿™ä¸ªé”å¯¹è±¡ï¼Œä¹Ÿä¸éœ€è¦äº‹å…ˆåˆ›å»ºæŸä¸€ä¸ªç±»å‹çš„å®ä¾‹ï¼Œå¹¶ä¸”æ¶‰åŠéæ‰˜ç®¡èµ„æºè¿˜ä¼šç”±.NETè¿è¡Œæ—¶è‡ª åŠ¨é‡Šæ”¾ã€‚<br>æ··åˆé”åœ¨è·å–é”å¤±è´¥åï¼Œä¹Ÿä¼šå‘è‡ªæ—‹é”ä¸€æ ·é‡è¯•ä¸€å®šçš„æ¬¡æ•°ï¼Œè¶…è¿‡ä¸€å®šçš„æ¬¡æ•°ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚<br>æ··åˆé”çš„å¥½å¤„å°±æ˜¯ç¬¬ä¸€æ¬¡è·å–é”å¤±è´¥ä»¥åï¼Œå¦‚æœå…¶å®ƒçº¿ç¨‹åˆé©¬ä¸Šé‡Šæ”¾äº†é”ï¼Œé‚£ä¹ˆå½“å‰è¿™ä¸ªçº¿ç¨‹åœ¨ä¸‹ä¸€ è½®é‡è¯•æ—¶å°±å¯ä»¥ç«‹å³è·å–æˆåŠŸï¼Œè¿™æ ·å°±ä¸éœ€è¦ç»è¿‡ä¸€ä¸ªè€—æ—¶çš„çº¿ç¨‹è°ƒåº¦å»å¤„ç†ã€‚å¦‚æœå…¶å®ƒçº¿ç¨‹åœ¨çŸ­æ—¶ é—´å†…æ²¡æœ‰é‡Šæ”¾é”ï¼ŒæŸä¸ªçº¿ç¨‹è·å–é”çš„æ—¶å€™é‡è¯•è¶…è¿‡ä¸€å®šçš„æ¬¡æ•°ï¼Œå°±ä¼šè¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œé¿å…æ¶ˆè€—CPU çš„èµ„æºã€‚<br>æ··åˆé”é€‚ç”¨äºå¤§éƒ¨åˆ†çš„åœºæ™¯ã€‚<br>Monitor&#x2F;Lock<br>Monitorå’ŒLockæ˜¯å®Œå…¨ç­‰ä»·çš„ã€‚</p>
</blockquote>
<blockquote>
<p>ä¸ºä»€ä¹ˆåŠ é”ç”¨å¼•ç”¨ç±»å‹ï¼Œå¹¶ä¸”å®šä¹‰ä¸ºé™æ€åªè¯»ï¼Ÿ<br>å¼•ç”¨ç±»å‹å®šä¹‰ä¸ºé™æ€æ˜¯ä¸ºäº†è®©å¯¹è±¡å¸¸é©»å†…å­˜ï¼Œå®šä¹‰ä¸ºåªè¯»readonlyæ˜¯ä¸ºäº†è®©å¼•ç”¨ç±»å‹åœ¨å£°æ˜æ—¶å°±å®Œæˆ åˆå§‹åŒ–ï¼Œå¹¶ä¸”ä¿è¯å¯¹è±¡çš„ä¸å¯å˜æ€§ï¼Œè¿™æ ·åœ¨é«˜å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œå¤šçº¿ç¨‹åœ¨ä»»ä½•æ—¶å€™éƒ½çœ‹åˆ°çš„æ˜¯åŒä¸€ä¸ªå¯¹ è±¡ã€‚å®šä¹‰ä¸ºç§æœ‰æˆå‘˜ä¿è¯è¯¥å¼•ç”¨ç±»å‹ä¸ä¼šå—åˆ°å…¶å®ƒåœ°æ–¹çš„å½±å“ã€‚<br>å®šä¹‰ä¸ºå¼•ç”¨ç±»å‹è¿˜æœ‰ä¸€ä¸ªåŸå› å°±æ˜¯å› ä¸ºä»»ä½•ä¸€ä¸ªå¼•ç”¨ç±»å‹çš„å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå¯¹è±¡å¤´ï¼Œå¯¹è±¡å¤´ä¸­æ˜¯å¯ä»¥å­˜ å‚¨å½“å‰è·å–é”çš„ä¸€ä¸ªçº¿ç¨‹IDå’Œè¿›å…¥æ¬¡æ•°ï¼Œè¿˜å¯ä»¥å­˜å‚¨åŒæ­¥å—ç´¢å¼•ï¼ŒåŒæ­¥å—åŒ…å«äº†æ‰€å±çº¿ç¨‹å¯¹è±¡ï¼Œè¿›å…¥ æ¬¡æ•°ï¼Œäº‹ä»¶å¯¹è±¡ç­‰ã€‚<br>äº‹ä»¶å¯¹è±¡å¯ä»¥è®©çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€å’Œå”¤é†’çº¿ç¨‹ï¼ŒåŒæ­¥å—å¯ä»¥æŒ‰ç…§éœ€è¦åˆ›å»ºå¹¶è‡ªåŠ¨é‡Šæ”¾ã€‚<br>ä¸ºä»€ä¹ˆåŠ é”ä¸èƒ½ç”¨stringï¼Ÿ<br>å› ä¸ºstringæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å¼•ç”¨ç±»å‹ï¼Œå…·æœ‰ä¸å˜æ€§å’Œå­—ç¬¦ä¸²é©»ç•™ã€‚<br>æ•´ä¸ªç¨‹åºä¸­ä»»ä½•å­—ç¬¦ä¸²éƒ½åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå› æ­¤åªè¦åœ¨ç¨‹åºä¸­çš„ä»»ä½•ä½ç½®åŠ é”å…·æœ‰ç›¸åŒå†…å®¹çš„å­—ç¬¦ä¸²ï¼Œ å°±ä¼šé”å®šç¨‹åºä¸­è¯¥å­—ç¬¦ä¸²çš„æ‰€æœ‰å®ä¾‹ã€‚<br>è¯´çš„æ›´ç›´ç™½ç‚¹ï¼Œæˆ‘å°±æ˜¯æƒ³é”è¿™ä¸€å—å„¿çš„å†…å®¹ï¼Œç»“æœæŠŠæ‰€æœ‰è·Ÿè¯¥å­—ç¬¦ä¸²å†…å®¹ç›¸åŒçš„åŒºåŸŸéƒ½é”äº†ã€‚</p>
</blockquote>
<h4 id="è¯»å†™é”"><a href="#è¯»å†™é”" class="headerlink" title="è¯»å†™é”"></a>è¯»å†™é”</h4><blockquote>
<p>è¯»å†™é”é€‚ç”¨äºé¢‘ç¹è¯»å–ï¼Œå¹¶ä¸”è¯»å–éœ€è¦ä¸€å®šæ—¶é—´çš„åœºæ™¯ï¼Œå°¤å…¶æ˜¯æ‰€è°“çš„å…±äº«èµ„æºã€‚å…±äº«èµ„æºçš„è¯»å–æ“ ä½œé€šå¸¸æ˜¯å¯ä»¥åŒæ—¶æ‰§è¡Œçš„ï¼Œè€Œæ™®é€šçš„äº’æ–¥é”ï¼Œä¸ç®¡æ˜¯è¯»å–è¿˜æ˜¯ä¿®æ”¹éƒ½æ˜¯æ— æ³•åŒæ—¶æ‰§è¡Œçš„ã€‚å¦‚æœè¯´å¤šä¸ª çº¿ç¨‹ä¸ºäº†è¯»å–æ“ä½œè€Œå»è·å–ä¸€ä¸ªäº’æ–¥é”ï¼Œé‚£ä¹ˆåŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡Œè¯»å–æ“ä½œï¼Œåœ¨é¢‘ç¹è¯»å– çš„æƒ…å†µä¸‹ï¼Œå°±ä¼šå¯¹ååé‡é€ æˆå½±å“ã€‚<br>å¤šçº¿ç¨‹å†™å…¥åŒä¸€ä¸ªæ–‡ä»¶ï¼Œä¼šç»å¸¸å‘ç”Ÿæ–‡ä»¶è¢«å ç”¨è€Œä¸”æ— æ³•è®¿é—®çš„å¯èƒ½ï¼Œå¦‚æœä¸ä½¿ç”¨è¯»å†™é”ï¼Œè€Œä½¿ç”¨å¤š çº¿ç¨‹å†™å…¥æ–‡ä»¶å°±ä¼šå¤±è´¥å¾ˆå¤šæ¬¡ï¼Œä½¿ç”¨è¯»å†™é”ä¹‹åå°±å¯ä»¥ç¡®ä¿æ¯ä¸ªçº¿ç¨‹éƒ½å¯ä»¥å®Œæˆå†™å…¥æ“ä½œã€‚<br>è¯»å†™é”çš„æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªæ··åˆé”ã€‚<br>ReaderWriterLock<br>è¯»å†™é”ï¼šReaderWriterLockSlimï¼Œä¸åŒçš„ReaderWriterLockSlimå¯¹è±¡ä¸­é”å®šåŒä¸€ä¸ªæ–‡ä»¶ä¹Ÿä¼šè¢«è§†ä¸ºä¸åŒ çš„é”è¿›è¡Œç®¡ç†ï¼Œè¿™ç§å·®å¼‚å¯èƒ½ä¼šå†æ¬¡å¯¼è‡´æ–‡ä»¶çš„å¹¶å‘å†™å…¥é—®é¢˜ï¼Œæ‰€ä»¥ReaderWriterLockSlimåº”å°½é‡å®š ä¹‰ä¸ºåªè¯»çš„é™æ€å¯¹è±¡ã€‚<br>ReaderWriterLockSlimç±»ä¼¼äºReaderWriterLockä½†ç®€åŒ–äº†é€’å½’è§„åˆ™ä»¥åŠå‡çº§å’Œé™çº§é”å®šçŠ¶æ€çš„è§„åˆ™ï¼Œå¯ é¿å…å¤šç§æ½œåœ¨çš„æ­»é”æƒ…å†µï¼Œæ€§èƒ½æ˜æ˜¾ä¼˜äºReaderWriterLockã€‚<br>ReaderWriterLock:ç”¨äºåŒæ­¥èµ„æºè®¿é—®ï¼Œå…è®¸å¤šçº¿ç¨‹åŒæ—¶è¿›è¡Œè¯»è®¿é—®ï¼Œæˆ–è€…å•çº¿ç¨‹å†™è®¿é—®ï¼Œåœ¨èµ„æºä¸ ç»å¸¸å‘ç”Ÿæ›´æ”¹çš„æƒ…å†µä¸‹ï¼Œååé‡æ¯”ç®€å•çš„ä¸€æ¬¡åªå…è®¸ä¸€ä¸ªçº¿ç¨‹çš„é”æ›´é«˜ã€‚<br>EnterWriteLock:è¿›å…¥å†™å…¥çŠ¶æ€ï¼Œè°ƒç”¨çº¿ç¨‹è¿›å…¥é”å®šçŠ¶æ€ä¹‹å‰ä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ã€‚<br>TryEnterWriteLock:è¿›å…¥å†™å…¥çŠ¶æ€ï¼Œå¯æŒ‡å®šé˜»å¡çš„é—´éš”æ—¶é—´ï¼Œè°ƒç”¨çº¿ç¨‹åœ¨é—´éš”æœŸé—´å¹¶æœªè¿›å…¥å†™å…¥æ¨¡å¼è¿” å›falseã€‚<br>ExitWriteLock:é€€å‡ºå†™å…¥çŠ¶æ€ï¼Œåº”ä½¿ç”¨finallyå—æ‰§è¡ŒExitWriteLockæ–¹æ³•ï¼Œç¡®ä¿è°ƒç”¨æ–¹é€€å‡ºå†™å…¥æ¨¡å¼ã€‚</p>
</blockquote>
<h2 id="ä¿¡å·é‡"><a href="#ä¿¡å·é‡" class="headerlink" title="ä¿¡å·é‡"></a>ä¿¡å·é‡</h2><blockquote>
<p>ä¿¡å·é‡æ˜¯ä¸€ä¸ªå…·æœ‰ç‰¹æ®Šç”¨é€”çš„çº¿ç¨‹åŒæ­¥å¯¹è±¡ã€‚<br>ä¿¡å·é‡å†…éƒ¨ä½¿ç”¨ä¸€ä¸ªæ•°å€¼æ¥è®°å½•å¯ç”¨çš„æ•°é‡ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½å¯ä»¥é€šè¿‡å¢åŠ è¿™ä¸ªæ•°é‡å’Œå‡å°‘è¿™ä¸ªæ•°é‡è¿› è¡ŒåŒæ­¥ã€‚<br>åœ¨æ‰§è¡Œå‡å°‘æ•°é‡çš„æ—¶å€™å¦‚æœå‡å°‘çš„æ•°é‡&gt;ç°æœ‰æ•°é‡ï¼Œçº¿ç¨‹å°±ä¼šè¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œä¸€ç›´åˆ°å…¶å®ƒçš„çº¿ç¨‹å»å¢åŠ  è¿™ä¸ªæ•°é‡ï¼Œå¹¶ä¸”è¿™ä¸ªæ•°é‡ä¸å°‘äºå‡å°çš„æ•°é‡ä¸ºæ­¢ã€‚<br>æ¯”å¦‚å­¦æ ¡çš„è‡ªä¹ å®¤ï¼šäº’æ–¥é”ç®¡ç†çš„æ˜¯æŸä¸ªåº§ä½æ˜¯å¦è¢«å ç”¨ï¼Œä¿¡å·é‡ç®¡ç†çš„æ˜¯æ•´ä¸ªè‡ªä¹ å®¤ä¸­æœªè¢«å ç”¨çš„ åº§ä½æ•°é‡ï¼Œæ¯å½“æœ‰äººå ç”¨ä¸€ä¸ªåº§ä½ï¼Œè¿™ä¸ªè‡ªä¹ å®¤ä¸­çš„åº§ä½å°±ä¼šå‡å°‘ï¼Œå½“æœ‰äººç¦»å¼€è¿™ä¸ªè‡ªä¹ å®¤åº§ä½å°±ä¼š å¢åŠ ã€‚å¦‚æœä¿¡å·é‡ä¸º0é‚£å°±è¯´æ˜æ‰€æœ‰çš„åº§ä½éƒ½è¢«å ç”¨äº†ï¼Œé‚£ä¹ˆæ–°æ¥çš„äººå°±éœ€è¦ç­‰å¾…ã€‚<br>äº’æ–¥é”æ˜¯è°è·å–è¿™ä¸ªé”è°å°±è´Ÿè´£é‡Šæ”¾è¿™ä¸ªé”ã€‚ä¿¡å·é‡çš„å¢åŠ å’Œå‡å°‘çš„çº¿ç¨‹å¯ä»¥æ˜¯ä¸åŒçš„ã€‚<br>ä¿¡å·é‡æœ€å¸¸è§çš„åœºæ™¯å°±æ˜¯å®ç°ç”Ÿäº§æ¶ˆè´¹æ¨¡å¼ï¼Œç”Ÿäº§æ¶ˆè´¹æ¨¡å¼ä¸€èˆ¬æ˜¯ä¸€ä¸ªé˜Ÿåˆ—ï¼Œæœ‰ä¸€éƒ¨åˆ†çº¿ç¨‹å‘é˜Ÿåˆ—é‡Œ é¢æ·»åŠ ä»»åŠ¡ï¼Œå¦ä¸€éƒ¨åˆ†çº¿ç¨‹ä»é˜Ÿåˆ—é‡Œé¢å–å‡ºä»»åŠ¡å¹¶å¤„ç†ã€‚<br>Semaphore&#x2F;SemaphoreSlim<br>SemaphoreSlimæ˜¯é˜‰å‰²ç‰ˆçš„ï¼Œä¸æ”¯æŒè·¨è¿›ç¨‹ã€‚</p>
</blockquote>
<h2 id="volatile"><a href="#volatile" class="headerlink" title="volatile"></a>volatile</h2><blockquote>
<p>åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œä¸€ä¸ªè¢«volatileä¿®é¥°çš„å˜é‡ï¼Œå…¶å€¼è¢«å¤šçº¿ç¨‹è¯»å†™æ—¶æ°¸è¿œæ“ä½œçš„æ˜¯æœ€æ–°çš„å€¼ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„æ“ä½œä¿è¯äº†å€¼çš„ä¸€è‡´æ€§ã€‚</p>
</blockquote>
<blockquote>
<p>åŸç†<br>å¤šçº¿ç¨‹åŒæ—¶è®¿é—®ä¸€ä¸ªå˜é‡ï¼ŒCLRä¸ºäº†æ•ˆç‡ï¼Œå…è®¸æ¯ä¸ªçº¿ç¨‹è¿›è¡Œæœ¬åœ°ç¼“å­˜ï¼Œå¯¼è‡´äº†å˜é‡çš„ä¸ä¸€è‡´æ€§ã€‚<br>volatileä¿®é¥°çš„å˜é‡ï¼Œä¸å…è®¸çº¿ç¨‹è¿›è¡Œæœ¬åœ°ç¼“å­˜ï¼Œæ¯ä¸ªçº¿ç¨‹çš„è¯»å†™éƒ½æ˜¯ç›´æ¥æ“ä½œåœ¨å…±äº«å†…å­˜ä¸Šï¼Œå†™æ“ä½œ å¯ä»¥ä¿è¯å†™åˆ°å…±äº«å†…å­˜ä¸Šï¼Œè¯»æ“ä½œä¹Ÿèƒ½ä¿è¯ä»å…±äº«å†…å­˜ä¸Šè¯»åˆ°æœ€æ–°çš„å€¼ï¼Œè¿™å°±èƒ½ä¿è¯å˜é‡å§‹ç»ˆå…·æœ‰ä¸€ è‡´æ€§ã€‚</p>
</blockquote>
<blockquote>
<p>ä½œç”¨<br>volatileå…³é”®å­—æœ‰ä¸¤ä¸ªä½œç”¨ã€‚<br>ç¬¬ä¸€ä¸ªå¯ä»¥ä¿è¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å…±äº«å˜é‡çš„å¯è§æ€§ã€‚<br>ç¬¬äºŒä¸ªæ˜¯å¯ä»¥é€šè¿‡å¢åŠ å†…å­˜å±éšœï¼Œå»é˜²æ­¢å¤šä¸ªæŒ‡ä»¤ä¹‹é—´çš„ä¸€ä¸ªé‡æ’åºã€‚<br>å¯è§æ€§æ˜¯æŒ‡å½“ä¸€ä¸ªçº¿ç¨‹å¯¹äºå…±äº«å˜é‡çš„ä¿®æ”¹ï¼Œå…¶å®ƒçº¿ç¨‹å¯ä»¥ç«‹åˆ»çœ‹åˆ°ä¿®æ”¹ä¹‹åçš„ä¸€ä¸ªå€¼ã€‚<br>å¯è§æ€§çš„é—®é¢˜æœ¬è´¨ä¸Šæ˜¯ç”±å‡ ä¸ªæ–¹é¢æ¥é€ æˆçš„ã€‚<br>é¦–å…ˆæ˜¯CPUå±‚é¢çš„é«˜é€Ÿç¼“å­˜ï¼Œåœ¨CPUé‡Œé¢è®¾è®¡äº†ä¸‰çº§ç¼“å­˜å»è§£å†³CPUè¿ç®—æ•ˆç‡å’Œå†…å­˜IOæ•ˆç‡çš„é—®é¢˜ï¼Œ ä½†æ˜¯å®ƒä¹Ÿå¸¦æ¥äº†ç¼“å­˜ä¸€è‡´æ€§çš„é—®é¢˜ã€‚<br>è€Œåœ¨å¤šçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œçš„æƒ…å†µä¸‹ï¼Œç¼“å­˜ä¸€è‡´æ€§é—®é¢˜å°±ä¼šå¯¼è‡´å¯è§æ€§é—®é¢˜ã€‚<br>æ‰€ä»¥å¯¹äºvolatileå…³é”®å­—ä¿®é¥°çš„å…±äº«å˜é‡ï¼ŒCLRä¼šè‡ªåŠ¨å¢åŠ ä¸€ä¸ª#Lockæ±‡ç¼–æŒ‡ä»¤ã€‚<br>è€Œè¿™ä¸ªæŒ‡ä»¤ä¼šå»æ ¹æ®ä¸åŒçš„CPUå‹å·ï¼Œå»è‡ªåŠ¨æ·»åŠ æ€»çº¿é”ï¼Œæˆ–è€…ç¼“å­˜é”ã€‚<br>æ€»çº¿é”ï¼Œé”å®šçš„æ˜¯CPUçš„å‰ç«¯æ€»çº¿ï¼Œä»è€Œå»å¯¼è‡´åœ¨åŒä¸€ä¸ªæ—¶åˆ»ï¼Œåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å’Œå†…å­˜é€šä¿¡ï¼Œè¿™æ ·å°± èƒ½é¿å…å¤šçº¿ç¨‹å¹¶å‘é€ æˆçš„å¯è§æ€§é—®é¢˜ã€‚<br>ç¼“å­˜é”ï¼Œæ˜¯å¯¹æ€»çº¿é”çš„ä¸€ä¸ªä¼˜åŒ–ï¼Œå› ä¸ºæ€»çº¿é”å¯¼è‡´CPUçš„ä½¿ç”¨æ•ˆç‡å¤§å¹…åº¦ä¸‹é™ã€‚æ‰€ä»¥ç¼“å­˜é”ï¼Œåªé’ˆå¯¹ äºCPUä¸‰çº§ç¼“å­˜ä¸­çš„ç›®æ ‡æ•°æ®å»åŠ é”ï¼Œç¼“å­˜é”æ˜¯ä½¿ç”¨MESIç¼“å­˜ä¸€è‡´æ€§åè®®æ¥å®ç°çš„ã€‚<br>æŒ‡ä»¤é‡æ’åºçš„é—®é¢˜ï¼Œå°±æ˜¯è¯´æŒ‡ä»¤åœ¨ç¼–å†™çš„æ•°æ®å’Œæ‰§è¡Œçš„é¡ºåºæ˜¯ä¸ä¸€è‡´çš„ï¼Œä»è€Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯¼è‡´å¯ è§æ€§çš„é—®é¢˜ã€‚<br>æŒ‡ä»¤é‡æ’åºæœ¬è´¨ä¸Šæ˜¯ä¸€ç§æ€§èƒ½ä¼˜åŒ–çš„æ‰‹æ®µï¼Œå®ƒæ¥è‡ªäºå‡ ä¸ªæ–¹é¢ã€‚<br>é¦–å…ˆæ˜¯CPUå±‚é¢ï¼Œé’ˆå¯¹äºMESIåè®®çš„æ›´è¿›ä¸€æ­¥çš„ä¼˜åŒ–ï¼Œå»æå‡CPUçš„ä¸€ä¸ªåˆ©ç”¨ç‡ï¼Œæ‰€ä»¥å®ƒå¼•å…¥äº†ä¸€ ä¸ªå«StoreBufferçš„ä¸€ä¸ªæœºåˆ¶ï¼Œè€Œè¿™ç§ä¼˜åŒ–æœºåˆ¶ï¼Œä¼šå¯¼è‡´CPUçš„ä¹±åºæ‰§è¡Œã€‚<br>ä¸ºäº†é¿å…è¿™æ ·çš„é—®é¢˜ï¼ŒCPUæä¾›äº†å†…å­˜å±éšœæŒ‡ä»¤ï¼Œä¸Šå±‚åº”ç”¨å¯ä»¥åœ¨åˆé€‚çš„åœ°æ–¹å»æ’å…¥å†…å­˜å±éšœï¼Œå»é¿ å…CPUæŒ‡ä»¤é‡æ’åºçš„ä¸€ä¸ªé—®é¢˜ã€‚<br>è¿˜æœ‰ç¼–è¯‘å™¨å±‚é¢çš„ä¼˜åŒ–ï¼Œç¼–è¯‘å™¨åœ¨ç¼–è¯‘çš„è¿‡ç¨‹ä¸­ï¼Œåœ¨ä¸æ”¹å˜å•çº¿ç¨‹è¯­ä¹‰å’Œç¨‹åºæ­£ç¡®æ€§çš„å‰æä¸‹ï¼Œå¯¹æŒ‡ ä»¤è¿›è¡Œåˆç†çš„é‡æ’åºï¼Œä»è€Œå»ä¼˜åŒ–æ•´ä½“çš„ä¸€ä¸ªæ€§èƒ½ã€‚<br>æ‰€ä»¥ï¼Œå¯¹äºå…±äº«å˜é‡å¢åŠ volatileå…³é”®å­—ï¼Œç¼–è¯‘å™¨å±‚é¢å°±ä¸ä¼šå»è§¦å‘ç¼–è¯‘å™¨çš„ä¼˜åŒ–ï¼ŒåŒæ—¶åœ¨CLRé‡Œé¢ï¼Œ å®ƒä¼šå»æ’å…¥å†…å­˜å±éšœæŒ‡ä»¤ï¼Œæ¥é¿å…é‡æ’åºçš„é—®é¢˜ã€‚</p>
</blockquote>
<h2 id="åå°çº¿ç¨‹-x2F-å‰å°çº¿ç¨‹"><a href="#åå°çº¿ç¨‹-x2F-å‰å°çº¿ç¨‹" class="headerlink" title="åå°çº¿ç¨‹&#x2F;å‰å°çº¿ç¨‹"></a>åå°çº¿ç¨‹&#x2F;å‰å°çº¿ç¨‹</h2><blockquote>
<p>åå°çº¿ç¨‹ï¼Œè¿›ç¨‹ç»“æŸï¼Œçº¿ç¨‹ç»“æŸã€‚<br>å‰å°çº¿ç¨‹ï¼Œä»»åŠ¡ç»“æŸï¼Œçº¿ç¨‹ç»“æŸã€‚</p>
</blockquote>
<blockquote>
<p>Threadé‡Œé¢Sleepå’ŒJoinçš„åŒºåˆ«<br>Sleepæ˜¯ä¸»çº¿ç¨‹è‡ªå·±é˜»å¡è‡ªå·±ï¼ŒJoinæ˜¯å­çº¿ç¨‹é˜»å¡ä¸»çº¿ç¨‹ã€‚</p>
</blockquote>
<h2 id="Thred-x2F-TreadPool"><a href="#Thred-x2F-TreadPool" class="headerlink" title="Thred&#x2F;TreadPool"></a>Thred&#x2F;TreadPool</h2><blockquote>
<p>ThreadPoolå…¶å®å°±æ˜¯Treadçš„é›†åˆï¼Œåœ¨ä»»åŠ¡å¤šçš„æ—¶å€™å…¨å±€é˜Ÿåˆ—ä¼šå­˜åœ¨ç«äº‰è€Œæ¶ˆè€—èµ„æºã€‚<br>Threadé»˜è®¤æ˜¯å‰å°çº¿ç¨‹ã€‚<br>ThreadPoolæ²¡æœ‰å¾ˆå¥½çš„APIåŒºåŸŸæ§åˆ¶ï¼Œå¦‚æœçº¿ç¨‹æ‰§è¡Œæ— å“åº”å°±åªèƒ½ç­‰å¾…ç»“æŸï¼Œä»è€Œäº§ç”ŸTaskã€‚</p>
</blockquote>
<h2 id="å¦‚ä½•ç†è§£çº¿ç¨‹å®‰å…¨"><a href="#å¦‚ä½•ç†è§£çº¿ç¨‹å®‰å…¨" class="headerlink" title="å¦‚ä½•ç†è§£çº¿ç¨‹å®‰å…¨"></a>å¦‚ä½•ç†è§£çº¿ç¨‹å®‰å…¨</h2><blockquote>
<p>åœ¨å¤šä¸ªçº¿ç¨‹å»è®¿é—®æŸä¸ªæ–¹æ³•æˆ–è€…å¯¹è±¡çš„æ—¶å€™ï¼Œä¸ç®¡é€šè¿‡ä»»ä½•æ–¹å¼çš„è°ƒç”¨ï¼Œæˆ–è€…çº¿ç¨‹å¦‚ä½•å»äº¤æ›¿æ‰§è¡Œã€‚<br>åœ¨ç¨‹åºä¸­ï¼Œä¸åšä»»ä½•åŒæ­¥å¹²é¢„çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæ–¹æ³•æˆ–è€…å¯¹è±¡çš„æ‰§è¡Œï¼Œéƒ½èƒ½å¤ŸæŒ‰ç…§é¢„æœŸçš„ç»“æœ æ¥è¿”å›ã€‚<br>é‚£ä¹ˆè¿™ä¸ªç±»ï¼Œå°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚<br>çº¿ç¨‹å®‰å…¨é—®é¢˜çš„å…·ä½“è¡¨ç°ä¸»è¦å°±æ˜¯åŸå­æ€§ã€‚<br>åŸå­æ€§å°±æ˜¯ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œä¸€ç³»åˆ—ç¨‹åºæŒ‡ä»¤æ“ä½œçš„æ—¶å€™ï¼Œå®ƒåº”è¯¥æ˜¯ä¸å¯ä¸­æ–­çš„ã€‚<br>å› ä¸ºä¸€æ—¦å‡ºç°äº†ä¸­æ–­ï¼Œç«™åœ¨å¤šçº¿ç¨‹çš„è§’åº¦æ¥çœ‹ï¼Œè¿™ä¸€ç³»åˆ—çš„ç¨‹åºæŒ‡ä»¤ï¼Œä¼šå‡ºç°å‰åæ‰§è¡Œç»“æœä¸ä¸€è‡´çš„ é—®é¢˜ã€‚è¿™ä¸ªå’Œæ•°æ®åº“é‡Œé¢çš„åŸå­æ€§æ˜¯ä¸€æ ·çš„ã€‚</p>
</blockquote>
<h2 id="å¤šçº¿ç¨‹å¹¶å‘é—®é¢˜"><a href="#å¤šçº¿ç¨‹å¹¶å‘é—®é¢˜" class="headerlink" title="å¤šçº¿ç¨‹å¹¶å‘é—®é¢˜"></a>å¤šçº¿ç¨‹å¹¶å‘é—®é¢˜</h2><blockquote>
<p>çº¿ç¨‹é”ï¼šLockä¸èƒ½ç”¨stringï¼Œå¦‚æœå£°æ˜çš„ä¸¤ä¸ªstringå†…å®¹ä¸€æ ·ï¼Œä¼šå½¢æˆæ­»é”ã€‚<br>å¯ä»¥ç”¨LockåŠ é”ï¼Œä¿è¯çº¿ç¨‹å®‰å…¨ã€‚<br>å¯ä»¥ç”¨.Netæ¡†æ¶æä¾›çš„çº¿ç¨‹å®‰å…¨çš„é›†åˆæ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚<br>çº¿ç¨‹å–æ¶ˆ<br>CancellationTokenSource</p>
</blockquote>
<h2 id="çº¿ç¨‹é€šä¿¡"><a href="#çº¿ç¨‹é€šä¿¡" class="headerlink" title="çº¿ç¨‹é€šä¿¡"></a>çº¿ç¨‹é€šä¿¡</h2><blockquote>
<p>SynchronizationContextè¡¨ç¤ºçº¿ç¨‹ä¸Šä¸‹æ–‡ï¼Œå®ç°ä¸€ä¸ªçº¿ç¨‹å’Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹çš„é€šè®¯ã€‚</p>
</blockquote>
<blockquote>
<p>Send:å½“å‰çº¿ç¨‹ä¸Šå»è°ƒç”¨å§”æ‰˜å®ç°ï¼ŒåŒæ­¥è°ƒç”¨ã€‚å­çº¿ç¨‹ä¸Šç›´æ¥è°ƒç”¨UIçº¿ç¨‹æ‰§è¡Œï¼Œç­‰UIçº¿ç¨‹æ‰§è¡Œå®Œå­çº¿ ç¨‹æ‰æ‰§è¡Œã€‚</p>
</blockquote>
<blockquote>
<p>Post:åœ¨çº¿ç¨‹æ± ä¸Šå»è°ƒç”¨å§”æ‰˜å®ç°ï¼Œå¼‚æ­¥è°ƒç”¨ã€‚å­çº¿ç¨‹ä¼šä»çº¿ç¨‹æ± ä¸­æ‰¾å‡ºä¸€ä¸ªçº¿ç¨‹å»è°ƒUIçº¿ç¨‹ï¼Œå­çº¿ç¨‹ ä¸ç­‰çš„UIçº¿ç¨‹çš„å®Œæˆè€Œç›´æ¥æ‰§è¡Œè‡ªå·±çš„é€»è¾‘ã€‚</p>
</blockquote>
<h2 id="å¼‚æ­¥æ“ä½œ"><a href="#å¼‚æ­¥æ“ä½œ" class="headerlink" title="å¼‚æ­¥æ“ä½œ"></a>å¼‚æ­¥æ“ä½œ</h2><blockquote>
<p>å¼‚æ­¥æ“ä½œæ˜¯æ‰§è¡ŒæŸé¡¹æ“ä½œåä¸ç­‰å¾…ç»“æŸï¼Œä½†æ˜¯å¯ä»¥åœ¨æ“ä½œç»“æŸåæ”¶åˆ°é€šçŸ¥ã€‚</p>
</blockquote>
<blockquote>
<p>ä¸€ä¸ªçº¿ç¨‹çš„æ ˆç©ºé—´ï¼Œé»˜è®¤ä¼šåˆ†é…8-10Mçš„ç©ºé—´ï¼Œæ ˆç©ºé—´æ˜¯åœ¨å†…å­˜é‡Œçš„ï¼Œå¤ªå¤šçš„çº¿ç¨‹å°±ä¼šè®©å†…å­˜ä¸è¶³ã€‚<br>çº¿ç¨‹çš„åˆ›å»ºéƒ½æ˜¯éœ€è¦æ¶ˆè€—å†…å­˜ç©ºé—´çš„ï¼Œæ¯åˆ›å»ºä¸€ä¸ªæ ˆç©ºé—´éƒ½ä¼šäº§ç”Ÿå†…å­˜çš„å¼€é”€ï¼Œå½“å†…å­˜çš„ä½¿ç”¨è¶…è¿‡äº† ç‰©ç†å†…å­˜çš„æ—¶å€™ï¼Œé‚£ä¹ˆä¸€éƒ¨åˆ†çš„æ•°æ®å°±ä¼šæ”¾åˆ°ç£ç›˜ä¸Šï¼Œéšä¹‹è€Œæ¥çš„å°±æ˜¯æ€§èƒ½å¤§å¹…åº¦ä¸‹é™ã€‚<br>è€Œä¸”å¤ªå¤šçš„çº¿ç¨‹ä¹Ÿä¼šè®©æ“ä½œç³»ç»Ÿå»è°ƒåº¦çº¿ç¨‹æ‰€èŠ±è´¹çš„æ—¶é—´å˜é•¿ï¼Œä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚</p>
</blockquote>
<blockquote>
<p>è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•ä¹‹ä¸€å°±æ˜¯äº‹ä»¶å¾ªç¯æœºåˆ¶ã€‚</p>
</blockquote>
<blockquote>
<p>äº‹ä»¶å¾ªç¯æœºåˆ¶å°±æ˜¯ç¨‹åºä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ä¸“é—¨ç”¨äºæ•è·å¯¹è±¡çš„æ£€æŸ¥çŠ¶æ€ï¼ŒæŠŠæ‰§è¡Œçš„é˜»å¡æ“ä½œæ¢æˆé é˜»å¡æ“ä½œï¼Œç„¶åå†å»æ³¨å†Œäº‹ä»¶èƒ½åœ¨å¤„ç†å®Œæˆåæ”¶åˆ°é€šçŸ¥ã€‚<br>JSæ˜¯å•çº¿ç¨‹çš„ï¼ŒJSä¸­çš„å¼‚æ­¥å°±æ˜¯ä½¿ç”¨äº‹ä»¶å¾ªç¯æœºåˆ¶æ¥å®ç°çš„ï¼Œæ¯”å¦‚DOMäº‹ä»¶ï¼Œajaxï¼Œaxioséƒ½æ˜¯å¼‚æ­¥ äº‹ä»¶ã€‚è¿™ç§åšæ³•å°±é¿å…äº†åŒæ—¶æ‰§è¡Œé˜»å¡æ“ä½œè€Œéœ€è¦å¤šä¸ªçº¿ç¨‹æ‰§è¡Œçš„é—®é¢˜ï¼Œä½†æ˜¯è¿™ç§äº‹ä»¶å¾ªç¯æœºåˆ¶çš„ ä»£ç éš¾åº¦éå¸¸é«˜ï¼Œæ‰€ä»¥æä¾›äº†ä¸€äº›åŸºäºå›è°ƒ çš„å¼‚æ­¥æ“ä½œï¼Œåœ¨æ‰§è¡Œå¼‚æ­¥æ“ä½œçš„æ—¶å€™åœ¨æ‰§è¡Œä¸€ä¸ªéé˜»å¡æ“ ä½œï¼Œç„¶åæ³¨å†Œäº‹ä»¶ï¼Œå…³è”å›è°ƒï¼Œèƒ½è®©æ¥æ”¶äº‹ä»¶ä¹‹åï¼Œè‡ªåŠ¨å…³è”ä¹‹å‰çš„å›è°ƒã€‚</p>
</blockquote>
<blockquote>
<p>.NETä¸­çš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹åœ¨windowsä¸Šå°±æ˜¯åŸºäºIOCPæ¥å®ç°çš„ï¼ŒIOCPç®€å•æ¥è¯´å°±æ˜¯ä¸€ç»„æ”¯æŒå¤šä¸ªåŒæ—¶ å‘ç”Ÿçš„å¼‚æ­¥IOæ“ä½œæ¥å£ã€‚åœ¨Linuxä¸Šæ˜¯åŸºäºEpollæ¨¡å‹æ¥å®ç°çš„ï¼ŒEpollæ¨¡å‹å°±æ˜¯ä¸€ä¸ªå¤šè·¯å¤ç”¨çš„IOæ¥ å£ã€‚</p>
</blockquote>
<blockquote>
<p>ç”±äºåŸºäºå›è°ƒçš„è¿™ä¸ªå¼‚æ­¥ç¼–ç¨‹æ¨¡å‹çš„é€šç”¨æ€§ä¸å¼ºï¼Œ.NETåœ¨å…¶åŸºç¡€ä¹‹ä¸Šåˆå°è£…äº†ä¸€å±‚ï¼Œä»¥ä»»åŠ¡ä¹Ÿå°±æ˜¯Task ä¸ºåŸºç¡€çš„æ¥å£ï¼Œä¹Ÿå°±æ˜¯ä»»åŠ¡å¹¶è¡Œåº“TPLï¼ŒTPLæœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯åˆ†ç¦»äº†æ‰§è¡Œå¼‚æ­¥æ“ä½œä¸æ³¨å†Œå›è°ƒçš„å¤„ç†ï¼Œ è¿™æ ·ä¸€æ¥å°±å¯ä»¥è®©ä»»ä½•å¼‚æ­¥æ“ä½œéƒ½å…·æœ‰ç›¸åŒçš„æ–¹æ³•æ³¨å†Œå›è°ƒï¼Œç­‰å¾…ç»“æŸå’Œå¤„ç†é”™è¯¯ï¼Œä¸ºä¹‹åçš„aysnc å’Œawaitæ‰“ä¸‹äº†ä¸€ä¸ªåŸºç¡€ã€‚</p>
</blockquote>
<blockquote>
<p>Taskç±»å‹å°±æ˜¯è¡¨ç¤ºæ‰§è¡Œäº†ä¸€ä¸ªå¼‚æ­¥çš„æ–¹æ³•ã€‚<br>å¦‚æœä½¿ç”¨Taskç±»å‹ä½œä¸ºè¿”å›ç»“æœå»åˆ›å»º100ä¸ªTaskå¯¹è±¡ï¼Œè€ŒTaskç±»å‹åˆæ˜¯ä¸ªå¼•ç”¨ç±»å‹ï¼Œé‚£ä¹ˆåˆ›å»ºå¯¹ è±¡çš„æ—¶å€™å°±ä¼šä»æ‰˜ç®¡å †ä¸­å»åˆ†é…å†…å­˜ï¼Œåˆ›å»ºè¿‡å¤šçš„å¼•ç”¨ç±»å‹å¯¹è±¡åˆä¼šé¢‘ç¹çš„è§¦å‘GCï¼Œä»è€Œå½±å“ç¨‹åºçš„ æ‰§è¡Œæ€§èƒ½ï¼Œé‚£ä¸ºäº†å‡å°‘è¿™ç§åœºæ™¯ä¸‹çš„æ€§èƒ½æ¶ˆè€—ï¼Œåœ¨.NETé‡Œé¢è¿˜æä¾›äº†ä¸€ä¸ªValueTaskç±»å‹ã€‚å®ƒå®é™…ä¸Šæ˜¯ ä¸€ä¸ªTaskç±»å‹çš„åŒ…è£…ç±»ï¼Œæ˜¯ä¸ªå€¼ç±»å‹ï¼Œåˆ›å»ºå®ƒçš„æ—¶å€™æ˜¯ä¸éœ€è¦ä»æ‰˜ç®¡å †ä¸­åˆ†é…å†…å­˜çš„ã€‚å¦‚æœå¼‚æ­¥æ“ä½œ å¯ä»¥åŒæ­¥å®Œæˆï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥é€‰æ‹©ä¸€ä¸ªå«åšValueTaskçš„ç±»å‹ï¼Œå›è°ƒå¯ä»¥ç«‹åˆ»è¢«è°ƒç”¨ï¼Œå¹¶ä¸”æ²¡æœ‰ä»»ä½• é¢å¤–çš„å¼€é”€ã€‚</p>
</blockquote>
<h3 id="Task"><a href="#Task" class="headerlink" title="Task"></a>Task</h3><p>Taskç±»å‹å°±æ˜¯è¡¨ç¤ºæ‰§è¡Œäº†ä¸€ä¸ªå¼‚æ­¥çš„æ–¹æ³•ã€‚<br>å¦‚æœä½¿ç”¨Taskç±»å‹ä½œä¸ºè¿”å›ç»“æœå»åˆ›å»º100ä¸ªTaskå¯¹è±¡ï¼Œè€ŒTaskç±»å‹åˆæ˜¯ä¸ªå¼•ç”¨ç±»å‹ï¼Œé‚£ä¹ˆåˆ›å»ºå¯¹ è±¡çš„æ—¶å€™å°±ä¼šä»æ‰˜ç®¡å †ä¸­å»åˆ†é…å†…å­˜ï¼Œåˆ›å»ºè¿‡å¤šçš„å¼•ç”¨ç±»å‹å¯¹è±¡åˆä¼šé¢‘ç¹çš„è§¦å‘GCï¼Œä»è€Œå½±å“ç¨‹åºçš„ æ‰§è¡Œæ€§èƒ½ï¼Œé‚£ä¸ºäº†å‡å°‘è¿™ç§åœºæ™¯ä¸‹çš„æ€§èƒ½æ¶ˆè€—ï¼Œåœ¨.NETé‡Œé¢è¿˜æä¾›äº†ä¸€ä¸ªValueTaskç±»å‹ã€‚å®ƒå®é™…ä¸Š æ˜¯ä¸€ä¸ªTaskç±»å‹çš„åŒ…è£…ç±»ï¼Œæ˜¯ä¸ªå€¼ç±»å‹ï¼Œåˆ›å»ºå®ƒçš„æ—¶å€™æ˜¯ä¸éœ€è¦ä»æ‰˜ç®¡å †ä¸­åˆ†é…å†…å­˜çš„ã€‚å¦‚æœå¼‚æ­¥æ“ ä½œå¯ä»¥åŒæ­¥å®Œæˆï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥é€‰æ‹©ä¸€ä¸ªå«åšValueTaskçš„ç±»å‹ï¼Œå›è°ƒå¯ä»¥ç«‹åˆ»è¢«è°ƒç”¨ï¼Œå¹¶ä¸”æ²¡æœ‰ä»» ä½•é¢å¤–çš„å¼€é”€ã€‚</p>
<p>Task.Wait():å°±æ˜¯ç­‰å¾…ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼ŒTaskçŠ¶æ€å˜ä¸ºCompletedã€‚<br>Task.WaitAll():ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆã€‚<br>Task.WaitAny():ç­‰å¾…ä»»ä½•ä¸€ä¸ªä»»åŠ¡å®Œæˆå°±ç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚<br>Task.ContinueWith():ç¬¬ä¸€ä¸ªTaskå®Œæˆåè‡ªåŠ¨å¯åŠ¨ä¸‹ä¸€ä¸ªTaskï¼Œè¿›è¡ŒTaskçš„å»¶ç»­ã€‚</p>
<p>Task.Run&#x2F;Task.Factory.StartNew<br>Task.Runå°±æ˜¯ç®€å•çš„å°†å·¥ä½œäº¤ç»™çº¿ç¨‹æ± å¤„ç†ã€‚<br>Task.Runçš„å‚æ•°TaskSchedulerå–çš„æ˜¯é»˜è®¤å¯¹è±¡Defaultã€‚<br>TaskSchedulerå¯ä»¥ç”¨æ¥æ§åˆ¶ä»»åŠ¡çš„è°ƒåº¦å’Œè¿è¡Œã€‚<br>Task.Factory.StartNewå¯ä»¥åšåˆ°æ›´ç²¾ç»†çš„æ§åˆ¶ã€‚<br>TaskCreationOptionså¯ä»¥ç”¨æ¥æ§åˆ¶ä»»åŠ¡çš„è¡Œä¸ºã€‚</p>
<h3 id="Thread-x2F-ThreadPool-x2F-Task-x2F-Parallel"><a href="#Thread-x2F-ThreadPool-x2F-Task-x2F-Parallel" class="headerlink" title="Thread&#x2F;ThreadPool&#x2F;Task&#x2F;Parallel"></a>Thread&#x2F;ThreadPool&#x2F;Task&#x2F;Parallel</h3><blockquote>
<p>Treadçš„ä¼˜ç‚¹åœ¨äºæä¾›äº†ä¸°å¯Œçš„å¤šçº¿ç¨‹æ“ä½œAPIï¼Œç¼ºç‚¹åœ¨äºçº¿ç¨‹çš„ä¸ªæ•°ä½¿ç”¨ä¸åŠ ä»¥é™åˆ¶ï¼Œä»¥åŠæ— æ³•å¤ç”¨ çº¿ç¨‹ï¼Œå› æ­¤æ¨å‡ºäº†TreadPoolæŠ€æœ¯ã€‚</p>
</blockquote>
<blockquote>
<p>TreadPoolçš„ä¼˜ç‚¹åœ¨äºè§£å†³äº†çº¿ç¨‹çš„ä¸ªæ•°é™åˆ¶ä»¥åŠçº¿ç¨‹çš„å¤ç”¨ï¼Œç¼ºç‚¹åœ¨äºAPIè¾ƒå°‘è€Œä¸”çº¿ç¨‹çš„ç­‰å¾…é—®é¢˜ è§£å†³èµ·æ¥è¾ƒä¸ºéº»çƒ¦ï¼Œæ‰€ä»¥æ¨å‡ºäº†Taskã€‚</p>
</blockquote>
<blockquote>
<p>Taskçš„ä¼˜ç‚¹åœ¨äºä¸°å¯Œçš„APIï¼Œä»¥åŠå¤šçº¿ç¨‹çš„æ–¹ä¾¿ç®¡ç†ï¼Œç¼ºç‚¹åœ¨äºçº¿ç¨‹çš„æ•°é‡æ§åˆ¶èµ·æ¥è¾ƒä¸ºéº»çƒ¦ï¼Œå› æ­¤æ¨ å‡ºäº†ParallelæŠ€æœ¯ã€‚</p>
</blockquote>
<blockquote>
<p>Parallelçš„ä¼˜ç‚¹åœ¨äºä¸°å¯Œçš„APIï¼Œå¤šçº¿ç¨‹æ–¹ä¾¿ç®¡ç†ï¼Œçº¿ç¨‹çš„æ•°é‡æ§åˆ¶èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯ä¸»çº¿ç¨‹ä¹Ÿä¼šå‚ ä¸è®¡ç®—ï¼Œå¯¼è‡´ä¸»çº¿ç¨‹çš„é˜»å¡ï¼Œä½†æ˜¯è¿™ä¸ªé—®é¢˜å¯ä»¥ç”¨Task.Runæ¥åŒ…ä¸€å±‚è§£å†³ã€‚</p>
</blockquote>
<h4 id="Parallel"><a href="#Parallel" class="headerlink" title="Parallel"></a>Parallel</h4><blockquote>
<p>å¤šçº¿ç¨‹è¿›è¡Œå¹¶è¡Œè¿­ä»£</p>
</blockquote>
<h4 id="TreadPool"><a href="#TreadPool" class="headerlink" title="TreadPool"></a>TreadPool</h4><blockquote>
<p>ä¸æ–­çš„å¼€å¯çº¿ç¨‹å’Œé”€æ¯ï¼Œå­˜åœ¨å¾ˆå¤§å¼€é”€ï¼Œæ± åŒ–æ€æƒ³ï¼Œç”¨å®Œæ”¾å›çº¿ç¨‹æ± ï¼Œä¸é”€æ¯ï¼Œäº«å…ƒæ¨¡å¼ã€‚</p>
</blockquote>
<blockquote>
<p>çº¿ç¨‹æ± è¿˜å¯ä»¥æ§åˆ¶çº¿ç¨‹æ€»æ•°é‡ã€‚ManualResetEvent</p>
</blockquote>
<blockquote>
<p>TreadPoolçº¿ç¨‹å¼å¼€å…³ï¼šManualResetEvent</p>
</blockquote>
<h3 id="async-x2F-await"><a href="#async-x2F-await" class="headerlink" title="async&#x2F;await"></a>async&#x2F;await</h3><blockquote>
<p>ç”¨asyncå’Œawaitè¿™ä¸¤ä¸ªç»„åˆå¯ä»¥ç®€åŒ–å¼‚æ­¥æ–¹æ³•çš„ç¼–å†™ã€‚</p>
</blockquote>
<blockquote>
<p>å¦‚æœä¸»çº¿ç¨‹é‡åˆ°äº†awaitå…³é”®å­—ï¼Œä¸»çº¿ç¨‹å°±ä¼šå›æ¥æ‰§è¡Œè‡ªå·±çš„é€»è¾‘ï¼Œawaitç­‰å¾…çš„ä»»åŠ¡æ˜¯æ–°å¼€å¯çº¿ç¨‹çš„ æ‰§è¡Œï¼Œawaitåé¢çš„ä»£ç ç­‰åˆ°æ–°å¼€å¯çº¿ç¨‹çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ä»¥åå†æ‰§è¡Œã€‚</p>
</blockquote>
<blockquote>
<p>æ‰€ä»¥ç”¨asyncå’Œawaitè¿™ç»„å…³é”®å­—ï¼Œå®ƒæ˜¯ä¸é˜»å¡ä¸»çº¿ç¨‹çš„ã€‚</p>
</blockquote>
<blockquote>
<p>å¼‚æ­¥çš„æ€§èƒ½å®é™…ä¸Šæ¯”å¤šçº¿ç¨‹è¦é«˜ï¼Œå¼‚æ­¥å†…éƒ¨ä½¿ç”¨çš„æ˜¯çº¿ç¨‹æ± ï¼Œæ± é‡Œé¢çš„çº¿ç¨‹åŸºæœ¬ä¸Šéƒ½å¤„äºæ¿€æ´»çŠ¶æ€ï¼Œ å®ƒä¸ä¼šåå¤çš„å»é€ æˆå¤šæ¬¡çš„çº¿ç¨‹åˆ‡æ¢ï¼Œçº¿ç¨‹åˆ‡æ¢æ¶ˆè€—çš„æ€§èƒ½ä¸»è¦æ˜¯ä¸Šä¸‹æ–‡çš„åˆ‡æ¢ï¼Œä¸Šä¸‹æ–‡çš„åˆ‡æ¢ä¸»è¦ å°±æ˜¯å”¤é†’å’Œç­‰å¾…ï¼Œè¿™ä¸¤ä¸ªåˆ‡æ¢æ˜¯æ¯”è¾ƒæ¶ˆè€—èµ„æºçš„ï¼Œä½†æ˜¯åœ¨çº¿ç¨‹æ± é‡Œé¢çš„çº¿ç¨‹éƒ½æ˜¯å±äºå”¤é†’çŠ¶æ€çš„, æ‰€ ä»¥è¿™ä¸ªæ—¶å€™æ˜¯æ²¡æœ‰ä»€ä¹ˆæ€§èƒ½æ¶ˆè€—çš„ã€‚æ‰€ä»¥è¯´ç°åœ¨èƒ½ç”¨å¼‚æ­¥å°±ç”¨å¼‚æ­¥ï¼Œæ— è„‘å¼‚æ­¥ã€‚</p>
</blockquote>
<blockquote>
<p>async&#x2F;awaitä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹å—?<br>ä¸ä¼šã€‚aync&#x2F;awaitå…³é”®å­—æœ¬èº«ä¸ä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹ï¼Œawaitçš„æ–¹æ³•å†…éƒ¨ä¸€èˆ¬ä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹ã€‚</p>
</blockquote>
<blockquote>
<p>MVC&#x2F;WebAPIä¸­çš„Actionä¸­ä½¿ç”¨aync&#x2F;awaitä¼šæé«˜è¯·æ±‚çš„å“åº”é€Ÿåº¦å—ï¼Ÿ<br>ä¸ä¼šã€‚<br>Webåº”ç”¨æœ¬èº«å°±æ˜¯å¤šçº¿ç¨‹æ¨¡å¼ï¼ŒæœåŠ¡å™¨ä¼šä¸ºæ¯ä¸ªHTTPçš„è¯·æ±‚åˆ†é…å·¥ä½œçº¿ç¨‹ã€‚<br>ä½¿ç”¨åŒæ­¥æ–¹æ³•æ—¶ï¼Œçº¿ç¨‹ä¼šè¢«è€—æ—¶æ“ä½œä¸€ç›´å æœ‰ï¼Œç›´åˆ°è€—æ—¶æ“ä½œå®Œæˆã€‚<br>ä½¿ç”¨å¼‚æ­¥æ–¹æ³•æ—¶ï¼Œç¨‹åºèµ°åˆ°awaitå…³é”®å­—æ—¶ä¼šç«‹å³returnï¼Œé‡Šæ”¾å½“å‰çš„çº¿ç¨‹ï¼Œä½™ä¸‹çš„ä»£ç ä¼šè¿›å…¥åˆ°ä¸€ä¸ª å›è°ƒä¸­ï¼Œè€—æ—¶æ“ä½œå®Œæˆæ—¶æ‰ä¼šè§¦å‘å›è°ƒå»æ‰§è¡Œã€‚<br>åƒç£ç›˜çš„IOæˆ–è€…ç½‘ç»œçš„IOï¼Œå¦‚æœæœ‰è€—æ—¶æ“ä½œæ—¶æ‰è€ƒè™‘ä½¿ç”¨å¼‚æ­¥æ“ä½œã€‚<br>asyncå’Œawaitè¿™ç»„å…³é”®å­—ï¼Œå®ƒä¹Ÿä¸èƒ½æå‡HTTPè¯·æ±‚çš„å“åº”é€Ÿåº¦ï¼Œä½†æ˜¯å¯ä»¥æå‡HTTPè¯·æ±‚çš„å“åº”èƒ½åŠ› (ååé‡)ã€‚</p>
</blockquote>
<h4 id="async-x2F-awaitåŸç†"><a href="#async-x2F-awaitåŸç†" class="headerlink" title="async&#x2F;awaitåŸç†"></a>async&#x2F;awaitåŸç†</h4><blockquote>
<p>è·ŸåŒæ­¥æ–¹æ³•ç›¸æ¯”ï¼ŒCLRåœ¨æ‰§è¡Œå¼‚æ­¥æ–¹æ³•çš„æ—¶å€™ï¼Œå®ƒæœ‰å‡ ä¸ªä¸åŒçš„ç‰¹ç‚¹ã€‚<br>å¼‚æ­¥æ–¹æ³•å®ƒå¹¶ä¸æ˜¯ä¸€æ¬¡æ€§å°±æ‰§è¡Œå®Œæˆçš„ï¼Œè€Œæ˜¯åˆ†äº†å¤šæ¬¡æ‰§è¡Œæ‰å®Œæˆçš„ã€‚<br>è€Œä¸”å¼‚æ­¥æ–¹æ³•ä¹Ÿä¸æ˜¯ç”±åŒä¸€ä¸ªçº¿ç¨‹æ¥å®Œæˆæ‰§è¡Œçš„ï¼Œè€Œæ˜¯ä»çº¿ç¨‹æ± é‡Œé¢æ¯æ¬¡åŠ¨æ€åˆ†é…ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œã€‚<br>æ‰€ä»¥ç»“åˆå¼‚æ­¥æ–¹æ³•çš„è¿™äº›æ‰§è¡Œç‰¹ç‚¹ï¼ŒC#ç¼–è¯‘å™¨ä¼šå°†å¼‚æ­¥æ–¹æ³•è½¬æ¢æˆä¸€ä¸ªçŠ¶æ€æœºçš„ç»“æ„ã€‚è¿™ç§ç»“æ„å®ƒèƒ½ è¿›è¡ŒæŒ‚èµ·å’Œæ¢å¤ã€‚<br>è€Œä¸”å®ƒçš„æ‰§è¡Œæ–¹å¼ä¹Ÿæ˜¯ä¸€ç§å·¥ä½œæµçš„æ–¹å¼ã€‚</p>
</blockquote>
<h4 id="async-x2F-awatiæ‰§è¡Œæ­¥éª¤"><a href="#async-x2F-awatiæ‰§è¡Œæ­¥éª¤" class="headerlink" title="async&#x2F;awatiæ‰§è¡Œæ­¥éª¤"></a>async&#x2F;awatiæ‰§è¡Œæ­¥éª¤</h4><blockquote>
<p>CLRä¼šåˆ›å»ºäº†ä¸€ä¸ªçŠ¶æ€æœºï¼Œè¿™ä¸ªçŠ¶æ€æœºçš„æ“ä½œæ•°é»˜è®¤å€¼æ˜¯-1ã€‚<br>ç„¶åå¼€å§‹æ‰§è¡ŒçŠ¶æ€æœºã€‚<br>çŠ¶æ€æœºé€šè¿‡è¿™ä¸ªæ“ä½œæ•°æ¥é€‰æ‹©æ‰§è¡Œçš„è·¯å¾„ã€‚<br>çŠ¶æ€æœºè°ƒç”¨GetAwaiteræ–¹æ³•æ¥è·å–ä¸€ä¸ªç­‰å¾…çš„å¯¹è±¡awaiterï¼Œå®ƒçš„ç±»å‹æ˜¯TaskAwaiterã€‚<br>çŠ¶æ€æœºåœ¨è·å–awaiterå¯¹è±¡ä¹‹åï¼Œä¼šæŸ¥è¯¢awaiterå¯¹è±¡çš„IsCompletedå±æ€§ã€‚<br>å¦‚æœIsCompletedå±æ€§ä¸ºTrueï¼Œé‚£ä¹ˆæ“ä½œå°±ä¼šä»¥åŒæ­¥çš„æ–¹å¼æ¥æ‰§è¡Œã€‚<br>å¦‚æœIsCompletedå±æ€§ä¸ºFalseï¼Œé‚£ä¹ˆæ“ä½œå°±ä¼šä»¥å¼‚æ­¥çš„æ–¹å¼æ¥æ‰§è¡Œï¼Œç„¶åçŠ¶æ€æœºä¼šè°ƒç”¨awaiterå¯¹è±¡çš„ OnCompletedæ–¹æ³•å¹¶ç»™å®ƒä¼ é€’ä¸€ä¸ªå§”æ‰˜ã€‚<br>è¿™ä¸ªæ—¶å€™çŠ¶æ€æœºå°±ä¼šå…è®¸å½“å‰çº¿ç¨‹è¿”å›åˆ°åŸæ¥çš„åœ°æ–¹å»æ‰§è¡Œåé¢çš„ä»£ç ã€‚<br>ç„¶ååœ¨å°†æ¥çš„æŸä¸ªæ—¶å€™ï¼Œawaiterå¯¹è±¡ä¼šåœ¨å®Œæˆæ—¶è°ƒç”¨å½“æ—¶ç»™OnCompletedæ–¹æ³•ä¼ é€’çš„å§”æ‰˜ç„¶åæ‰§è¡Œ MoveNextæ–¹æ³•ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥æ ¹æ®çŠ¶æ€æœºä¸­çš„æŸä¸ªå­—æ®µæ¥çŸ¥é“å¦‚ä½•åˆ°è¾¾ä»£ç ä¸­æ­£ç¡®çš„ä½ç½®ï¼Œä½¿æ–¹æ³• èƒ½å¤Ÿä»å½“åˆç¦»å¼€çš„ä½ç½®ç»§ç»­æ‰§è¡Œã€‚<br>æœ€åä¼šè°ƒç”¨awaiterå¯¹è±¡çš„GetResultæ–¹æ³•è·å–æœ€ç»ˆçš„ç»“æœã€‚</p>
</blockquote>
<blockquote>
<p>ConfigureAwait(false)<br>ä½¿ç”¨awaitæ—¶ï¼Œåœ¨æ‰§è¡Œå®Œå¼‚æ­¥ä»»åŠ¡åï¼Œç³»ç»Ÿä¼šå°è¯•è¿”å›ä¹‹å‰çš„çº¿ç¨‹ç»§ç»­æ‰§è¡Œã€‚<br>ä½¿ç”¨ConfigureAwait(false)æ—¶ï¼Œç³»ç»Ÿä¼šåœ¨æ‰§è¡Œå®Œå¼‚æ­¥ä»»åŠ¡åä¸ä¼šå°è¯•è¿”å›ä¹‹å‰çš„çº¿ç¨‹(ä¸æ•è·çº¿ç¨‹çš„ä¸Šä¸‹ æ–‡)ï¼Œè€Œæ˜¯åœ¨çº¿ç¨‹æ± é‡Œé¢æ‰¾ä¸€ä¸ªç©ºé—²çš„çº¿ç¨‹æ‰§è¡Œæ¥ä¸‹æ¥çš„ä»£ç ã€‚<br>ä½¿ç”¨ConfigureAwait(false)åœ¨éUIçº¿ç¨‹æ‰§è¡Œawaitä»»åŠ¡æ—¶éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºè°ƒç”¨å¼‚æ­¥ä»»åŠ¡çš„çº¿ç¨‹æ­¤æ—¶å¯èƒ½ æ­£åœ¨å¿™ç€åšå…¶å®ƒäº‹æƒ…ï¼Œæ²¡æœ‰ç©ºæ¥ç€æ‰§è¡Œåé¢çš„ä»£ç ã€‚</p>
</blockquote>
<h4 id="Invoke-x2F-BeginInvoke"><a href="#Invoke-x2F-BeginInvoke" class="headerlink" title="Invoke&#x2F;BeginInvoke"></a>Invoke&#x2F;BeginInvoke</h4><blockquote>
<p>Invokeè°ƒç”¨æ—¶ï¼Œä¼šé˜»æ­¢å½“å‰ä¸»çº¿ç¨‹çš„è¿è¡Œï¼Œç­‰å¾…Invokeæ–¹æ³•è¿”å›æ—¶æ‰ç»§ç»­æ‰§è¡Œåé¢çš„ä»£ç ï¼Œç±»ä¼¼äºåŒ æ­¥æ‰§è¡Œã€‚<br>BeginInvokeè°ƒç”¨æ—¶ï¼Œå½“å‰çº¿ç¨‹ä¼šå¯åŠ¨çº¿ç¨‹æ± ä¸­çš„æŸä¸ªçº¿ç¨‹æ¥æ‰§è¡Œæ–¹æ³•ï¼ŒBeginInvokeä¸ä¼šé˜»æ­¢å½“å‰ä¸»çº¿ ç¨‹çš„è¿è¡Œï¼Œè€Œæ˜¯ç­‰å½“å‰ä¸»çº¿ç¨‹åšå®Œäº‹æƒ…ä¹‹åå†æ‰§è¡ŒBeginInvokeä¸­çš„ä»£ç ï¼Œç±»ä¼¼äºå¼‚æ­¥æ‰§è¡Œã€‚æƒ³è·å– BeginInvokeæ‰§è¡Œå®Œæ¯•åçš„ç»“æœï¼Œå¯ä»¥è°ƒç”¨EndInvoeæ–¹æ³•æ¥è·å–ã€‚</p>
</blockquote>
<h2 id="CPUé£™å‡çš„åŸå› "><a href="#CPUé£™å‡çš„åŸå› " class="headerlink" title="CPUé£™å‡çš„åŸå› "></a>CPUé£™å‡çš„åŸå› </h2><blockquote>
<p>CPUæ˜¯æ•´ä¸ªè®¡ç®—æœºçš„æ ¸å¿ƒè®¡ç®—èµ„æºã€‚å¯¹äºä¸€ä¸ªåº”ç”¨ç¨‹åºæ¥è¯´ï¼ŒCPUçš„æœ€å°æ‰§è¡Œå•å…ƒæ˜¯çº¿ç¨‹ã€‚</p>
</blockquote>
<blockquote>
<p>å¯¼è‡´CPUé£™å‡çš„åŸå› ï¼Œå¯èƒ½æ˜¯CPUçš„ä¸Šä¸‹æ–‡åˆ‡æ¢è¿‡å¤šã€‚<br>å¯¹CPUæ¥è¯´ï¼ŒåŒä¸€ä¸ªæ—¶åˆ»ä¸‹ï¼Œæ¯ä¸ªCPUæ ¸å¿ƒåªèƒ½è¿è¡Œä¸€ä¸ªçº¿ç¨‹ã€‚<br>å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹è¦å»è¢«æ‰§è¡Œï¼ŒCPUåªèƒ½é€šè¿‡ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ–¹å¼æ¥è°ƒåº¦ä¸åŒçš„çº¿ç¨‹ã€‚<br>ä¸Šä¸‹æ–‡åˆ‡æ¢éœ€è¦ä¿å­˜è¿è¡Œä¸­çº¿ç¨‹çš„æ‰§è¡ŒçŠ¶æ€ï¼Œè¿˜å¾—è®©å¤„äºç­‰å¾…ä¸­çš„çº¿ç¨‹æ¢å¤æ‰§è¡Œã€‚<br>è¿™ä¸¤ä¸ªè¿‡ç¨‹éƒ½éœ€è¦CPUæ‰§è¡Œå†…æ ¸çš„ç›¸å…³æŒ‡ä»¤ï¼Œå»å®ç°çŠ¶æ€çš„ä¿å­˜å’Œæ¢å¤ã€‚<br>å¦‚æœæœ‰è¾ƒå¤šçš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå°±ä¼šå æ®å¤§é‡çš„CPUèµ„æºã€‚<br>ä»è€Œä½¿å¾—CPUæ— æ³•æ‰§è¡Œç”¨æˆ·è¿›ç¨‹ä¸­çš„çœŸæ­£æŒ‡ä»¤ï¼Œå¯¼è‡´å“åº”é€Ÿåº¦ä¸‹é™ã€‚</p>
</blockquote>
<blockquote>
<p>åœ¨C#ä¸­ï¼Œæ–‡ä»¶IOï¼Œç½‘ç»œIOï¼Œé”ç­‰å¾…ï¼Œè¿™äº›éƒ½ä¼šé€ æˆçº¿ç¨‹çš„é˜»å¡ï¼Œå¯¼è‡´CPUçš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚<br>è¿˜æœ‰ä¸€ç§æƒ…å†µå°±æ˜¯CPUçš„èµ„æºè¢«è¿‡åº¦æ¶ˆè€—äº†ï¼Œä¹Ÿå°±æ˜¯åœ¨ç¨‹åºä¸­åˆ›å»ºäº†å¤§é‡çš„çº¿ç¨‹æˆ–è€…æœ‰çº¿ç¨‹ä¸€ç›´å æ® CPUçš„èµ„æºï¼Œæ— æ³•è¢«é‡Šæ”¾ï¼Œæ¯”å¦‚æ­»å¾ªç¯ã€‚</p>
</blockquote>
<blockquote>
<p>CPUçš„åˆ©ç”¨ç‡è¿‡é«˜ï¼Œå°±ä¼šå¯¼è‡´åº”ç”¨ç¨‹åºä¸­çš„çº¿ç¨‹ï¼Œæ— æ³•è·å¾—CPUçš„è°ƒåº¦ï¼Œä»è€Œå½±å“ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚<br>æ‰€ä»¥å¯ä»¥åœ¨ä»»åŠ¡ç®¡ç†å™¨é‡Œé¢æ‰¾åˆ°CPUåˆ©ç”¨ç‡è¾ƒé«˜çš„è¿›ç¨‹ï¼Œç„¶åæ‰¾åˆ°è¿›ç¨‹ä¸­CPUæ¶ˆè€—è¿‡é«˜çš„çº¿ç¨‹ã€‚</p>
</blockquote>
<blockquote>
<p>ä½†æ˜¯è¿™é‡Œæœ‰ä¸¤ç§æƒ…å†µã€‚</p>
</blockquote>
<blockquote>
<p>ç¬¬ä¸€ç§æƒ…å†µå°±æ˜¯CPUåˆ©ç”¨ç‡è¿‡é«˜çš„çº¿ç¨‹ä¸€ç›´æ˜¯åŒä¸€ä¸ªï¼Œä¹Ÿå°±æ˜¯çº¿ç¨‹çš„IDæ²¡æœ‰å˜åŒ–ï¼Œè¯´æ˜åœ¨ç¨‹åºä¸­å­˜åœ¨ ç€é•¿æœŸå ç”¨CPUæ²¡æœ‰é‡Šæ”¾çš„ä¸€ä¸ªæƒ…å†µï¼Œé‚£ä¹ˆè¿™ç§æƒ…å†µéœ€è¦æŠŠçº¿ç¨‹çš„å†…å­˜åœ°å€å’Œçº¿ç¨‹çš„IDéƒ½è®°å½•åˆ°æ—¥å¿— æ–‡ä»¶é‡Œé¢ï¼Œç„¶åå»æ‰¾å‡ºç°é—®é¢˜çš„ä»£ç ã€‚</p>
</blockquote>
<blockquote>
<p>ç¬¬äºŒç§æ˜¯CPUåˆ©ç”¨ç‡è¿‡é«˜çš„çº¿ç¨‹IDï¼Œä¸€ç›´åœ¨ä¸æ–­çš„å˜åŒ–ï¼Œé‚£ä¹ˆè¯´æ˜çº¿ç¨‹åˆ›å»ºè¿‡å¤šï¼Œéœ€è¦å»æŒ‘é€‰å‡ ä¸ªçº¿ ç¨‹çš„IDï¼Œç„¶åå»æ’æŸ¥ã€‚</p>
</blockquote>
<blockquote>
<p>åæ­£å°±æ˜¯ä¸å¥½æŸ¥ï¼Œæœ‰å¯èƒ½å®šä½çš„ç»“æœæ˜¯ç¨‹åºæ­£å¸¸ï¼Œåªæ˜¯åœ¨CPUé£™å‡çš„é‚£ä¸€åˆ»ï¼Œç”¨æˆ·è®¿é—®é‡éå¸¸å¤§å¯¼è‡´ ç³»ç»Ÿçš„èµ„æºä¸å¤Ÿã€‚<br>åƒè¿™ç§æƒ…å†µï¼Œå°±è¦å»å¢åŠ ç³»ç»Ÿçš„èµ„æºï¼Œæ¢æ€§èƒ½æ›´é«˜çš„CPUã€‚</p>
</blockquote>
<h2 id="å¤šçº¿ç¨‹æ’é”™"><a href="#å¤šçº¿ç¨‹æ’é”™" class="headerlink" title="å¤šçº¿ç¨‹æ’é”™"></a>å¤šçº¿ç¨‹æ’é”™</h2><blockquote>
<p>å¤šçº¿ç¨‹å¯åŠ¨æ— åºï¼Œæ‰§è¡Œæ— åºï¼Œç»“æœæ— åºï¼Œæ‰€ä»¥å“ªä¸ªçº¿ç¨‹æŠ¥é”™äº†å¿…é¡»ç»™æ¯ä¸ªçº¿ç¨‹åŒ…ä¸Štry catchè¿›è¡Œå¼‚å¸¸ æ•è·ï¼Œç„¶ååŠ æ—¥å¿—ï¼ŒæŠŠçº¿ç¨‹çš„å†…å­˜åœ°å€æ‰“å°å‡ºæ¥ã€‚<br>å¦‚æœåœ¨visual studioçš„è°ƒè¯•ä¸­æŠ¥é”™äº†ï¼Œå¯ä»¥ç›´æ¥ä»è¯Šæ–­å·¥å…·ä¸­çœ‹æ˜¯å“ªä¸ªçº¿ç¨‹æŠ¥é”™äº†ï¼ŒæŠ¥äº†ä»€ä¹ˆé”™ï¼Œä»è¯Š æ–­å·¥å…·ä¸­ç‚¹å‡»è¯¥å¼‚å¸¸ï¼Œvisual studioå¯ä»¥æ¿€æ´»å†å²è°ƒè¯•ã€‚</p>
</blockquote>
<h2 id="ååé‡-x2F-å¹¶å‘é‡"><a href="#ååé‡-x2F-å¹¶å‘é‡" class="headerlink" title="ååé‡&#x2F;å¹¶å‘é‡"></a>ååé‡&#x2F;å¹¶å‘é‡</h2><blockquote>
<p>ååé‡æ˜¯æŒ‡å•ä½æ—¶é—´å†…çš„æ•°æ®æ€»é‡ã€‚å¹¶å‘é‡æ˜¯æŒ‡å•ä½æ—¶é—´å†…çš„è¯·æ±‚æ•°é‡ã€‚</p>
</blockquote>
<blockquote>
<p>æ¯”å¦‚ä¸€æ¡åŒè¡Œé“çš„å…¬è·¯ï¼Œåªèƒ½åŒæ—¶è¿‡2è¾†è½¦ï¼Œ1ä¸ªå°æ—¶åŒè¡Œäº†100è¾†è½¦ã€‚è¿™é‡Œçš„2å°±æ˜¯å¹¶å‘é‡ï¼Œè¿™é‡Œ çš„100å°±æ˜¯ååé‡ã€‚</p>
</blockquote>
<h2 id="å¹¶è¡Œ-x2F-å¹¶å‘"><a href="#å¹¶è¡Œ-x2F-å¹¶å‘" class="headerlink" title="å¹¶è¡Œ&#x2F;å¹¶å‘"></a>å¹¶è¡Œ&#x2F;å¹¶å‘</h2><blockquote>
<p>å¹¶è¡Œå’Œå¹¶å‘æœ€æ—©æè¿°çš„æ˜¯åœ¨C#å¹¶å‘ç¼–ç¨‹é‡Œé¢çš„ä¸€ä¸ªæ¦‚å¿µï¼Œå¼ºè°ƒçš„æ˜¯CPUå¤„ç†ä»»åŠ¡çš„ä¸€ä¸ªèƒ½åŠ›ã€‚</p>
</blockquote>
<blockquote>
<p>å¹¶å‘å°±æ˜¯åŒä¸€ä¸ªæ—¶åˆ»CPUèƒ½å¤Ÿå¤„ç†çš„ä»»åŠ¡æ•°é‡ã€‚<br>å¹¶è¡Œå°±æ˜¯åœ¨åŒä¸€ä¸ªæ—¶åˆ»ï¼Œå…è®¸å¤šä¸ªä»»åŠ¡åŒæ—¶æ‰§è¡Œã€‚</p>
</blockquote>
<blockquote>
<p>åœ¨å¤šæ ¸CPUçš„æ¶æ„é‡Œé¢ï¼ŒåŒæ—¶æ‰§è¡Œä»»åŠ¡çš„æ•°é‡æ˜¯ç”±CPUçš„æ ¸å¿ƒæ•°é‡å†³å®šçš„ã€‚<br>æ¯”å¦‚è¯´å››æ ¸å››çº¿ç¨‹çš„CPUé‡Œé¢ï¼Œåªèƒ½åŒæ—¶æ‰§è¡Œå››ä¸ªçº¿ç¨‹ã€‚<br>å¹¶å‘æè¿°çš„æ˜¯ç¨‹åºå¤„ç†èƒ½åŠ›çš„è§†è§’ã€‚<br>è€Œå¹¶è¡Œæè¿°çš„æ˜¯CPUå¤„ç†ä»»åŠ¡æ–¹å¼çš„ä¸€ä¸ªè§†è§’ã€‚<br>å®ƒä»¬ä¸¤ä¸ªç›¸è¾…ç›¸æˆï¼ŒCPUå¹¶è¡Œæ‰§è¡Œä»»åŠ¡çš„èƒ½åŠ›åˆèƒ½å¤Ÿæå‡ç¨‹åºçš„å¹¶å‘å¤„ç†æ€§èƒ½ã€‚<br>æ‰€ä»¥å¤šæ ¸CPUçš„æ€§èƒ½è¦æ¯”å•æ ¸CPUè¦å¥½ã€‚<br>å¦‚æœæ˜¯å•æ ¸CPUä¹Ÿå¯ä»¥é€šè¿‡æ—¶é—´ç‰‡åˆ‡æ¢çš„æ–¹å¼å»æå‡å¹¶å‘çš„èƒ½åŠ›ã€‚</p>
</blockquote>
<p><a href="https://blog.csdn.net/qq_38192821/article/details/130538395?spm=1001.2014.3001.5501">æœ¨å­ä¸¶é¹</a></p>
]]></content>
      <categories>
        <category>å¤šçº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>C#</tag>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
</search>
